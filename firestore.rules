rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Only authenticated users can read/write
    function isAuth() {
      return request.auth != null;
    }
    // Clients: any authenticated user can read/write (shared registry)
    match /clients/{clientId} {
      allow read, write: if isAuth();
    }
    // Reports: any authenticated user can create/read; structure by section + client
    match /reports/{reportId} {
      allow read, create: if isAuth();
      allow update, delete: if isAuth();
    }
    // Channel messages: any authenticated user can read/write
    match /channels/{channelId}/messages/{messageId} {
      allow read, write: if isAuth();
    }
    // User profiles: users can read/write their own (uid = document id)
    match /userProfiles/{userId} {
      allow read, write: if isAuth() && request.auth.uid == userId;
      match /config/{docId} {
        allow read, write: if isAuth() && request.auth.uid == userId;
      }
    }
    // Optional: global config/lists (e.g. PSY, BEH, ADL) â€” read for all, write for admins if you add claims later
    match /config/{docId} {
      allow read: if isAuth();
      allow write: if isAuth();
    }
  }
}
