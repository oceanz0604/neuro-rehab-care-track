/* ═══════════════════════════════════════════════════════════════
   NeuroRehab CareTrack — Main Stylesheet
   Indigo sidebar · Teal primary · Glassmorphism-lite · Responsive
   ═══════════════════════════════════════════════════════════════ */

/* ─── CSS Variables ───────────────────────────────────────────── */
:root {
  --sidebar-w: 260px;
  --topbar-h: 64px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --bottom-nav-h: 0px;
  --navy: #1e1b4b;
  --navy-light: #312e81;
  --primary: #14b8a6;
  --primary-hover: #0d9488;
  --primary-light: #99f6e4;
  --primary-bg: #f0fdfa;
  --primary-grad: linear-gradient(135deg, #14b8a6 0%, #10b981 100%);
  --accent: #f43f5e;
  --accent-bg: #fff1f2;
  --amber: #f59e0b;
  --amber-bg: #fffbeb;
  --green: #22c55e;
  --green-bg: #f0fdf4;
  --grey: #94a3b8;
  --grey-bg: #f1f5f9;
  --bg: #f8fafc;
  --bg-subtle: #f1f5f9;
  --card: #ffffff;
  --card-glass: rgba(255,255,255,.75);
  --text: #0f172a;
  --text-2: #475569;
  --text-3: #94a3b8;
  --border: #e2e8f0;
  --shadow-sm: 0 1px 2px rgba(15,23,42,.05);
  --shadow: 0 1px 3px rgba(15,23,42,.06), 0 1px 2px rgba(15,23,42,.04);
  --shadow-md: 0 4px 6px rgba(15,23,42,.05), 0 10px 15px rgba(15,23,42,.08);
  --shadow-lg: 0 10px 25px rgba(15,23,42,.08), 0 20px 48px rgba(15,23,42,.06);
  --card-accent-border: rgba(20,184,166,.25);
  --radius: 12px;
  --radius-sm: 8px;
  --radius-lg: 16px;
  --radius-pill: 999px;
  --font: 'Inter', system-ui, -apple-system, sans-serif;
  --transition: .2s cubic-bezier(.4,0,.2,1);
  --transition-fast: .15s cubic-bezier(.4,0,.2,1);
  --transition-spring: .3s cubic-bezier(.34,1.56,.64,1);
}

/* ─── Dark theme ────────────────────────────────────────────────── */
[data-theme="dark"] {
  --navy: #0c0a1f;
  --navy-light: #1e1b4b;
  --primary: #2dd4bf;
  --primary-hover: #5eead4;
  --primary-light: #134e4a;
  --primary-bg: #042f2e;
  --primary-grad: linear-gradient(135deg, #2dd4bf 0%, #34d399 100%);
  --accent: #fb7185;
  --accent-bg: #4c0519;
  --amber: #fbbf24;
  --amber-bg: #451a03;
  --green: #4ade80;
  --green-bg: #052e16;
  --grey: #64748b;
  --grey-bg: #1e293b;
  --bg: #0f172a;
  --bg-subtle: #1e293b;
  --card: #1e293b;
  --card-glass: rgba(30,41,59,.8);
  --text: #f1f5f9;
  --text-2: #cbd5e1;
  --text-3: #64748b;
  --border: #334155;
  --shadow-sm: 0 1px 2px rgba(0,0,0,.4);
  --shadow: 0 1px 3px rgba(0,0,0,.4), 0 1px 2px rgba(0,0,0,.3);
  --shadow-md: 0 4px 6px rgba(0,0,0,.3), 0 10px 15px rgba(0,0,0,.4);
  --shadow-lg: 0 10px 25px rgba(0,0,0,.4), 0 20px 48px rgba(0,0,0,.3);
  --card-accent-border: rgba(45,212,191,.3);
}
[data-theme="dark"] .fi:focus,
[data-theme="dark"] .fg textarea:focus,
[data-theme="dark"] .search-box input:focus { background: var(--bg); }
[data-theme="dark"] .login-header h1 { color: var(--text); }
[data-theme="dark"] .login-icon { background: rgba(255,255,255,.95); }
[data-theme="dark"] .sidebar { background: linear-gradient(180deg, #0c0a1f 0%, #1e1b4b 100%); }
[data-theme="dark"] .sb-brand { border-bottom-color: rgba(255,255,255,.08); }
[data-theme="dark"] .sb-foot { border-top-color: rgba(255,255,255,.08); }
[data-theme="dark"] .nav-link { color: #94a3b8; }
[data-theme="dark"] .nav-link:hover { background: rgba(255,255,255,.06); color: #e2e8f0; }
[data-theme="dark"] .nav-link.active { background: rgba(45,212,191,.12); color: #2dd4bf; }
[data-theme="dark"] .logout-btn:hover { background: rgba(251,113,133,.12); color: #fb7185; }
[data-theme="dark"] .fi,
[data-theme="dark"] .fg textarea,
[data-theme="dark"] .fg select,
[data-theme="dark"] .search-box input,
[data-theme="dark"] .filter-select,
[data-theme="dark"] .add-inp,
[data-theme="dark"] .li-txt,
[data-theme="dark"] .adl-select,
[data-theme="dark"] .rating-btn,
[data-theme="dark"] .chat-compose input,
[data-theme="dark"] .urgent-toggle { background: var(--bg-subtle); border-color: var(--border); color: var(--text); }
[data-theme="dark"] .btn-ghost:hover { background: var(--bg-subtle); }
[data-theme="dark"] .btn-outline { border-color: var(--border); color: var(--text-2); }
[data-theme="dark"] .btn-outline:hover { border-color: #2dd4bf; color: #2dd4bf; background: rgba(45,212,191,.1); }
[data-theme="dark"] #toast { background: #1e293b; border: 1px solid #334155; }
[data-theme="dark"] .pwa-install-banner { background: #1e293b; border-color: #334155; }
[data-theme="dark"] .modal-card { background: #1e293b; border-color: #334155; }
[data-theme="dark"] .modal-body { color: var(--text-2); }
[data-theme="dark"] .login-card { background: #1e293b; }
[data-theme="dark"] .stat-value,
[data-theme="dark"] .card-hd { color: var(--text); }
[data-theme="dark"] tr:hover td { background: rgba(45,212,191,.06); }
[data-theme="dark"] .channel-item.active { background: rgba(45,212,191,.15); color: #2dd4bf; }
[data-theme="dark"] .msg-bubble.theirs { background: var(--bg-subtle); color: var(--text); }
[data-theme="dark"] .msg-bubble.mine { background: #0d9488; color: #fff; }
[data-theme="dark"] .msg-bubble.urgent { background: #4c0519; color: #fecaca; }
[data-theme="dark"] .msg-bubble.mine.urgent { background: #be123c; border-color: #9f1239; color: #fff; }
[data-theme="dark"] .tab-bar { background: var(--bg-subtle); }
[data-theme="dark"] .tab-btn:hover { background: rgba(255,255,255,.05); }
[data-theme="dark"] .tab-btn.active { background: var(--card); color: #2dd4bf; }
[data-theme="dark"] .table-wrap { background: var(--card); border-color: var(--border); }
[data-theme="dark"] th { background: var(--bg-subtle); }
[data-theme="dark"] tbody tr:nth-child(even) td { background: rgba(255,255,255,.02); }
[data-theme="dark"] .task-board-column { background: var(--bg-subtle); border-color: var(--border); }
[data-theme="dark"] .task-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .task-detail-main { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .task-detail-sidebar { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .task-detail-sidebar-hd { background: var(--bg-subtle); }
[data-theme="dark"] .task-detail-desc-view { background: var(--bg-subtle); }
[data-theme="dark"] .loading-screen { background: linear-gradient(135deg, #0c0a1f 0%, #1e1b4b 50%, #0f172a 100%); }
[data-theme="dark"] .login-screen { background: linear-gradient(135deg, #0c0a1f 0%, #1e1b4b 50%, #0f172a 100%); }
[data-theme="dark"] .loading-spinner { border-color: rgba(45,212,191,.2); border-top-color: #2dd4bf; }
[data-theme="dark"] .loading-screen p { color: var(--text-2); }
[data-theme="dark"] .report-entry { background: var(--card); border-left-color: var(--border); }
[data-theme="dark"] .collapsible-head { background: var(--bg-subtle); }
[data-theme="dark"] .channel-list-pinned { background: var(--bg-subtle); }
[data-theme="dark"] .empty-state { color: var(--text-3); }
[data-theme="dark"] .welcome-banner { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #0d9488 100%); }
[data-theme="dark"] .quick-action-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .quick-action-card:hover { background: var(--bg-subtle); }
[data-theme="dark"] .bottom-nav { background: rgba(15,23,42,.95); border-top-color: #334155; }
[data-theme="dark"] .pd-rich-header { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .mobile-fab { box-shadow: 0 4px 16px rgba(0,0,0,.5); }
[data-theme="dark"] .nav-section-label { color: rgba(255,255,255,.25); }
[data-theme="dark"] .patient-card-quick button { background: var(--bg-subtle); border-color: var(--border); }

/* ─── Reset ───────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html {
  font-size: 15px; -webkit-text-size-adjust: 100%;
  overflow-x: clip; max-width: 100vw; width: 100%;
  touch-action: manipulation; /* reduce double-tap zoom */
}
body {
  font-family: var(--font); color: var(--text); background: var(--bg); line-height: 1.55;
  overflow-x: clip; max-width: 100vw; width: 100%;
  position: relative;
  transition: background-color .25s ease, color .2s ease;
}
body.modal-open { overflow: hidden; }
a { color: var(--primary); text-decoration: none; }
button { cursor: pointer; font-family: inherit; }
input, select, textarea { font-family: inherit; font-size: .93rem; }
img { max-width: 100%; }
:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }
.hidden { display: none !important; }

/* Hide scrollbars site-wide (content still scrollable) */
* { scrollbar-width: none; -ms-overflow-style: none; }
*::-webkit-scrollbar { display: none; }

/* ─── Loading screen (until auth resolved) ─────────────────────── */
.loading-screen {
  position: fixed; inset: 0; z-index: 9998;
  background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 50%, #f8fafc 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 18px;
  color: var(--primary);
}
.loading-screen.hidden { display: none !important; }
.loading-spinner {
  width: 40px; height: 40px; border: 3px solid rgba(20,184,166,.15);
  border-top-color: var(--primary); border-radius: 50%; animation: spin .8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-screen p { font-size: .9rem; font-weight: 500; color: var(--text-2); letter-spacing: .01em; }

/* ─── Login Screen ────────────────────────────────────────────── */
.login-screen {
  min-height: 100vh; display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 50%, #f8fafc 100%);
  padding: 24px;
}
.login-card {
  background: var(--card); border-radius: var(--radius-lg); padding: 44px 38px;
  width: 100%; max-width: 400px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
}
.login-header { text-align: center; margin-bottom: 30px; }
.login-icon {
  width: 64px; height: 64px; border-radius: var(--radius);
  background: #fff;
  display: inline-flex; align-items: center; justify-content: center;
  margin-bottom: 16px; overflow: hidden;
  box-shadow: var(--shadow-md);
}
.login-icon img { width: 100%; height: 100%; object-fit: contain; }
.login-header h1 { font-size: 1.5rem; font-weight: 700; color: var(--text); letter-spacing: -.02em; }
.login-header p { color: var(--text-3); font-size: .85rem; margin-top: 6px; }
.fg { margin-bottom: 16px; }
.fg label { display: block; font-size: .8rem; font-weight: 600; color: var(--text-2); margin-bottom: 5px; text-transform: uppercase; letter-spacing: .04em; }
.fi {
  width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .93rem;
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
  background: var(--bg);
}
.fi:focus { border-color: var(--primary); outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.error-msg { color: var(--accent); font-size: .82rem; margin-bottom: 10px; }
.login-hint { text-align: center; color: var(--text-3); font-size: .78rem; margin-top: 16px; }

/* ─── Buttons ─────────────────────────────────────────────────── */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 10px 22px; border: none; border-radius: var(--radius-sm);
  font-size: .85rem; font-weight: 600; transition: all var(--transition);
  background: var(--primary-grad); color: #fff;
  box-shadow: 0 1px 3px rgba(20,184,166,.2);
  letter-spacing: .01em;
}
.btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(20,184,166,.3); }
.btn:active { transform: translateY(0) scale(.97); box-shadow: 0 1px 3px rgba(20,184,166,.15); }
.btn:disabled { opacity: .5; pointer-events: none; }
.btn-block { width: 100%; padding: 12px; font-size: .93rem; }
.btn-sm { padding: 6px 14px; font-size: .8rem; }
.btn-ghost { background: transparent; color: var(--text-2); box-shadow: none; }
.btn-ghost:hover { background: var(--grey-bg); transform: none; }
.btn-danger { background: linear-gradient(135deg, #f43f5e, #e11d48); box-shadow: 0 1px 3px rgba(244,63,94,.2); }
.btn-danger:hover { box-shadow: 0 4px 12px rgba(244,63,94,.3); }
.btn-outline {
  background: transparent; border: 1.5px solid var(--border); color: var(--text-2);
  box-shadow: none; border-radius: 10px;
}
.btn-outline:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-bg); }
.btn-icon {
  width: 38px; height: 38px; padding: 0; border-radius: 10px;
  background: transparent; color: var(--text-2); border: none; font-size: 1rem;
}
.btn-icon:hover { background: var(--grey-bg); }

/* ─── App Shell Layout ────────────────────────────────────────── */
.app { display: flex; min-height: 100vh; min-width: 0; max-width: 100%; overflow-x: clip; }
#app-shell[hidden] { display: none !important; }

/* Sidebar — dark indigo gradient */
.sidebar {
  width: var(--sidebar-w);
  background: linear-gradient(180deg, #1e1b4b 0%, #312e81 100%);
  color: rgba(255,255,255,.7);
  display: flex; flex-direction: column; position: fixed; top: 0; bottom: 0; left: 0;
  z-index: 100; transition: transform .25s ease;
  padding-top: var(--safe-top);
  padding-left: max(14px, env(safe-area-inset-left, 0px));
  padding-right: max(14px, env(safe-area-inset-right, 0px));
  box-sizing: border-box;
  border-right: none;
  box-shadow: 4px 0 24px rgba(15,23,42,.15);
}
.sb-brand {
  display: flex; align-items: center; gap: 10px;
  height: var(--topbar-h); min-height: var(--topbar-h); padding: 12px 16px 14px 0; box-sizing: border-box;
  font-size: 1rem; font-weight: 700; color: #fff;
  border-bottom: 1px solid rgba(255,255,255,.1);
  flex-shrink: 0; overflow: hidden;
}
.sb-user-avatar {
  width: 36px; height: 36px; border-radius: 50%;
  background: linear-gradient(135deg, #14b8a6, #10b981);
  display: flex; align-items: center; justify-content: center;
  font-size: .8rem; font-weight: 700; color: #fff; flex-shrink: 0;
  letter-spacing: .02em;
}
.sb-brand-logo { height: 28px; width: auto; max-width: 32px; object-fit: contain; flex-shrink: 0; }
.sb-brand-inner { display: flex; flex-direction: column; gap: 2px; min-width: 0; overflow: hidden; }
.sb-brand-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; font-size: .95rem; font-weight: 700; color: #fff; }
.sb-brand .sb-name { font-size: .75rem; font-weight: 500; color: rgba(255,255,255,.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sb-brand i { color: var(--primary); font-size: 1.2rem; }
.sb-nav { flex: 1; padding: 14px 0; overflow-y: auto; }
.nav-section-label {
  font-size: .68rem; font-weight: 600; text-transform: uppercase; letter-spacing: .08em;
  color: rgba(255,255,255,.35); padding: 16px 14px 6px; margin-top: 4px;
}
.nav-link {
  display: flex; align-items: center; gap: 10px; padding: 9px 14px;
  border-radius: var(--radius-sm); color: rgba(255,255,255,.65); font-size: .85rem; font-weight: 500;
  transition: all var(--transition); position: relative; margin-bottom: 2px;
}
.nav-link:hover { background: rgba(255,255,255,.08); color: #fff; }
.nav-link.active {
  background: rgba(20,184,166,.15); color: #fff; font-weight: 600;
  box-shadow: inset 3px 0 0 var(--primary);
}
.nav-link i { width: 20px; text-align: center; font-size: .9rem; }
.nav-badge {
  position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
  background: var(--accent); color: #fff; font-size: .65rem; font-weight: 700;
  padding: 2px 7px; border-radius: var(--radius-pill); display: none;
}
.nav-badge.visible { display: block; }
.sb-foot { padding: 12px 0; border-top: 1px solid rgba(255,255,255,.1); display: flex; flex-direction: column; gap: 4px; }
.sb-foot .nav-link { width: 100%; text-decoration: none; }
.logout-btn {
  width: 100%; text-align: left; text-decoration: none;
  background: none; border: none; cursor: pointer; font-family: inherit;
}
.logout-btn:hover { background: rgba(244,63,94,.12); color: #fb7185; }

/* Mobile sidebar overlay */
.sb-overlay {
  display: none; position: fixed; inset: 0; background: rgba(15,23,42,.5);
  z-index: 99; opacity: 0; transition: opacity .25s;
  backdrop-filter: blur(4px);
}
.sb-overlay.visible { display: block; opacity: 1; }

/* Main area: fixed topbar + scrollable inner frame only */
.main-wrap {
  flex: 1; margin-left: var(--sidebar-w); display: flex; flex-direction: column;
  min-height: 100vh; min-width: 0; overflow-x: clip;
}

/* Topbar — clean border, breadcrumb support */
.topbar {
  position: fixed; top: 0; left: var(--sidebar-w); right: 0;
  min-height: calc(var(--topbar-h) + var(--safe-top)); padding-top: var(--safe-top); box-sizing: border-box;
  z-index: 50;
  background: var(--card);
  display: flex; align-items: center; justify-content: flex-start;
  padding-left: max(24px, calc(18px + var(--safe-left))); padding-right: max(24px, calc(18px + var(--safe-right))); padding-bottom: 0; gap: 12px;
  border-bottom: 1px solid var(--border);
}
.topbar::before { display: none; }
.menu-btn { display: none; background: none; border: none; font-size: 1.15rem; color: var(--text-2); padding: 8px; cursor: pointer; }
.tb-title-wrap { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
.tb-title { font-size: 1.1rem; font-weight: 700; letter-spacing: -0.02em; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text); line-height: 1.3; }
.tb-breadcrumb { font-size: .72rem; color: var(--text-3); display: flex; align-items: center; gap: 4px; margin-top: 1px; }
.tb-breadcrumb a { color: var(--text-3); text-decoration: none; }
.tb-breadcrumb a:hover { color: var(--primary); }
.tb-breadcrumb .bc-sep { opacity: .4; font-size: .6rem; }
.tb-breadcrumb .bc-current { color: var(--text-2); font-weight: 500; }
.tb-right { display: flex; align-items: center; gap: 8px; }
.tb-quick-add {
  width: 36px; height: 36px; border-radius: var(--radius-sm);
  background: var(--primary-grad); color: #fff; border: none;
  display: flex; align-items: center; justify-content: center;
  font-size: .95rem; cursor: pointer;
  transition: all var(--transition); position: relative;
  box-shadow: 0 1px 3px rgba(20,184,166,.2);
}
.tb-quick-add:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(20,184,166,.3); }
.quick-add-menu {
  position: absolute; top: calc(100% + 8px); right: 0; min-width: 200px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  box-shadow: var(--shadow-lg); z-index: 200; display: none; overflow: hidden;
}
.quick-add-menu.visible { display: block; animation: fadeUp .15s ease; }
.quick-add-item {
  display: flex; align-items: center; gap: 10px; padding: 10px 16px;
  font-size: .85rem; font-weight: 500; color: var(--text);
  cursor: pointer; transition: background var(--transition-fast);
  border: none; background: none; width: 100%; text-align: left;
}
.quick-add-item:hover { background: var(--bg-subtle); }
.quick-add-item i { width: 18px; color: var(--text-3); text-align: center; font-size: .85rem; }
.notif-btn {
  position: relative; width: 36px; height: 36px; border-radius: var(--radius-sm);
  background: none; border: none; color: var(--text-2); font-size: 1rem;
  display: flex; align-items: center; justify-content: center;
  transition: background var(--transition);
}
.notif-btn:hover { background: var(--bg-subtle); }

/* Patient standalone page (no sidebar) */
.patient-page .topbar-no-sidebar { left: 0; }
.patient-page .main-content-center { max-width: 900px; margin-left: auto; margin-right: auto; box-sizing: border-box; }
.topbar-back {
  display: inline-flex; align-items: center; justify-content: center;
  width: 36px; height: 36px; border-radius: var(--radius-sm); color: var(--text-2);
  background: none; border: none; text-decoration: none; transition: all var(--transition);
}
.topbar-back:hover { background: var(--bg-subtle); color: var(--text); }
.topbar-back i { font-size: 1rem; }

.shift-badge {
  padding: 4px 12px; border-radius: var(--radius-pill); font-size: .75rem; font-weight: 600;
  background: var(--primary-bg); color: var(--primary);
}

/* ─── Main content (scrollable inner frame only) ────────────────── */
.main-content {
  margin-top: calc(var(--safe-top) + var(--topbar-h));
  margin-bottom: var(--bottom-nav-h);
  flex: 1; min-height: 0; overflow-y: auto; overflow-x: clip;
  padding: 24px; width: 100%; min-width: 0;
  background: var(--bg);
}
.main-content::before { display: none; }
.main-content { word-break: normal; overflow-wrap: break-word; }

/* Pages */
.page { display: none; width: 100%; max-width: 100%; overflow-x: clip; min-width: 0; box-sizing: border-box; }
.page.active { display: block; animation: pageIn .3s cubic-bezier(.4,0,.2,1); }
#page-dashboard { max-width: 1200px; margin-left: auto; margin-right: auto; }
@keyframes pageIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

/* Page title */
.pg-title { font-size: 1.75rem; font-weight: 700; margin-bottom: 4px; color: var(--text); letter-spacing: -.03em; }
.pg-sub { color: var(--text-3); font-size: .85rem; margin-bottom: 20px; }

/* ─── Cards ───────────────────────────────────────────────────── */
.card {
  background: var(--card); border-radius: var(--radius); padding: 20px;
  box-shadow: var(--shadow-sm); border: 1px solid var(--border); margin-bottom: 16px;
  transition: background-color var(--transition), border-color var(--transition), box-shadow var(--transition), transform var(--transition);
}
.card:hover { box-shadow: var(--shadow); }
.card.card-accent { border-left: 3px solid var(--primary); border-radius: 3px var(--radius) var(--radius) 3px; }
.card.card-accent-warn { border-left: 3px solid var(--amber); border-radius: 3px var(--radius) var(--radius) 3px; }
.card.card-accent-danger { border-left: 3px solid var(--accent); border-radius: 3px var(--radius) var(--radius) 3px; }
.card-hd {
  font-size: .9rem; font-weight: 700; margin-bottom: 14px;
  display: flex; align-items: center; gap: 8px;
  color: var(--text); letter-spacing: -.01em;
}
.card-hd i { font-size: .85rem; }
.card-hd.card-hd-primary { color: var(--primary); }
.card-hd.card-hd-accent { color: var(--accent); }

/* Collapsible sections (patient detail, etc.) */
.collapsible-section { border: 1px solid var(--border); border-radius: 12px; margin-bottom: 14px; overflow: hidden; }
.collapsible-head {
  width: 100%; display: flex; align-items: center; gap: 8px; padding: 14px 16px;
  background: var(--bg-subtle); border: none; font-size: .9rem; font-weight: 600; text-align: left; cursor: pointer;
  transition: background var(--transition); border-radius: 12px 12px 0 0;
}
.collapsible-head:hover { background: var(--border); }
.collapsible-head i.fa-chevron-down { transition: transform .2s ease; }
.collapsible-section.collapsed .collapsible-head i.fa-chevron-down { transform: rotate(-90deg); }
.collapsible-body { padding: 14px; }
.collapsible-section.collapsed .collapsible-body { display: none; }

/* Multi-select dropdown */
.multiselect-wrap { position: relative; }
.multiselect-trigger {
  position: relative;
  width: 100%; min-height: 38px; padding: 8px 12px; padding-right: 32px;
  background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .93rem; text-align: left; cursor: pointer; display: flex; align-items: center; flex-wrap: wrap; gap: 6px;
  transition: border var(--transition);
}
.multiselect-trigger:hover { border-color: var(--text-3); }
.multiselect-trigger:focus { border-color: var(--primary); outline: none; }
.multiselect-trigger::after {
  content: ''; position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  border: 5px solid transparent; border-top-color: var(--text-3);
}
.multiselect-wrap.open .multiselect-trigger::after { transform: translateY(-50%) rotate(180deg); }
.multiselect-chip {
  display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px;
  background: var(--primary-bg); color: var(--primary); border-radius: 999px;
  font-size: .8rem; font-weight: 500;
}
.multiselect-placeholder { color: var(--text-3); }
.multiselect-panel {
  position: absolute; left: 0; right: 0; top: 100%; margin-top: 4px; max-height: 220px; overflow-y: auto;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm);
  box-shadow: var(--shadow-md); z-index: 100; display: none; padding: 8px;
}
.multiselect-wrap.open .multiselect-panel { display: flex; flex-direction: column; }
.multiselect-search {
  flex-shrink: 0; margin-bottom: 8px; border-radius: var(--radius-sm);
}
.multiselect-options {
  flex: 1; min-height: 0; overflow-y: auto; max-height: 180px;
}
.multiselect-panel label {
  display: flex; align-items: center; gap: 8px; padding: 8px 10px; cursor: pointer;
  font-size: .88rem; border-radius: var(--radius-sm); transition: background var(--transition);
}
.multiselect-panel label:hover { background: var(--grey-bg); }
.multiselect-panel input[type="checkbox"] { width: 16px; height: 16px; flex-shrink: 0; }

/* Dashboard — Risk Alerts & Recent Reports */
.risk-alert-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); flex-wrap: wrap;
}
.risk-alert-row:last-child { border-bottom: none; }
.risk-alert-row:hover { background: var(--grey-bg); }
.risk-alert-badges { display: flex; flex-direction: column; align-items: flex-start; gap: 4px; flex-shrink: 0; }
.risk-alert-info { flex: 1; min-width: 0; }
.risk-alert-meta { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.badge-your-patient,
.badge-my-patient {
  font-size: .7rem; font-weight: 600; padding: 3px 10px; border-radius: var(--radius-pill);
  background: var(--primary-bg); color: var(--primary); white-space: nowrap;
}
.required-asterisk { color: var(--accent); }
.text-muted { color: var(--text-3); font-size: .85em; }

/* Multi-step wizard (e.g. Add Patient) */
.modal-card-wizard .wizard-steps {
  display: flex; align-items: center; justify-content: center; gap: 0;
  margin-bottom: 20px; padding: 0 8px;
}
.wizard-dot {
  width: 28px; height: 28px; border-radius: 50%;
  background: var(--grey-bg); color: var(--text-3); font-size: .8rem; font-weight: 700;
  display: inline-flex; align-items: center; justify-content: center;
  transition: background var(--transition), color var(--transition);
}
.wizard-dot.active { background: var(--primary); color: #fff; }
.wizard-line {
  width: 40px; height: 2px; background: var(--border); flex-shrink: 0;
}
.wizard-pane { min-height: 120px; }
.wizard-actions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end; align-items: center; }
.recent-rpt-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); flex-wrap: wrap;
}
.recent-rpt-row:last-child { border-bottom: none; }
.recent-rpt-row:hover { background: var(--grey-bg); }
.recent-rpt-main { flex: 1; min-width: 0; }
.recent-rpt-name { font-size: .88rem; }
.recent-rpt-meta { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.recent-rpt-badge { flex-shrink: 0; }
.recent-rpt-ts { font-size: .75rem; color: var(--text-3); white-space: nowrap; }

/* ─── Stat Cards ──────────────────────────────────────────────── */
.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 14px; margin-bottom: 20px; }
.stat-card {
  background: var(--card); border-radius: var(--radius); padding: 16px;
  box-shadow: var(--shadow-sm); border: 1px solid var(--border);
  display: flex; align-items: center; gap: 14px;
  transition: all var(--transition); position: relative; overflow: hidden;
}
.stat-card.clickable { cursor: pointer; }
.stat-card.clickable:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
.stat-card.stat-card-teal { border-left: 3px solid var(--primary); border-radius: 3px var(--radius) var(--radius) 3px; }
.stat-card.stat-card-red { border-left: 3px solid var(--accent); border-radius: 3px var(--radius) var(--radius) 3px; }
.stat-card.stat-card-amber { border-left: 3px solid var(--amber); border-radius: 3px var(--radius) var(--radius) 3px; }
.stat-card.stat-card-green { border-left: 3px solid var(--green); border-radius: 3px var(--radius) var(--radius) 3px; }
.stat-icon {
  width: 44px; height: 44px; border-radius: var(--radius);
  display: flex; align-items: center; justify-content: center; font-size: 1.05rem; flex-shrink: 0;
}
.stat-icon.teal { background: linear-gradient(135deg, #f0fdfa, #ccfbf1); color: #0d9488; }
.stat-icon.red { background: linear-gradient(135deg, #fff1f2, #fecdd3); color: #e11d48; }
.stat-icon.amber { background: linear-gradient(135deg, #fffbeb, #fef3c7); color: #d97706; }
.stat-icon.green { background: linear-gradient(135deg, #f0fdf4, #dcfce7); color: #16a34a; }
.stat-label { font-size: .75rem; color: var(--text-3); font-weight: 500; text-transform: uppercase; letter-spacing: .04em; }
.stat-value { font-size: 1.3rem; font-weight: 700; line-height: 1.2; color: var(--text); letter-spacing: -.02em; }

/* Dashboard — My Active Patients */
.my-pt-row {
  display: flex; align-items: flex-start; gap: 12px; padding: 12px 4px;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition);
}
.my-pt-row:last-child { border-bottom: none; }
.my-pt-row:hover { background: var(--bg-subtle); border-radius: 10px; }
.my-pt-info { flex: 1; min-width: 0; }
.my-pt-name {
  font-size: 1.05rem; font-weight: 700; color: var(--text);
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
}
.my-pt-diagnosis { font-size: .82rem; color: var(--text-3); margin-top: 2px; }
.my-pt-diagnosis-line { margin-top: 2px; }
.my-pt-diagnosis-line:first-child { margin-top: 0; }
.my-pt-report {
  font-size: .82rem; color: var(--text-2); margin-top: 4px;
  display: flex; align-items: center; gap: 6px;
}
.my-pt-report i { font-size: .75rem; color: var(--primary); }

/* ─── Two-column layout ──────────────────────────────────────── */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

/* ─── Risk badges ─────────────────────────────────────────────── */
.risk-badge {
  display: inline-block; padding: 3px 12px; border-radius: var(--radius-pill);
  font-size: .73rem; font-weight: 600; text-transform: uppercase; letter-spacing: .03em;
}
.risk-none { background: var(--grey-bg); color: var(--grey); }
.risk-low { background: var(--green-bg); color: var(--green); }
.risk-medium { background: var(--amber-bg); color: var(--amber); }
.risk-high { background: var(--accent-bg); color: var(--accent); }

/* ─── Patients card grid ─────────────────────────────────────── */
.patients-card-grid {
  display: grid;
  width: 100%;
  gap: 16px;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}
.patients-card-grid > .empty-state { grid-column: 1 / -1; }
.patient-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px 18px;
  min-width: 0;
  box-shadow: var(--shadow-sm);
  transition: border-color var(--transition), box-shadow var(--transition);
}
.patient-card:hover { border-color: var(--primary); box-shadow: var(--shadow); transform: translateY(-1px); }
.patient-card.clickable { cursor: pointer; }

.patient-card-discharged {
  background: var(--grey-bg);
  border: 1px dashed var(--border);
  border-left: 3px solid var(--text-3);
  opacity: 0.92;
  box-shadow: none;
  border-radius: 4px 16px 16px 4px;
}
.patient-card-discharged:hover {
  border-color: var(--text-3);
  box-shadow: none;
  background: var(--grey-bg);
  transform: none;
}
.patient-card-discharged .patient-card-name,
.patient-card-discharged .patient-card-diagnosis,
.patient-card-discharged .patient-card-label { color: var(--text-2); }
.patient-card-discharged .patient-card-name { font-weight: 500; }
.patient-card-discharged .patient-card-discharge-date { color: var(--text-3); }
.patient-card-discharged .discharge-days { opacity: 0.95; }
.patient-card-discharge-date .patient-card-discharged-badge {
  font-size: .65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: var(--text-3);
  background: rgba(0,0,0,.06);
  padding: 3px 8px;
  border-radius: 4px;
  margin-right: 6px;
}
.patient-card-name-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
  min-width: 0;
}
.patient-card-name-row .patient-card-name { margin-bottom: 0; flex: 1; min-width: 0; }
.patient-card-discharge-date {
  flex-shrink: 0;
  font-size: .8rem;
  color: var(--text-3);
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.patient-card-discharge-date i { font-size: .75rem; opacity: .9; }

.patient-card-name {
  font-weight: 700;
  font-size: 1.02rem;
  margin-bottom: 10px;
  word-break: break-word;
  line-height: 1.3;
  color: var(--text);
}
.patient-card-name .badge-my-patient { margin-left: 6px; }
.patient-card-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 8px;
  font-size: .85rem;
}
.patient-card-row:last-child { margin-bottom: 0; }
.patient-card-label {
  color: var(--text-3);
  flex: 0 0 80px;
  min-width: 0;
}
.patient-card-diagnosis {
  color: var(--text);
  word-break: break-word;
  flex: 1;
  min-width: 0;
}
.discharge-days {
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 6px;
  font-size: .8rem;
}
.discharge-days-overdue { background: var(--accent-bg); color: var(--accent); }
.discharge-days-urgent { background: var(--accent-bg); color: var(--accent); }
.discharge-days-warning { background: var(--amber-bg); color: var(--amber); }
.discharge-days-ok { background: var(--green-bg); color: var(--green); }
.discharge-days-none { color: var(--text-3); background: transparent; }
.discharge-status-delayed { background: var(--amber-bg); color: var(--amber); }
.discharge-status-early { background: var(--green-bg); color: var(--green); }
.discharge-status-done { color: var(--text-2); background: var(--grey-bg); }
.patient-card-row .discharge-sub { font-size: .8rem; color: var(--text-3); font-weight: 400; margin-left: 4px; }

/* Status badges */
.status-badge { display: inline-block; padding: 3px 12px; border-radius: var(--radius-pill); font-size: .73rem; font-weight: 600; }
.status-active { background: var(--green-bg); color: var(--green); }
.status-discharged { background: var(--grey-bg); color: var(--grey); }
.task-status-todo { background: var(--grey-bg); color: var(--grey); }
.task-status-in_progress { background: var(--amber-bg); color: var(--amber); }
.task-status-done { background: var(--green-bg); color: var(--green); }

/* ═══ Tasks — JIRA-style Board + List ═══════════════════════════════ */
.tasks-toolbar { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
.tasks-toolbar-left { display: flex; align-items: center; gap: 14px; flex-wrap: wrap; }
.tasks-view-toggle { display: inline-flex; background: var(--bg-subtle); border-radius: 10px; padding: 3px; gap: 0; }
.tasks-view-btn {
  margin: 0; padding: 7px 16px; border-radius: 8px; font-size: .82rem;
  border: none; background: transparent; color: var(--text-2); font-weight: 500; cursor: pointer; transition: all var(--transition);
}
.tasks-view-btn.active { background: var(--card); color: var(--primary); font-weight: 600; box-shadow: var(--shadow-sm); }

/* Board */
.tasks-board-wrap { min-height: 400px; }
.task-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; align-items: start; }
@media (max-width: 900px) { .task-board { grid-template-columns: 1fr; } .task-board-column { min-height: 120px; } }
.task-board-column {
  background: var(--bg-subtle); border-radius: var(--radius); border: 1px solid var(--border);
  min-height: 280px; display: flex; flex-direction: column; overflow: hidden;
}
.task-board-column[data-status="todo"] { border-top: 3px solid var(--grey); }
.task-board-column[data-status="in_progress"] { border-top: 3px solid var(--amber); }
.task-board-column[data-status="done"] { border-top: 3px solid var(--green); }
.task-board-col-hd {
  display: flex; align-items: center; justify-content: space-between; gap: 8px;
  padding: 12px 16px; flex-shrink: 0; border-bottom: 1px solid var(--border);
}
.task-board-col-title { font-weight: 700; font-size: .85rem; letter-spacing: .02em; display: flex; align-items: center; gap: 8px; }
.task-board-col-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.task-board-col-dot.dot-todo { background: var(--grey); }
.task-board-col-dot.dot-in_progress { background: var(--amber); }
.task-board-col-dot.dot-done { background: var(--green); }
.task-board-col-count {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-pill);
  font-size: .72rem; font-weight: 600; color: var(--text-3); padding: 2px 9px; min-width: 20px; text-align: center;
}
.task-board-cards { padding: 12px; display: flex; flex-direction: column; gap: 10px; flex: 1; min-height: 0; overflow-y: auto; }
.task-board-empty { padding: 32px 16px; text-align: center; color: var(--text-3); font-size: .82rem; }
.task-board-empty i { display: block; font-size: 1.5rem; margin-bottom: 8px; opacity: .4; }

/* Card */
.task-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm);
  padding: 12px 14px; cursor: pointer;
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--transition), border-color var(--transition), transform var(--transition);
  border-left: 3px solid var(--border);
}
.task-card.priority-card-high { border-left-color: var(--accent); }
.task-card.priority-card-medium { border-left-color: var(--amber); }
.task-card.priority-card-low { border-left-color: var(--green); }
.task-card:hover { box-shadow: var(--shadow); border-color: var(--primary); border-left-color: var(--primary); transform: translateY(-2px); }
.task-card-top { display: flex; align-items: center; justify-content: space-between; gap: 6px; margin-bottom: 6px; }
.task-card-key { font-size: .72rem; color: var(--text-3); font-weight: 600; font-family: 'Courier New', monospace; }
.task-card-priority-icon { font-size: .72rem; }
.task-card-priority-icon.priority-high { color: var(--accent); }
.task-card-priority-icon.priority-medium { color: var(--amber); }
.task-card-priority-icon.priority-low { color: var(--green); }
.task-card-title { font-weight: 600; font-size: .88rem; color: var(--text); line-height: 1.4; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.task-card-footer { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.task-card-tag {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: .72rem; color: var(--text-3); background: var(--bg-subtle); border-radius: 6px; padding: 3px 8px;
}
.task-card-tag i { font-size: .65rem; }
.task-card-avatar {
  width: 22px; height: 22px; border-radius: 50%; background: var(--primary-bg); color: var(--primary);
  font-size: .65rem; font-weight: 700; display: flex; align-items: center; justify-content: center; margin-left: auto; flex-shrink: 0;
}

/* List view */
.task-list-table .task-list-row { cursor: pointer; transition: background var(--transition); }
.task-list-row:hover td { background: var(--primary-bg); }
.task-list-key { font-weight: 600; color: var(--primary); font-size: .82rem; font-family: 'Courier New', monospace; }
.task-priority-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: var(--radius-pill); font-size: .72rem; font-weight: 600; }
.task-priority-badge.priority-high { background: var(--accent-bg); color: var(--accent); }
.task-priority-badge.priority-medium { background: var(--amber-bg); color: var(--amber); }
.task-priority-badge.priority-low { background: var(--green-bg); color: var(--green); }

/* ═══ Task detail page (task.html) ═══════════════════════════════════ */
.task-page .topbar-no-sidebar { left: 0; }
.task-page .main-content-center { max-width: 900px; margin-left: auto; margin-right: auto; box-sizing: border-box; }
.task-app { display: flex; flex-direction: column; min-height: 100vh; min-width: 0; }

/* Two-column layout: main | sidebar */
.task-detail-layout { display: grid; grid-template-columns: 1fr 280px; gap: 20px; align-items: start; }
@media (max-width: 768px) { .task-detail-layout { grid-template-columns: 1fr; } }

/* Main panel */
.task-detail-main {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  padding: 28px; box-shadow: var(--shadow-sm);
}
.task-detail-breadcrumb { display: flex; align-items: center; gap: 6px; font-size: .78rem; color: var(--text-3); margin-bottom: 14px; }
.task-detail-breadcrumb a { color: var(--primary); text-decoration: none; }
.task-detail-breadcrumb a:hover { text-decoration: underline; }
.task-detail-key { font-size: .82rem; font-weight: 700; color: var(--primary); font-family: 'Courier New', monospace; }
.task-detail-title-wrap { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 20px; }
.task-detail-title {
  font-size: 1.4rem; font-weight: 700; margin: 0; color: var(--text); line-height: 1.35; flex: 1;
  border: 2px solid transparent; border-radius: 10px; padding: 4px 8px; margin: -4px -8px;
  transition: border-color var(--transition), background var(--transition);
}
.task-detail-title:hover { background: var(--bg-subtle); }
.task-detail-title:focus { outline: none; border-color: var(--primary); background: var(--card); box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.task-detail-title-save { display: none; align-self: center; }
.task-detail-title-wrap.editing .task-detail-title-save { display: inline-flex; }

/* Description area */
.task-detail-desc-section { margin-top: 20px; }
.task-detail-desc-label { font-size: .78rem; font-weight: 600; color: var(--text-3); text-transform: uppercase; letter-spacing: .04em; margin-bottom: 10px; }
.task-detail-desc-view {
  background: var(--bg-subtle); padding: 18px; border-radius: 12px;
  font-size: .9rem; line-height: 1.7; color: var(--text-2); white-space: pre-wrap; word-break: break-word;
  min-height: 60px; cursor: pointer; border: 2px solid transparent;
  transition: border-color var(--transition);
}
.task-detail-desc-view:hover { border-color: var(--border); }
.task-detail-desc-edit { display: none; }
.task-detail-desc-edit textarea {
  width: 100%; box-sizing: border-box; min-height: 120px; font-family: inherit;
  font-size: .9rem; line-height: 1.6; padding: 16px; border: 2px solid var(--primary);
  border-radius: 12px; resize: vertical; background: var(--card);
  box-shadow: 0 0 0 3px rgba(20,184,166,.12);
}
.task-detail-desc-actions { display: flex; gap: 8px; margin-top: 8px; }

/* Sidebar panel */
.task-detail-sidebar {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm); overflow: hidden;
}
.task-detail-sidebar-hd {
  padding: 16px 18px; font-weight: 700; font-size: .82rem; letter-spacing: .02em;
  color: var(--text-2); border-bottom: 1px solid var(--border); background: var(--bg-subtle);
}
.task-detail-sidebar-body { padding: 0; }
.task-detail-field {
  padding: 12px 16px; border-bottom: 1px solid var(--border);
}
.task-detail-field:last-child { border-bottom: none; }
.task-detail-field label {
  display: block; font-size: .72rem; font-weight: 600; color: var(--text-3);
  text-transform: uppercase; letter-spacing: .04em; margin-bottom: 6px;
}
.task-detail-field .fi { width: 100%; font-size: .85rem; }
.task-detail-field-value {
  font-size: .88rem; color: var(--text); display: flex; align-items: center; gap: 6px;
}
.task-detail-link { color: var(--primary); text-decoration: none; font-weight: 500; }
.task-detail-link:hover { text-decoration: underline; }

/* Footer */
.task-detail-footer-bar {
  display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px;
  margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); font-size: .8rem;
}
.task-detail-meta-text { color: var(--text-3); }
.task-detail-danger-actions { display: flex; gap: 8px; }

/* ─── Table ───────────────────────────────────────────────────── */
.table-wrap {
  overflow-x: auto; -webkit-overflow-scrolling: touch; max-width: 100%; contain: layout;
  background: var(--card); border-radius: var(--radius); border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
table { width: 100%; border-collapse: collapse; font-size: .85rem; }
th {
  text-align: left; padding: 10px 14px; font-weight: 600; color: var(--text-3);
  border-bottom: 1px solid var(--border); font-size: .75rem;
  letter-spacing: .05em; text-transform: uppercase; word-break: normal; overflow-wrap: break-word; min-width: 3.5em;
  background: var(--bg-subtle); position: sticky; top: 0; z-index: 2;
}
th:first-child { border-radius: var(--radius) 0 0 0; }
th:last-child { border-radius: 0 var(--radius) 0 0; }
td { padding: 10px 14px; border-bottom: 1px solid var(--border); vertical-align: middle; word-break: normal; overflow-wrap: break-word; min-width: 3.5em; }
tbody tr:nth-child(even) td { background: var(--bg-subtle); }
tr:hover td { background: var(--primary-bg); }
tr.clickable { cursor: pointer; }

/* ─── Patient List ────────────────────────────────────────────── */
.patients-toolbar {
  display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;
}
.patients-toolbar .search-box { flex: 1; min-width: 0; max-width: 400px; }
.patients-toolbar .btn { flex-shrink: 0; }

.list-toolbar {
  display: flex; align-items: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap;
}
.search-box {
  flex: 1; min-width: 0; position: relative; max-width: 100%;
}
.search-box input {
  width: 100%; padding: 9px 14px 9px 38px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem; background: var(--card);
  transition: border-color var(--transition), box-shadow var(--transition);
}
.search-box input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.1); }
.search-box i {
  position: absolute; left: 13px; top: 50%; transform: translateY(-50%);
  color: var(--text-3); font-size: .82rem;
}
.filter-select {
  padding: 9px 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .85rem; background: var(--card); color: var(--text);
  transition: border-color var(--transition), box-shadow var(--transition);
  appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
}
.filter-select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.1); }

/* ─── Patient Detail ──────────────────────────────────────────── */
#page-patient-detail > #pd-header { width: 100%; max-width: 100%; box-sizing: border-box; }
.patient-header {
  display: flex; flex-direction: column; gap: 14px; margin-bottom: 20px; width: 100%; max-width: 100%; box-sizing: border-box;
}
.patient-header-top {
  display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; width: 100%; max-width: 100%; box-sizing: border-box;
}
.patient-header-top .risk-badge { flex-shrink: 0; }
.patient-header-top .patient-actions { flex-shrink: 0; display: flex; gap: 8px; align-items: center; }
.patient-details-vertical {
  display: flex; flex-direction: column; gap: 6px;
}
.patient-detail-row { font-size: .9rem; display: flex; align-items: baseline; gap: 10px; flex-wrap: wrap; }
.patient-detail-label { color: var(--text-3); font-size: .85rem; flex: 0 0 180px; min-width: 0; white-space: nowrap; }
.patient-detail-value { color: var(--text); word-break: break-word; min-width: 0; }
.patient-header h2 { font-size: 1.3rem; font-weight: 700; word-break: normal; overflow-wrap: break-word; min-width: 0; }
.patient-meta { display: flex; gap: 16px; flex-wrap: wrap; color: var(--text-2); font-size: .85rem; }
.patient-meta span { display: flex; align-items: center; gap: 4px; word-break: normal; overflow-wrap: break-word; white-space: normal; }
.patient-actions { flex-shrink: 0; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

.patient-detail-bottom { margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border); }
.patient-detail-bottom-actions { display: flex; align-items: center; justify-content: center; gap: 8px; }

.tab-bar {
  display: flex; gap: 4px; margin-bottom: 22px;
  overflow-x: auto; overflow-y: hidden; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; max-width: 100%;
  align-items: stretch; min-height: 42px;
  background: var(--bg-subtle); border-radius: 12px; padding: 4px;
}
.tab-bar::-webkit-scrollbar { height: 4px; }
.tab-btn {
  flex: 0 0 auto; padding: 8px 18px; border: none; background: none; font-size: .85rem;
  font-weight: 500; color: var(--text-3); white-space: nowrap; cursor: pointer;
  border-radius: 8px; transition: all var(--transition);
}
.tab-btn:hover { color: var(--text); background: rgba(255,255,255,.5); }
.tab-btn.active { color: var(--primary); background: var(--card); font-weight: 600; box-shadow: var(--shadow-sm); }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeUp .2s ease; }

/* Trend chart (overview – reports by week) */
.trend-chart {
  display: flex; flex-direction: column; gap: 10px;
  padding: 12px 0; border-left: 3px solid var(--primary); padding-left: 14px; margin-left: 2px;
}
.trend-scale {
  display: flex; justify-content: space-between; align-items: center;
  font-size: .7rem; color: var(--text-3); margin-bottom: 4px; padding-right: 2.5em;
}
.trend-scale-max { font-variant-numeric: tabular-nums; }
.trend-row {
  display: flex; align-items: center; gap: 10px;
  min-height: 32px;
}
.trend-label {
  flex: 0 0 110px; font-size: .8rem; color: var(--text-2);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.trend-bar-wrap {
  flex: 1; min-width: 0; height: 22px; background: var(--border); border-radius: 6px; overflow: hidden;
  display: block;
}
.trend-bar {
  display: block; height: 22px; min-height: 22px; min-width: 6px;
  background: var(--primary); border-radius: 6px;
  transition: width .3s ease;
}
.trend-value {
  flex: 0 0 2.2em; font-size: .9rem; font-weight: 700; color: var(--primary);
  text-align: right;
}
.trend-empty { margin: 0; color: var(--text-3); font-size: .9rem; }

/* ─── Forms ───────────────────────────────────────────────────── */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-grid .fg-full { grid-column: 1 / -1; }
.fg textarea {
  width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem; resize: vertical; min-height: 80px;
  background: var(--bg); transition: border-color var(--transition), box-shadow var(--transition);
}
.fg textarea:focus { border-color: var(--primary); outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.fg select {
  width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem; background: var(--bg);
  transition: border-color var(--transition), box-shadow var(--transition);
  appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
}
.fg select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }

/* Rating rows (psychiatric/behavioral) */
.rating-row {
  display: flex; align-items: center; gap: 10px; padding: 8px 0;
  border-bottom: 1px solid var(--border);
}
.rating-row:last-child { border-bottom: none; }
.rating-label { flex: 1; font-size: .88rem; font-weight: 500; }
.rating-btns { display: flex; gap: 4px; }
.rating-btn {
  width: 34px; height: 34px; border-radius: 8px; border: 1.5px solid var(--border);
  background: var(--card); font-size: .82rem; font-weight: 600; cursor: pointer;
  transition: all var(--transition); color: var(--text-2);
}
.rating-btn:hover { border-color: var(--primary); }
.rating-btn.selected { background: var(--primary); color: #fff; border-color: var(--primary); }

/* ADL level select */
.adl-row {
  display: flex; align-items: center; justify-content: space-between; gap: 10px;
  padding: 8px 0; border-bottom: 1px solid var(--border);
}
.adl-row:last-child { border-bottom: none; }
.adl-label { font-size: .88rem; font-weight: 500; }
.adl-select {
  padding: 7px 12px; border: 1.5px solid var(--border); border-radius: 8px;
  font-size: .82rem; background: var(--card);
}

/* ─── Chat (WhatsApp-style: channels pinned top, input fixed bottom) ── */
.chat-layout { display: flex; gap: 16px; height: calc(100vh - var(--safe-top) - var(--topbar-h) - 120px); min-height: 400px; }
.chat-layout-wa { display: block; height: calc(100vh - var(--safe-top) - var(--topbar-h) - 100px); min-height: 360px; }
.chat-layout-wa .chat-main {
  display: flex; flex-direction: column; height: 100%;
  background: var(--card); border-radius: 16px; border: 1px solid var(--border);
  overflow: hidden; box-shadow: var(--shadow-sm);
}
.channel-list {
  width: 200px; flex-shrink: 0; background: var(--card); border-radius: 16px;
  border: 1px solid var(--border); overflow-y: auto;
}
.channel-list-pinned {
  width: 100%; flex-shrink: 0; flex-direction: row; flex-wrap: nowrap;
  overflow-x: auto; overflow-y: hidden; padding: 10px 14px; gap: 8px;
  border-bottom: 1px solid var(--border); background: var(--bg-subtle);
  -webkit-overflow-scrolling: touch;
}
.channel-list-pinned .channel-item {
  flex: 0 0 auto; padding: 8px 16px; border-radius: var(--radius-pill); border: 1px solid var(--border);
  border-bottom: none; white-space: nowrap;
}
.channel-list-pinned .channel-item.active { border-color: var(--primary); background: var(--primary-bg); }
.channel-list-pinned .channel-unread { margin-left: 6px; }
.channel-item {
  padding: 10px 14px; cursor: pointer; font-size: .88rem; border-bottom: 1px solid var(--border);
  transition: background var(--transition); display: flex; align-items: center; gap: 8px;
}
.channel-item:hover { background: var(--bg-subtle); }
.channel-item.active { background: var(--primary-bg); color: var(--primary); font-weight: 600; }
.channel-item:last-child { border-bottom: none; }
.channel-unread {
  margin-left: auto; background: var(--accent); color: #fff; font-size: .7rem; font-weight: 700;
  min-width: 18px; padding: 2px 7px; border-radius: var(--radius-pill); text-align: center;
}
.chat-main { flex: 1; display: flex; flex-direction: column; background: var(--card); border-radius: 16px; border: 1px solid var(--border); }
.chat-header { padding: 14px 18px; border-bottom: 1px solid var(--border); font-weight: 700; font-size: .95rem; flex-shrink: 0; }
.msg-list { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; min-height: 0; }
.chat-compose-fixed { flex-shrink: 0; border-top: 1px solid var(--border); }
.msg-wrap { display: flex; }
.msg-wrap.mine { justify-content: flex-end; }
.msg-bubble {
  max-width: 70%; padding: 10px 14px; border-radius: 16px;
  font-size: .88rem; line-height: 1.45;
}
.msg-bubble.theirs { background: var(--bg-subtle); border-bottom-left-radius: 4px; color: var(--text); }
.msg-bubble.mine { background: var(--primary); color: #fff; border-bottom-right-radius: 4px; }
.msg-bubble.urgent { background: var(--accent-bg); border: 1px solid var(--accent); color: var(--text); }
.msg-bubble.mine.urgent { background: #c53030; border-color: #a82828; color: #fff; }
.msg-meta { font-size: .7rem; margin-top: 4px; opacity: .7; }
.chat-compose {
  display: flex; align-items: center; gap: 10px; padding: 14px 18px;
  border-top: 1px solid var(--border);
}
.chat-compose input {
  flex: 1; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: 10px; font-size: .88rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}
.chat-compose input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.urgent-toggle {
  display: flex; align-items: center; gap: 4px; padding: 7px 12px; border-radius: 10px;
  border: 1.5px solid var(--border); background: var(--card); font-size: .78rem; cursor: pointer;
  color: var(--text-3); transition: all var(--transition);
}
.urgent-toggle.active { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ─── Family Report ───────────────────────────────────────────── */
.fr-controls { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
.fr-controls select, .fr-controls input { padding: 9px 14px; border: 1.5px solid var(--border); border-radius: 10px; font-size: .85rem; }
.lbtn {
  padding: 7px 16px; border: 1.5px solid var(--border); border-radius: var(--radius-pill);
  background: var(--card); font-size: .82rem; cursor: pointer; transition: all var(--transition);
}
.lbtn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
.fr-preview { margin-top: 16px; max-width: 100%; }
.fr-report-content { max-width: 100%; overflow-x: hidden; }
.rh { background: var(--primary); color: #fff; padding: 26px; border-radius: 16px 16px 0 0; text-align: center; overflow-wrap: break-word; }
.rh-c { font-size: .85rem; opacity: .85; margin-bottom: 4px; }
.rh-t { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; }
.rh-d, .rh-s { font-size: .82rem; opacity: .9; }
.frs { margin-bottom: 14px; }
.frs-t { font-weight: 600; margin-bottom: 4px; color: var(--primary); }
.frs-b { font-size: .88rem; color: var(--text-2); line-height: 1.5; }
.pbw { margin-bottom: 10px; }
.pbt { display: flex; justify-content: space-between; font-size: .82rem; margin-bottom: 4px; }
.pbtr { height: 8px; background: var(--grey-bg); border-radius: 4px; overflow: hidden; }
.pbf { height: 100%; background: var(--primary); border-radius: 4px; transition: width .5s ease; }
.wt { font-size: .82rem; }
.wt .chg { color: var(--green); font-weight: 600; }
.tipr { display: flex; gap: 10px; align-items: flex-start; margin-bottom: 10px; }
.tipn { width: 24px; height: 24px; border-radius: 50%; background: var(--primary); color: #fff; display: flex; align-items: center; justify-content: center; font-size: .72rem; font-weight: 700; flex-shrink: 0; }
.tipt { font-size: .85rem; color: var(--text-2); }
.fr-foot { text-align: center; font-size: .78rem; color: var(--text-3); padding: 16px 0; border-top: 1px solid var(--border); margin-top: 16px; }
.alert { padding: 14px 18px; border-radius: 12px; font-size: .85rem; margin-bottom: 14px; }
.alert-warn { background: var(--amber-bg); color: var(--amber); }
.alert-info { background: var(--primary-bg); color: var(--primary); }
.alert-danger { background: var(--accent-bg); color: var(--accent); }

/* ─── Searchable dropdown ─────────────────────────────────────── */
.searchable-select { position: relative; }
.searchable-options {
  position: absolute; left: 0; right: 0; top: 100%; z-index: 100;
  max-height: 200px; overflow-y: auto; margin: 0; padding: 4px 0;
  list-style: none; background: var(--card); border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); box-shadow: var(--shadow-md); display: none;
}
.searchable-option {
  padding: 8px 12px; font-size: .88rem; cursor: pointer;
  transition: background var(--transition);
}
.searchable-option:hover { background: var(--primary-bg); color: var(--primary); }

/* ─── Admin Panel ─────────────────────────────────────────────── */
.staff-table td { vertical-align: middle; }
.role-badge {
  display: inline-block; padding: 2px 10px; border-radius: 12px;
  font-size: .75rem; font-weight: 600; text-transform: capitalize;
  background: var(--primary-bg); color: var(--primary);
}

/* ─── Settings ────────────────────────────────────────────────── */
.set-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.set-title { font-weight: 700; font-size: .95rem; }
.set-badge {
  background: var(--primary-bg); color: var(--primary); font-size: .75rem;
  font-weight: 700; padding: 2px 8px; border-radius: 10px;
}
.set-desc { font-size: .82rem; color: var(--text-3); margin-bottom: 12px; }
.role-check-group { display: flex; flex-wrap: wrap; gap: 10px 16px; }
.role-check { display: inline-flex; align-items: center; gap: 6px; font-size: .88rem; cursor: pointer; }
.role-check input { margin: 0; }
.diagnosis-history-list { list-style: none; padding: 0; margin: 0; }
.diagnosis-history-list li { padding: 8px 0; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 2px; }
.diagnosis-history-list li:last-child { border-bottom: none; }
.diagnosis-history-text { font-weight: 500; }
.diagnosis-history-meta { font-size: .8rem; color: var(--text-3); }

.diagnosis-consult-list { display: flex; flex-direction: column; gap: 14px; }
.diagnosis-consult-card {
  padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm);
  background: var(--card); display: flex; flex-direction: column; gap: 8px;
}
.diagnosis-consult-head {
  display: flex; flex-wrap: wrap; align-items: center; gap: 12px; font-size: .85rem; color: var(--text-2);
}
.diagnosis-consult-date { display: inline-flex; align-items: center; gap: 6px; }
.diagnosis-consult-by { color: var(--text-3); }
.diagnosis-consult-diagnosis { font-size: .9rem; }
.diagnosis-consult-notes {
  font-size: .88rem; color: var(--text-2); line-height: 1.5;
  padding: 10px 12px; background: var(--grey-bg); border-radius: var(--radius-sm); margin-top: 4px;
}

.status-consult-item { margin-bottom: 12px; }
.status-consult-item:last-child { margin-bottom: 0; }
.status-consult-note { font-size: .82rem; color: var(--text-2); margin: 6px 0 0 0; padding-left: 0; line-height: 1.45; }

/* Consultation notes — chat-like structure */
.consult-latest-diagnosis { font-size: .9rem; color: var(--text); margin-bottom: 16px; padding: 10px 12px; background: var(--grey-bg); border-radius: var(--radius-sm); line-height: 1.45; }
.consult-diagnosis-list { list-style: disc; margin: 0; padding-left: 20px; }
.consult-diagnosis-list li { margin-bottom: 4px; }
.consult-diagnosis-list li:last-child { margin-bottom: 0; }
.consult-no-diagnosis { color: var(--text-3); }
.consult-notes-hd { margin-top: 4px; }
.consult-chat { display: flex; flex-direction: column; gap: 12px; }
.consult-chat-msg { padding: 10px 14px; background: var(--grey-bg); border-radius: 12px; border: 1px solid var(--border); max-width: 100%; }
.consult-chat-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 6px; font-weight: 500; }
.consult-chat-body { font-size: .88rem; color: var(--text-2); line-height: 1.5; white-space: pre-wrap; word-break: break-word; }
.consult-no-note { font-style: italic; color: var(--text-3); }

/* Patient Notes (Comments) tab — chat-like, full window height */
.patient-notes-wrap {
  display: flex; flex-direction: column;
  min-height: calc(100vh - var(--topbar-h) - var(--safe-top) - 180px);
  min-height: calc(100dvh - var(--topbar-h) - var(--safe-top) - 180px);
}
.patient-notes-list { flex: 1; overflow-y: auto; padding: 12px 0; display: flex; flex-direction: column; gap: 10px; min-height: 0; }
.patient-notes-empty { padding: 24px 16px !important; flex: 1; display: flex; align-items: center; justify-content: center; }
.patient-notes-compose { display: flex; gap: 10px; align-items: flex-end; padding: 12px 0; border-bottom: 1px solid var(--border); flex-shrink: 0; }
.patient-notes-textarea { flex: 1; min-height: 56px; resize: vertical; max-height: 120px; }
.patient-note-msg { padding: 12px 16px; background: var(--bg-subtle); border-radius: 14px; border: 1px solid var(--border); max-width: 95%; }
.patient-note-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 4px; font-weight: 500; }
.patient-note-text { font-size: .88rem; color: var(--text-2); line-height: 1.5; white-space: pre-wrap; word-break: break-word; }

.modal-card-wide { width: 520px; max-width: calc(100vw - 40px); min-width: 0; }
.pd-add-report-section-wrap { display: flex; align-items: center; gap: 10px; }
.pd-add-report-section-icon { color: var(--text-2); font-size: 1rem; }
.pd-add-report-section-wrap .fi { flex: 1; min-width: 0; }
.modal-sub { font-size: .88rem; color: var(--text-3); margin-bottom: 16px; }

.list-item {
  display: flex; align-items: center; gap: 6px; padding: 6px 0;
  border-bottom: 1px solid var(--border);
}
.list-item:last-child { border-bottom: none; }
.li-txt {
  flex: 1; border: 1px solid transparent; background: none; padding: 4px 8px;
  border-radius: 6px; font-size: .85rem;
}
.li-txt:focus { border-color: var(--primary); background: var(--card); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.li-up, .li-dn, .li-del {
  width: 28px; height: 28px; border: none; background: var(--bg-subtle);
  border-radius: 6px; cursor: pointer; font-size: .82rem; transition: background var(--transition);
}
.li-up:hover, .li-dn:hover { background: var(--primary-bg); color: var(--primary); }
.li-del:hover { background: var(--accent-bg); color: var(--accent); }
.add-row { display: flex; gap: 8px; margin-top: 10px; }
.add-inp {
  flex: 1; padding: 9px 12px; border: 1.5px solid var(--border);
  border-radius: 10px; font-size: .85rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}
.add-inp:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.settings-actions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 16px; }

/* ─── Modal ───────────────────────────────────────────────────── */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,.4);
  backdrop-filter: blur(6px);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  padding-left: max(20px, env(safe-area-inset-left, 0px));
  padding-right: max(20px, env(safe-area-inset-right, 0px));
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
}
.modal-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

#modal-container {
  width: 100%;
  max-width: 520px;
  min-width: 0;
  flex-shrink: 0;
}
#modal-container:has(.modal-card-task) {
  max-width: 600px;
}

.modal-card {
  background: var(--card); border-radius: var(--radius-lg); padding: 28px;
  width: 100%;
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
  max-height: 90vh; overflow-y: auto;
  overflow-x: hidden;
  overflow-wrap: break-word;
  word-break: break-word;
  animation: modalSlideUp .2s cubic-bezier(.4,0,.2,1);
}
@keyframes modalSlideUp {
  from { opacity: 0; transform: translateY(10px) scale(.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.modal-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 14px; letter-spacing: -.01em; }
.modal-body { font-size: .88rem; color: var(--text-2); line-height: 1.55; margin-bottom: 22px; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

/* Prevent form content from affecting modal width */
#pd-add-report-form-wrap,
#pd-add-report-form-wrap .ct-card,
.modal-card .form-grid,
.modal-card .rating-row,
.modal-card .adl-row { min-width: 0; overflow-x: hidden; }

/* Modal on mobile: same approach, margin from overlay padding */
@media (max-width: 768px) {
  .modal-overlay {
    padding: 16px;
    padding-left: max(16px, env(safe-area-inset-left, 0px));
    padding-right: max(16px, env(safe-area-inset-right, 0px));
  }
  .modal-card {
    padding: 22px;
    max-height: 85vh;
    border-radius: 18px;
  }
}

@media (max-width: 480px) {
  .modal-overlay {
    padding: 12px;
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
  }
  .modal-card { padding: 18px; border-radius: 16px; }
}

/* ─── Toast ───────────────────────────────────────────────────── */
#toast {
  position: fixed; bottom: calc(24px + var(--bottom-nav-h)); right: 24px; background: var(--text);
  color: #fff; padding: 10px 22px; border-radius: var(--radius-sm); font-size: .85rem;
  font-weight: 500; z-index: 300; opacity: 0; transform: translateY(10px);
  pointer-events: none; transition: all .25s ease;
  box-shadow: var(--shadow-lg);
}
#toast[data-show="true"] { opacity: 1; transform: translateY(0); pointer-events: auto; }

/* ─── PWA Install banner ───────────────────────────────────────── */
.pwa-install-banner {
  position: fixed; bottom: calc(24px + var(--safe-bottom)); left: 50%; transform: translateX(-50%);
  z-index: 290; width: calc(100% - 32px); max-width: 420px;
  box-shadow: var(--shadow-md); border-radius: 18px;
  background: var(--card); border: 1px solid var(--border);
  padding: 18px; animation: slideUpBanner .3s ease;
}
.pwa-install-banner[hidden] { display: none !important; }
@keyframes slideUpBanner { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
.pwa-install-inner { position: relative; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.pwa-install-icon {
  width: 44px; height: 44px; border-radius: 12px; flex-shrink: 0;
  background: var(--primary-bg); color: var(--primary);
  display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
}
.pwa-install-text { flex: 1; min-width: 0; }
.pwa-install-text strong { display: block; font-size: .95rem; margin-bottom: 2px; }
.pwa-install-text span { font-size: .8rem; color: var(--text-3); }
.pwa-install-actions { display: flex; gap: 8px; align-items: center; }
.pwa-install-close {
  position: absolute; top: -8px; right: -8px;
  width: 28px; height: 28px; border: none; border-radius: 50%;
  background: var(--grey-bg); color: var(--text-2); font-size: .8rem;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: background var(--transition);
}
.pwa-install-close:hover { background: var(--accent-bg); color: var(--accent); }
@media (max-width: 480px) {
  .pwa-install-banner { bottom: calc(16px + var(--safe-bottom)); width: calc(100% - 24px); padding: 12px; }
  .pwa-install-actions { width: 100%; justify-content: flex-end; }
}

/* ─── Report History ──────────────────────────────────────────── */
.hist-total { font-size: .85rem; font-weight: 600; color: var(--text-2); }
.hist-date-group { margin-bottom: 20px; }
.hist-date-group:last-child { margin-bottom: 0; }
.hist-date-header {
  font-size: .8rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: .04em;
  margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid var(--border);
}
.report-timeline { position: relative; }
.report-entry {
  padding: 16px 18px; border-left: 3px solid var(--primary-bg); margin-left: 8px;
  margin-bottom: 14px; background: var(--card); border-radius: 0 12px 12px 0;
  box-shadow: var(--shadow-sm);
  word-break: normal; overflow-wrap: break-word;
}
.report-entry-hd {
  display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;
}
.report-entry-hd strong { font-size: .88rem; }
.report-entry-time { font-size: .78rem; color: var(--text-3); }
.report-entry-body { font-size: .85rem; color: var(--text-2); line-height: 1.4; word-break: normal; overflow-wrap: break-word; }
.report-entry.clickable { cursor: pointer; }
.report-entry.clickable:hover { background: var(--grey-bg); }

.report-detail-modal .report-detail-meta { margin-bottom: 16px; font-size: .9rem; color: var(--text-2); }
.report-detail-modal .report-detail-meta p { margin: 4px 0; }
.report-detail-modal .report-detail-body { max-height: 60vh; overflow-y: auto; }
.report-detail-table { width: 100%; border-collapse: collapse; font-size: .88rem; margin-top: 8px; }
.report-detail-table td { padding: 6px 10px; border-bottom: 1px solid var(--border); vertical-align: top; }
.report-detail-table td:first-child { color: var(--text-2); width: 40%; }

.latest-summary-list { max-height: 55vh; overflow-y: auto; }
.latest-summary-item {
  padding: 12px 0; border-bottom: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 6px;
}
.latest-summary-item:last-child { border-bottom: none; }
.latest-summary-hd {
  display: flex; align-items: center; flex-wrap: wrap; gap: 8px;
}
.latest-summary-body { font-size: .88rem; color: var(--text-2); margin: 0; line-height: 1.45; }
.status-section-item .status-section-detail { margin-top: 6px; }
.status-section-item .report-detail-table { margin-top: 4px; }
.status-inline {
  display: flex; flex-wrap: wrap; gap: 8px 16px; align-items: baseline;
  font-size: .88rem; color: var(--text-2); line-height: 1.5;
}
.status-kv {
  display: inline-flex; align-items: baseline; gap: 4px;
  padding: 4px 10px; border-radius: var(--radius-sm);
  background: var(--grey-bg); color: var(--text);
}
.status-kv .status-meta { font-size: .78rem; color: var(--text-3); font-weight: normal; }
.status-empty { margin: 0; padding: 6px 0; font-size: .85rem; color: var(--text-3); }
.status-diagnosis-block { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.status-sub-hd { font-size: .85rem; font-weight: 600; color: var(--text-2); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }

.load-more-btn {
  display: block; margin: 12px auto; padding: 8px 24px;
}

/* ─── Empty state ─────────────────────────────────────────────── */
.empty-state {
  text-align: center; padding: 48px 24px; color: var(--text-3);
}
.empty-state i { font-size: 2.5rem; margin-bottom: 14px; display: block; opacity: .6; }
.empty-state p { font-size: .9rem; }

/* Reports page — horizontal patient cards */
.reports-patient-cards-wrap { width: 100%; overflow: hidden; }
.reports-patient-cards {
  display: flex; gap: 12px; overflow-x: auto; padding: 8px 0;
  -webkit-overflow-scrolling: touch; scroll-snap-type: x proximity;
}
.reports-patient-card {
  flex: 0 0 auto; width: 200px; min-height: 100px; padding: 16px;
  background: var(--card); border: 1px solid var(--border); border-radius: 14px;
  box-shadow: var(--shadow-sm); scroll-snap-align: start; cursor: pointer;
  transition: box-shadow var(--transition), transform var(--transition);
}
.reports-patient-card:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
.reports-patient-card .card-name { font-weight: 700; font-size: .95rem; margin-bottom: 4px; }
.reports-patient-card .card-meta { font-size: .8rem; color: var(--text-3); margin-bottom: 6px; }
.reports-patient-card .card-summary { font-size: .78rem; color: var(--text-2); }
.reports-patient-card .badge-my-patient { margin-left: 6px; }

/* ─── Welcome banner ─────────────────────────────────────────── */
.welcome-banner {
  background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #14b8a6 100%);
  border-radius: var(--radius-lg); padding: 24px 28px; margin-bottom: 20px;
  color: #fff; position: relative; overflow: hidden;
}
.welcome-banner::after {
  content: ''; position: absolute; top: -40%; right: -10%; width: 220px; height: 220px;
  background: rgba(255,255,255,.06); border-radius: 50%;
}
.welcome-banner h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; letter-spacing: -.02em; }
.welcome-banner p { font-size: .85rem; opacity: .8; }
.welcome-banner-date { font-size: .75rem; opacity: .6; margin-top: 4px; }

/* ─── Quick Action Cards ────────────────────────────────────────── */
.quick-actions-row { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.quick-action-card {
  flex: 1; min-width: 140px; padding: 14px 16px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  display: flex; align-items: center; gap: 10px; cursor: pointer;
  transition: all var(--transition);
  box-shadow: var(--shadow-sm);
}
.quick-action-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--primary); }
.quick-action-card i { font-size: 1rem; width: 36px; height: 36px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.quick-action-card .qa-label { font-size: .82rem; font-weight: 600; color: var(--text); }
.quick-action-card .qa-sub { font-size: .72rem; color: var(--text-3); margin-top: 1px; }
.qa-icon-report { background: linear-gradient(135deg, #f0fdfa, #ccfbf1); color: #0d9488; }
.qa-icon-patient { background: linear-gradient(135deg, #ede9fe, #ddd6fe); color: #7c3aed; }
.qa-icon-task { background: linear-gradient(135deg, #fff7ed, #fed7aa); color: #ea580c; }

/* ─── Patient avatar (initials) ──────────────────────────────── */
.patient-avatar {
  width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: .8rem; font-weight: 700; color: #fff; position: relative;
}
.patient-avatar.risk-none-bg { background: linear-gradient(135deg, #94a3b8, #64748b); }
.patient-avatar.risk-low-bg { background: linear-gradient(135deg, #22c55e, #16a34a); }
.patient-avatar.risk-medium-bg { background: linear-gradient(135deg, #f59e0b, #d97706); }
.patient-avatar.risk-high-bg { background: linear-gradient(135deg, #f43f5e, #e11d48); }
.patient-avatar-dot {
  position: absolute; bottom: 0; right: 0; width: 10px; height: 10px;
  border-radius: 50%; border: 2px solid var(--card);
}
.patient-avatar-dot.dot-active { background: #22c55e; }
.patient-avatar-dot.dot-discharged { background: #94a3b8; }

/* Patient card quick actions overlay */
.patient-card { position: relative; }
.patient-card-quick {
  display: none; position: absolute; top: 10px; right: 10px;
  gap: 4px;
}
.patient-card:hover .patient-card-quick { display: flex; }
.patient-card-quick button {
  width: 30px; height: 30px; border-radius: var(--radius-sm);
  background: var(--card); border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: .75rem; color: var(--text-2); cursor: pointer;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow-sm);
}
.patient-card-quick button:hover { background: var(--primary-bg); color: var(--primary); border-color: var(--primary); }

/* ─── Patient detail rich header ─────────────────────────────── */
.pd-rich-header {
  display: flex; align-items: center; gap: 16px; padding: 20px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  margin-bottom: 20px; box-shadow: var(--shadow-sm);
}
.pd-rich-avatar {
  width: 56px; height: 56px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; font-weight: 700; color: #fff;
}
.pd-rich-info { flex: 1; min-width: 0; }
.pd-rich-info h2 { font-size: 1.25rem; font-weight: 700; margin-bottom: 2px; }
.pd-rich-info .pd-rich-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: .82rem; color: var(--text-2); }
.pd-rich-info .pd-rich-meta span { display: flex; align-items: center; gap: 4px; }
.pd-rich-actions { display: flex; gap: 8px; flex-shrink: 0; }

/* Mobile FAB */
.mobile-fab {
  display: none; position: fixed; bottom: calc(24px + var(--bottom-nav-h)); right: 20px;
  width: 52px; height: 52px; border-radius: 50%;
  background: var(--primary-grad); color: #fff; border: none;
  font-size: 1.2rem; z-index: 80; cursor: pointer;
  box-shadow: 0 4px 16px rgba(20,184,166,.3);
  transition: all var(--transition);
}
.mobile-fab:hover { transform: scale(1.05); box-shadow: 0 6px 24px rgba(20,184,166,.4); }

/* ─── Bottom Navigation (mobile) ─────────────────────────────── */
.bottom-nav {
  display: none; position: fixed; bottom: 0; left: 0; right: 0;
  height: calc(56px + var(--safe-bottom)); padding-bottom: var(--safe-bottom);
  background: rgba(255,255,255,.95); backdrop-filter: blur(12px);
  border-top: 1px solid var(--border);
  z-index: 90;
}
.bottom-nav-inner {
  display: flex; align-items: center; justify-content: space-around;
  height: 56px; max-width: 500px; margin: 0 auto;
}
.bottom-nav-item {
  display: flex; flex-direction: column; align-items: center; gap: 2px;
  padding: 6px 12px; background: none; border: none; cursor: pointer;
  color: var(--text-3); font-size: .65rem; font-weight: 500;
  transition: color var(--transition-fast);
  min-width: 48px;
}
.bottom-nav-item i { font-size: 1.15rem; }
.bottom-nav-item.active { color: var(--primary); }
.bottom-nav-item:hover { color: var(--primary); }

/* ─── Skeleton loading ────────────────────────────────────────── */
.skeleton {
  background: linear-gradient(90deg, var(--bg-subtle) 25%, var(--border) 50%, var(--bg-subtle) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s ease infinite;
  border-radius: var(--radius-sm);
}
@keyframes shimmer { from { background-position: 200% 0; } to { background-position: -200% 0; } }
.skeleton-card { height: 120px; border-radius: var(--radius); margin-bottom: 12px; }
.skeleton-stat { height: 72px; border-radius: var(--radius); }
.skeleton-line { height: 12px; margin-bottom: 8px; }
.skeleton-line.w-75 { width: 75%; }
.skeleton-line.w-50 { width: 50%; }
.skeleton-line.w-25 { width: 25%; }

/* ─── Button loading spinner ─────────────────────────────────── */
.btn.btn-loading { pointer-events: none; opacity: .7; position: relative; }
.btn.btn-loading::after {
  content: ''; width: 14px; height: 14px;
  border: 2px solid rgba(255,255,255,.3); border-top-color: #fff;
  border-radius: 50%; animation: spin .6s linear infinite;
  margin-left: 6px;
}

/* ─── Activity feed ──────────────────────────────────────────── */
.activity-feed { display: flex; flex-direction: column; gap: 0; }
.activity-item {
  display: flex; align-items: flex-start; gap: 12px; padding: 10px 0;
  border-bottom: 1px solid var(--border); font-size: .85rem;
}
.activity-item:last-child { border-bottom: none; }
.activity-icon {
  width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; font-size: .75rem;
}
.activity-icon.type-report { background: var(--primary-bg); color: var(--primary); }
.activity-icon.type-risk { background: var(--accent-bg); color: var(--accent); }
.activity-icon.type-task { background: var(--amber-bg); color: var(--amber); }
.activity-content { flex: 1; min-width: 0; }
.activity-text { color: var(--text); line-height: 1.4; }
.activity-time { font-size: .75rem; color: var(--text-3); margin-top: 2px; }

/* ─── Responsive ──────────────────────────────────────────────── */
@media (max-width: 900px) {
  .two-col { grid-template-columns: 1fr; }
  .form-grid { grid-template-columns: 1fr; }
  .chat-layout { flex-direction: column; height: auto; }
  .channel-list { width: 100%; display: flex; overflow-x: auto; }
  .channel-item { white-space: nowrap; border-bottom: none; border-right: 1px solid var(--border); }
}

@media (max-width: 768px) {
  :root { --bottom-nav-h: calc(56px + env(safe-area-inset-bottom, 0px)); }
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .sb-overlay.visible { display: block; }
  .main-wrap { margin-left: 0; }
  .topbar {
    left: 0;
    height: calc(var(--topbar-h) + var(--safe-top));
    min-height: calc(var(--topbar-h) + var(--safe-top));
    padding-top: max(10px, var(--safe-top));
    padding-bottom: 0;
    padding-left: max(16px, calc(12px + var(--safe-left)));
    padding-right: max(16px, calc(12px + var(--safe-right)));
    gap: 10px;
    align-items: center;
  }
  .menu-btn { display: flex; align-items: center; justify-content: center; font-size: 1.3rem; padding: 10px; min-width: 44px; min-height: 44px; }
  .tb-title { font-size: 1.05rem; }
  .tb-breadcrumb { display: none; }
  .tb-right .notif-btn { width: 40px; height: 40px; font-size: 1.1rem; }
  .sidebar .nav-link { font-size: .95rem; padding: 12px 16px; color: rgba(255,255,255,.7); }
  .sidebar .nav-link i { font-size: 1rem; width: 22px; }
  .sb-brand-text { font-size: 1rem; }
  .sb-brand .sb-name { font-size: .82rem; }
  .logout-btn { font-size: .95rem; padding: 12px 16px; }
  .main-content { padding: 16px; margin-bottom: var(--bottom-nav-h); }
  .bottom-nav { display: block; }
  .stats-row { grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .stats-row .stat-card { padding: 10px 12px; min-width: 0; }
  .stats-row .stat-label { font-size: .72rem; }
  .stats-row .stat-value { font-size: 1rem; }
  .stats-row .stat-icon { width: 32px; height: 32px; font-size: .9rem; }
  .patient-actions { margin-left: 0; width: 100%; flex-wrap: wrap; }
  /* Patient detail: keep badge + all buttons on one scrollable line */
  .patient-header-top { flex-direction: row; flex-wrap: nowrap; align-items: center; gap: 8px; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; min-width: 0; }
  .patient-header-top .risk-badge { flex-shrink: 0; }
  .patient-header-top .patient-actions { flex-wrap: nowrap; flex-shrink: 0; width: auto; gap: 6px; }
  .patient-header-top .patient-actions .btn { flex-shrink: 0; white-space: nowrap; padding: 6px 10px; font-size: .8rem; }
  .tab-btn { padding: 8px 12px; font-size: .8rem; }
  .card { padding: 14px; word-break: normal; overflow-wrap: break-word; }
  .fr-controls { flex-direction: column; align-items: stretch; }
  .fr-preview, .fr-report-content { max-width: 100%; overflow-x: hidden; }
  .list-toolbar .filter-select { min-width: 0; }
  /* Keep table cells readable: min-width so text doesn’t collapse to one letter per line */
  th, td { min-width: 4.5em; }
  td:first-child { min-width: 6em; }
  .mobile-fab { display: flex; align-items: center; justify-content: center; }
  .welcome-banner { padding: 18px 20px; }
  .welcome-banner h2 { font-size: 1.15rem; }
  .quick-actions-row { gap: 8px; }
  .quick-action-card { min-width: 120px; padding: 12px; }
  .pd-rich-header { flex-direction: column; text-align: center; padding: 16px; }
  .pd-rich-actions { width: 100%; justify-content: center; }
}

@media (max-width: 480px) {
  .stats-row { grid-template-columns: repeat(3, 1fr); gap: 8px; }
  .stats-row .stat-card { padding: 8px 10px; }
  .stats-row .stat-label { font-size: .68rem; }
  .stats-row .stat-value { font-size: .95rem; }
  .stats-row .stat-icon { width: 28px; height: 28px; font-size: .85rem; }
  .login-card { padding: 30px 24px; border-radius: var(--radius-lg); }
  .main-content { padding: 12px; }
  .topbar { padding-top: max(10px, var(--safe-top)); padding-bottom: 0; padding-left: max(16px, calc(10px + var(--safe-left))); padding-right: max(16px, calc(10px + var(--safe-right))); }
  .menu-btn { min-width: 44px; min-height: 44px; font-size: 1.3rem; }
  .tb-title { font-size: 1rem; }
  .tb-right .notif-btn { width: 40px; height: 40px; font-size: 1.15rem; }
  .sidebar .nav-link { font-size: .95rem; padding: 13px 16px; }
  .sidebar .nav-link i { font-size: 1.05rem; }
  .pg-title { font-size: 1.3rem; }
  .patient-header h2 { font-size: 1.1rem; }
  .quick-action-card { flex: 0 0 auto; min-width: 100px; }
  .quick-actions-row { overflow-x: auto; flex-wrap: nowrap; }
}

/* ─── Print ───────────────────────────────────────────────────── */
@media print {
  .sidebar, .topbar, .sb-overlay, .chat-compose, .modal-overlay, #toast,
  .btn, .list-toolbar, .tab-bar, .patient-actions, .bottom-nav, .mobile-fab { display: none !important; }
  .main-wrap { margin-left: 0; padding-top: 0; }
  .main-content { margin-top: 0; padding: 0; max-width: none; }
  .card { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
}
