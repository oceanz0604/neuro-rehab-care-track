/* ═══════════════════════════════════════════════════════════════
   NeuroRehab CareTrack — Main Stylesheet
   Indigo sidebar · Teal primary · Glassmorphism-lite · Responsive
   ═══════════════════════════════════════════════════════════════ */

/* ─── CSS Variables ───────────────────────────────────────────── */
:root {
  --sidebar-w: 260px;
  --topbar-h: 64px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --bottom-nav-h: 0px;
  --navy: #1e1b4b;
  --navy-light: #312e81;
  --primary: #14b8a6;
  --primary-hover: #0d9488;
  --primary-light: #99f6e4;
  --primary-bg: #f0fdfa;
  --primary-grad: linear-gradient(135deg, #14b8a6 0%, #10b981 100%);
  --accent: #f43f5e;
  --accent-bg: #fff1f2;
  --amber: #f59e0b;
  --amber-bg: #fffbeb;
  --green: #22c55e;
  --green-bg: #f0fdf4;
  --grey: #94a3b8;
  --grey-bg: #f1f5f9;
  --bg: #f8fafc;
  --bg-subtle: #f1f5f9;
  --card: #ffffff;
  --card-glass: rgba(255,255,255,.75);
  --text: #0f172a;
  --text-2: #475569;
  --text-3: #94a3b8;
  --border: #e2e8f0;
  --shadow-sm: 0 1px 2px rgba(15,23,42,.05);
  --shadow: 0 1px 3px rgba(15,23,42,.06), 0 1px 2px rgba(15,23,42,.04);
  --shadow-md: 0 4px 6px rgba(15,23,42,.05), 0 10px 15px rgba(15,23,42,.08);
  --shadow-lg: 0 10px 25px rgba(15,23,42,.08), 0 20px 48px rgba(15,23,42,.06);
  --card-accent-border: rgba(20,184,166,.25);
  --radius: 12px;
  --radius-sm: 8px;
  --radius-lg: 16px;
  --radius-pill: 999px;
  --font: 'Inter', system-ui, -apple-system, sans-serif;
  --transition: .2s cubic-bezier(.4,0,.2,1);
  --transition-fast: .15s cubic-bezier(.4,0,.2,1);
  --transition-spring: .3s cubic-bezier(.34,1.56,.64,1);
}

/* ─── Dark theme ────────────────────────────────────────────────── */
[data-theme="dark"] {
  --navy: #0c0a1f;
  --navy-light: #1e1b4b;
  --primary: #2dd4bf;
  --primary-hover: #5eead4;
  --primary-light: #134e4a;
  --primary-bg: #042f2e;
  --primary-grad: linear-gradient(135deg, #2dd4bf 0%, #34d399 100%);
  --accent: #fb7185;
  --accent-bg: #4c0519;
  --amber: #fbbf24;
  --amber-bg: #451a03;
  --green: #4ade80;
  --green-bg: #052e16;
  --grey: #64748b;
  --grey-bg: #1e293b;
  --bg: #0f172a;
  --bg-subtle: #1e293b;
  --card: #1e293b;
  --card-glass: rgba(30,41,59,.8);
  --text: #f1f5f9;
  --text-2: #cbd5e1;
  --text-3: #64748b;
  --border: #334155;
  --shadow-sm: 0 1px 2px rgba(0,0,0,.4);
  --shadow: 0 1px 3px rgba(0,0,0,.4), 0 1px 2px rgba(0,0,0,.3);
  --shadow-md: 0 4px 6px rgba(0,0,0,.3), 0 10px 15px rgba(0,0,0,.4);
  --shadow-lg: 0 10px 25px rgba(0,0,0,.4), 0 20px 48px rgba(0,0,0,.3);
  --card-accent-border: rgba(45,212,191,.3);
}
[data-theme="dark"] .fi:focus,
[data-theme="dark"] .fg textarea:focus,
[data-theme="dark"] .search-box input:focus { background: var(--bg); }
[data-theme="dark"] .login-header h1 { color: var(--text); }
[data-theme="dark"] .login-icon { background: rgba(255,255,255,.95); }
[data-theme="dark"] .sidebar { background: linear-gradient(180deg, #0c0a1f 0%, #1e1b4b 100%); }
[data-theme="dark"] .sb-brand { border-bottom-color: rgba(255,255,255,.08); }
[data-theme="dark"] .sb-foot { border-top-color: rgba(255,255,255,.08); }
[data-theme="dark"] .nav-link { color: #94a3b8; }
[data-theme="dark"] .nav-link:hover { background: rgba(255,255,255,.06); color: #e2e8f0; }
[data-theme="dark"] .nav-link.active { background: rgba(45,212,191,.12); color: #2dd4bf; }
[data-theme="dark"] .logout-btn:hover { background: rgba(251,113,133,.12); color: #fb7185; }
[data-theme="dark"] .fi,
[data-theme="dark"] .fg textarea,
[data-theme="dark"] .fg select,
[data-theme="dark"] .search-box input,
[data-theme="dark"] .filter-select,
[data-theme="dark"] .add-inp,
[data-theme="dark"] .li-txt,
[data-theme="dark"] .adl-select,
[data-theme="dark"] .rating-btn,
[data-theme="dark"] .chat-compose input,
[data-theme="dark"] .urgent-toggle { background: var(--bg-subtle); border-color: var(--border); color: var(--text); }
[data-theme="dark"] .btn-ghost:hover { background: var(--bg-subtle); }
[data-theme="dark"] .btn-outline { border-color: var(--border); color: var(--text-2); }
[data-theme="dark"] .btn-outline:hover { border-color: #2dd4bf; color: #2dd4bf; background: rgba(45,212,191,.1); }
[data-theme="dark"] #toast { background: #1e293b; border: 1px solid #334155; }
[data-theme="dark"] .pwa-install-banner { background: #1e293b; border-color: #334155; }
[data-theme="dark"] .modal-card { background: #1e293b; border-color: #334155; }
[data-theme="dark"] .modal-body { color: var(--text-2); }
[data-theme="dark"] .login-card { background: #1e293b; }
[data-theme="dark"] .stat-value,
[data-theme="dark"] .stat-card-value,
[data-theme="dark"] .card-hd { color: var(--text); }
[data-theme="dark"] tr:hover td { background: rgba(45,212,191,.06); }
[data-theme="dark"] .channel-item.active { background: rgba(45,212,191,.15); color: #2dd4bf; }
[data-theme="dark"] .msg-bubble.theirs { background: var(--bg-subtle); color: var(--text); }
[data-theme="dark"] .msg-bubble.mine { background: #0d9488; color: #fff; }
[data-theme="dark"] .msg-bubble.urgent { background: #4c0519; color: #fecaca; }
[data-theme="dark"] .msg-bubble.mine.urgent { background: #be123c; border-color: #9f1239; color: #fff; }
[data-theme="dark"] .tab-bar { background: var(--bg-subtle); }
[data-theme="dark"] .tab-btn:hover { background: rgba(255,255,255,.05); }
[data-theme="dark"] .tab-btn.active { background: var(--card); color: #2dd4bf; }
[data-theme="dark"] .table-wrap { background: var(--card); border-color: var(--border); }
[data-theme="dark"] th { background: var(--bg-subtle); }
[data-theme="dark"] table:not(.task-list-table) tbody tr:nth-child(even) td { background: rgba(255,255,255,.02); }
[data-theme="dark"] .task-board-column { background: var(--bg-subtle); border-color: var(--border); }
[data-theme="dark"] .task-card { border-color: var(--border); }
[data-theme="dark"] .task-card.priority-card-high { background: var(--accent-bg); }
[data-theme="dark"] .task-card.priority-card-medium { background: var(--amber-bg); }
[data-theme="dark"] .task-card.priority-card-low { background: var(--grey-bg); }
[data-theme="dark"] .task-detail-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .loading-screen { background: linear-gradient(135deg, #0c0a1f 0%, #1e1b4b 50%, #0f172a 100%); }
[data-theme="dark"] .login-screen { background: linear-gradient(135deg, #0c0a1f 0%, #1e1b4b 50%, #0f172a 100%); }
[data-theme="dark"] .loading-spinner { border-color: rgba(45,212,191,.2); border-top-color: #2dd4bf; }
[data-theme="dark"] .loading-screen p { color: var(--text-2); }
[data-theme="dark"] .report-entry { background: var(--card); border-left-color: var(--border); }
[data-theme="dark"] .collapsible-head { background: var(--bg-subtle); color: var(--text); }
[data-theme="dark"] .channel-list-pinned { background: var(--bg-subtle); }
[data-theme="dark"] .wa-chat { --wa-chat-bg: #1a1d21; --wa-header-bg: #0d9488; --wa-sent-bg: #005c4b; --wa-compose-bg: #1f2c34; --wa-sender-color: #2dd4bf; }
[data-theme="dark"] .wa-chat-header, [data-theme="dark"] .wa-channels { background: #0d9488; }
[data-theme="dark"] .wa-channels .channel-item.active { background: rgba(255,255,255,.2); color: #fff; }
[data-theme="dark"] .wa-msg-list .msg-bubble.theirs { background: #2a2f33; color: #e9edef; }
[data-theme="dark"] .wa-msg-list .msg-bubble.mine { background: #005c4b; color: #e9edef; }
[data-theme="dark"] .wa-msg-list .msg-bubble.urgent { background: #451a1a; border: 1px solid #7f1d1d; color: #fecaca; }
[data-theme="dark"] .wa-msg-list .msg-bubble.mine.urgent { background: #7f1d1d; border: 1px solid #991b1b; color: #fff; }
[data-theme="dark"] .wa-msg-list .msg-bubble.urgent .msg-time, [data-theme="dark"] .wa-msg-list .msg-bubble.mine.urgent .msg-time { color: rgba(255,255,255,.85); }
[data-theme="dark"] .wa-compose-input, [data-theme="dark"] .wa-urgent-btn { background: #2a2f33; color: var(--text); }
[data-theme="dark"] .wa-send-btn { background: #0d9488; }
[data-theme="dark"] .wa-urgent-btn.active { background: #7f1d1d; color: #fecaca; }
[data-theme="dark"] .empty-state { color: var(--text-3); }
[data-theme="dark"] .welcome-banner { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #0d9488 100%); }
[data-theme="dark"] .quick-action-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .quick-action-card:hover { background: var(--bg-subtle); }
[data-theme="dark"] .stat-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .stat-card.clickable:hover { border-color: var(--primary); }
[data-theme="dark"] .bottom-nav { background: color-mix(in srgb, var(--bg) 85%, transparent); border-top-color: rgba(255,255,255,.08); }
[data-theme="dark"] .pd-rich-header { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .mobile-fab { box-shadow: 0 4px 16px rgba(0,0,0,.5); }
[data-theme="dark"] .nav-section-label { color: rgba(255,255,255,.25); }
[data-theme="dark"] .patient-card-quick button { background: var(--bg-subtle); border-color: var(--border); }
[data-theme="dark"] .dash-side-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .dps-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .dps-card:hover { border-color: var(--primary); }
[data-theme="dark"] .admin-nav { background: var(--bg-subtle); }
[data-theme="dark"] .admin-nav-item:hover { background: var(--card); }
[data-theme="dark"] .admin-nav-item.active { background: var(--card); box-shadow: var(--shadow-sm); }
[data-theme="dark"] .staff-card { background: var(--card); border-color: var(--border); }
[data-theme="dark"] .rt-item:hover,
[data-theme="dark"] .risk-alert-item:hover { background: var(--bg-subtle); }

/* ─── Reset ───────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html {
  font-size: 15px; -webkit-text-size-adjust: 100%;
  overflow-x: clip; max-width: 100vw; width: 100%;
  touch-action: manipulation; /* reduce double-tap zoom */
}
body {
  font-family: var(--font); color: var(--text); background: var(--bg); line-height: 1.55;
  overflow-x: clip; max-width: 100vw; width: 100%;
  position: relative;
  transition: background-color .25s ease, color .2s ease;
}
body.modal-open { overflow: hidden; overscroll-behavior: none; }
body.modal-open .modal-overlay { overscroll-behavior: contain; }
body.sidebar-open { overflow: hidden; }
body.sidebar-open .main-content { overflow: hidden; }
a { color: var(--primary); text-decoration: none; }
button { cursor: pointer; font-family: inherit; }
input, select, textarea { font-family: inherit; font-size: .93rem; }
img { max-width: 100%; }
:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }
.hidden { display: none !important; }

/* Hide scrollbars site-wide (content still scrollable) */
* { scrollbar-width: none; -ms-overflow-style: none; }
*::-webkit-scrollbar { display: none; }

/* ─── Loading screen (until auth resolved) ─────────────────────── */
.loading-screen {
  position: fixed; inset: 0; z-index: 9998;
  background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 50%, #f8fafc 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 18px;
  color: var(--primary);
}
.loading-screen.hidden { display: none !important; }
.loading-spinner {
  width: 40px; height: 40px; border: 3px solid rgba(20,184,166,.15);
  border-top-color: var(--primary); border-radius: 50%; animation: spin .8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-screen p { font-size: .9rem; font-weight: 500; color: var(--text-2); letter-spacing: .01em; }

/* ─── Login Screen ────────────────────────────────────────────── */
.login-screen {
  min-height: 100vh; display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 50%, #f8fafc 100%);
  padding: 24px;
}
.login-card {
  background: var(--card); border-radius: var(--radius-lg); padding: 44px 38px;
  width: 100%; max-width: 400px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
}
.login-header { text-align: center; margin-bottom: 30px; }
.login-icon {
  width: 64px; height: 64px; border-radius: var(--radius);
  background: #fff;
  display: inline-flex; align-items: center; justify-content: center;
  margin-bottom: 16px; overflow: hidden;
  box-shadow: var(--shadow-md);
}
.login-icon img { width: 100%; height: 100%; object-fit: contain; }
.login-header h1 { font-size: 1.5rem; font-weight: 700; color: var(--text); letter-spacing: -.02em; }
.login-header p { color: var(--text-3); font-size: .85rem; margin-top: 6px; }
.fg { margin-bottom: 16px; }
.fg label { display: block; font-size: .8rem; font-weight: 600; color: var(--text-2); margin-bottom: 5px; text-transform: uppercase; letter-spacing: .04em; }
.fi {
  width: 100%; max-width: 100%; min-width: 0;
  padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .93rem;
  box-sizing: border-box;
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
  background: var(--bg);
}
.fi:focus { border-color: var(--primary); outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.error-msg { color: var(--accent); font-size: .82rem; margin-bottom: 10px; }
.password-wrap { position: relative; }
.password-wrap .fi { padding-right: 44px; }
.password-toggle {
  position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
  background: none; border: none; color: var(--text-3); cursor: pointer;
  padding: 6px; font-size: 1rem; line-height: 1;
}
.password-toggle:hover { color: var(--primary); }
.login-btn-full { width: 100%; box-sizing: border-box; }
.login-hint { text-align: center; color: var(--text-3); font-size: .78rem; margin-top: 16px; }

/* ─── Buttons ─────────────────────────────────────────────────── */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 10px 22px; border: none; border-radius: var(--radius-sm);
  font-size: .85rem; font-weight: 600; transition: all var(--transition);
  background: var(--primary-grad); color: #fff;
  box-shadow: 0 1px 3px rgba(20,184,166,.2);
  letter-spacing: .01em;
}
.btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(20,184,166,.3); }
.btn:active { transform: translateY(0) scale(.97); box-shadow: 0 1px 3px rgba(20,184,166,.15); }
.btn:disabled { opacity: .5; pointer-events: none; }
.btn-block { width: 100%; padding: 12px; font-size: .93rem; }
.btn-sm { padding: 6px 14px; font-size: .8rem; }
.btn-ghost { background: transparent; color: var(--text-2); box-shadow: none; }
.btn-ghost:hover { background: var(--grey-bg); transform: none; }
.btn-danger { background: linear-gradient(135deg, #f43f5e, #e11d48); box-shadow: 0 1px 3px rgba(244,63,94,.2); }
.btn-danger:hover { box-shadow: 0 4px 12px rgba(244,63,94,.3); }
.btn-outline {
  background: transparent; border: 1.5px solid var(--border); color: var(--text-2);
  box-shadow: none; border-radius: 10px;
}
.btn-outline:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-bg); }
.btn-icon {
  width: 38px; height: 38px; padding: 0; border-radius: 10px;
  background: transparent; color: var(--text-2); border: none; font-size: 1rem;
}
.btn-icon:hover { background: var(--grey-bg); }

/* ─── App Shell Layout ────────────────────────────────────────── */
.app { display: flex; min-height: 100vh; min-width: 0; max-width: 100%; overflow-x: clip; }
#app-shell[hidden] { display: none !important; }

/* Sidebar — dark indigo gradient */
.sidebar {
  width: var(--sidebar-w);
  background: linear-gradient(180deg, #1e1b4b 0%, #312e81 100%);
  color: rgba(255,255,255,.7);
  display: flex; flex-direction: column; position: fixed; top: 0; bottom: 0; left: 0;
  z-index: 100; transition: transform .25s ease;
  padding-top: var(--safe-top);
  padding-left: max(14px, env(safe-area-inset-left, 0px));
  padding-right: max(14px, env(safe-area-inset-right, 0px));
  box-sizing: border-box;
  border-right: none;
  box-shadow: 4px 0 24px rgba(15,23,42,.15);
}
.sb-brand {
  display: flex; align-items: center; gap: 10px;
  height: var(--topbar-h); min-height: var(--topbar-h); padding: 12px 16px 14px 0; box-sizing: border-box;
}
.sb-brand-inner { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 2px; overflow: hidden; }
.sb-brand-actions {
  display: flex; align-items: center; gap: 4px; flex-shrink: 0; margin-left: auto;
}
.sb-header-icon-btn {
  width: 40px; height: 40px; border: none; border-radius: 50%;
  background: rgba(255,255,255,.12); color: rgba(255,255,255,.9);
  display: flex; align-items: center; justify-content: center; cursor: pointer;
  transition: background var(--transition-fast), color var(--transition-fast);
}
.sb-header-icon-btn:hover { background: rgba(255,255,255,.2); color: #fff; }
.sb-header-icon-btn i { font-size: 1rem; }
/* Web UI: hide refresh/theme in sidebar; they're in the title bar */
@media (min-width: 769px) {
  .sb-brand-actions { display: none; }
}
.sb-user-avatar {
  width: 36px; height: 36px; border-radius: 50%;
  background: linear-gradient(135deg, #14b8a6, #10b981);
  display: flex; align-items: center; justify-content: center;
  font-size: .8rem; font-weight: 700; color: #fff; flex-shrink: 0;
  letter-spacing: .02em;
}
.sb-brand-logo { height: 28px; width: auto; max-width: 32px; object-fit: contain; flex-shrink: 0; }
.sb-brand-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; font-size: .95rem; font-weight: 700; color: #fff; }
.sb-brand .sb-name { font-size: .75rem; font-weight: 500; color: rgba(255,255,255,.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sb-brand i { color: var(--primary); font-size: 1.2rem; }
.sb-nav { flex: 1; padding: 14px 0; overflow-y: auto; }
.nav-section-label {
  font-size: .68rem; font-weight: 600; text-transform: uppercase; letter-spacing: .08em;
  color: rgba(255,255,255,.35); padding: 16px 14px 6px; margin-top: 4px;
}
.nav-link {
  display: flex; align-items: center; gap: 10px; padding: 9px 14px;
  border-radius: var(--radius-sm); color: rgba(255,255,255,.65); font-size: .85rem; font-weight: 500;
  transition: all var(--transition); position: relative; margin-bottom: 2px;
}
.nav-link:hover { background: rgba(255,255,255,.08); color: #fff; }
.nav-link.active {
  background: rgba(20,184,166,.15); color: #fff; font-weight: 600;
  box-shadow: inset 3px 0 0 var(--primary);
}
.nav-link i { width: 20px; text-align: center; font-size: .9rem; }
.nav-badge {
  position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
  background: var(--accent); color: #fff; font-size: .65rem; font-weight: 700;
  padding: 2px 7px; border-radius: var(--radius-pill); display: none;
}
.nav-badge.visible { display: block; }
.sb-foot { padding: 12px 0; border-top: 1px solid rgba(255,255,255,.1); display: flex; flex-direction: column; gap: 4px; }
.sb-foot .nav-link { width: 100%; text-decoration: none; }
.logout-btn {
  width: 100%; text-align: left; text-decoration: none;
  background: none; border: none; cursor: pointer; font-family: inherit;
}
.logout-btn:hover { background: rgba(244,63,94,.12); color: #fb7185; }

/* Mobile sidebar overlay */
.sb-overlay {
  display: none; position: fixed; inset: 0; background: rgba(15,23,42,.5);
  z-index: 99; opacity: 0; transition: opacity .25s;
  backdrop-filter: blur(4px);
}
.sb-overlay.visible { display: block; opacity: 1; }
/* Prevent sidebar scroll from chaining to background when at top/bottom */
.sidebar { overscroll-behavior: contain; -webkit-overflow-scrolling: touch; }

/* Main area: fixed topbar + scrollable inner frame only */
.main-wrap {
  flex: 1; margin-left: var(--sidebar-w); display: flex; flex-direction: column;
  min-height: 100vh; min-width: 0; overflow-x: clip;
}

/* Topbar — removed; main content starts at top. Refresh/theme in sidebar (mobile More). */
.topbar { display: none !important; }
.topbar::before { display: none; }
.menu-btn { display: none; background: none; border: none; font-size: 1.15rem; color: var(--text-2); padding: 8px; cursor: pointer; }
.tb-title-wrap { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
.tb-title { font-size: 1.1rem; font-weight: 700; letter-spacing: -0.02em; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text); line-height: 1.3; }
.tb-breadcrumb { font-size: .72rem; color: var(--text-3); display: flex; align-items: center; gap: 4px; margin-top: 1px; }
.tb-breadcrumb a { color: var(--text-3); text-decoration: none; }
.tb-breadcrumb a:hover { color: var(--primary); }
.tb-breadcrumb .bc-sep { opacity: .4; font-size: .6rem; }
.tb-breadcrumb .bc-current { color: var(--text-2); font-weight: 500; }
.tb-right { display: flex; align-items: center; gap: 8px; }
.tb-quick-add {
  width: 36px; height: 36px; border-radius: var(--radius-sm);
  background: var(--primary-grad); color: #fff; border: none;
  display: flex; align-items: center; justify-content: center;
  font-size: .95rem; cursor: pointer;
  transition: all var(--transition); position: relative;
  box-shadow: 0 1px 3px rgba(20,184,166,.2);
}
.tb-quick-add:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(20,184,166,.3); }
.quick-add-menu {
  position: absolute; top: calc(100% + 8px); right: 0; min-width: 200px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  box-shadow: var(--shadow-lg); z-index: 200; display: none; overflow: hidden;
}
.quick-add-menu.visible { display: block; animation: fadeUp .15s ease; }
.quick-add-item {
  display: flex; align-items: center; gap: 10px; padding: 10px 16px;
  font-size: .85rem; font-weight: 500; color: var(--text);
  cursor: pointer; transition: background var(--transition-fast);
  border: none; background: none; width: 100%; text-align: left;
}
.quick-add-item:hover { background: var(--bg-subtle); }
.quick-add-item i { width: 18px; color: var(--text-3); text-align: center; font-size: .85rem; }
.notif-btn {
  position: relative; width: 36px; height: 36px; border-radius: var(--radius-sm);
  background: none; border: none; color: var(--text-2); font-size: 1rem;
  display: flex; align-items: center; justify-content: center;
  transition: background var(--transition);
}
.notif-btn:hover { background: var(--bg-subtle); }

/* Detail pages (patient, task) — no titlebar; rely on hardware back / history */
.patient-page .main-content,
.task-page .main-content { margin-top: var(--safe-top); }
.patient-page .main-content-center,
.task-page .main-content-center { max-width: 900px; margin-left: auto; margin-right: auto; box-sizing: border-box; }
.topbar-back {
  display: inline-flex; align-items: center; justify-content: center; gap: 6px;
  min-width: 44px; min-height: 44px; padding: 0 10px; border-radius: var(--radius-sm);
  color: var(--text-2); background: none; border: none; text-decoration: none; cursor: pointer;
  transition: all var(--transition); flex-shrink: 0;
  font-size: .9rem; font-weight: 500;
}
.topbar-back:hover { background: var(--bg-subtle); color: var(--primary); }
.topbar-back i { font-size: 1.05rem; }
.topbar-back-label { display: none; }

.shift-badge {
  padding: 4px 12px; border-radius: var(--radius-pill); font-size: .75rem; font-weight: 600;
  background: var(--primary-bg); color: var(--primary);
}

/* ─── Main content (scrollable inner frame only) ────────────────── */
.main-content {
  margin-top: var(--safe-top);
  margin-bottom: var(--bottom-nav-h);
  flex: 1; min-height: 0; overflow-y: auto; overflow-x: clip;
  padding: 24px; width: 100%; min-width: 0;
  background: var(--bg);
}
.main-content::before { display: none; }
.main-content { word-break: normal; overflow-wrap: break-word; }

/* Pages */
.page { display: none; width: 100%; max-width: 100%; overflow-x: clip; min-width: 0; box-sizing: border-box; }
.page.active { display: block; animation: pageIn .3s cubic-bezier(.4,0,.2,1); }
#page-dashboard { max-width: 1200px; margin-left: auto; margin-right: auto; }
@keyframes pageIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

/* Page title */
.pg-title { font-size: 1.75rem; font-weight: 700; margin-bottom: 4px; color: var(--text); letter-spacing: -.03em; }
.pg-sub { color: var(--text-3); font-size: .85rem; margin-bottom: 20px; }

/* ─── Cards ───────────────────────────────────────────────────── */
.card {
  background: var(--card); border-radius: var(--radius); padding: 20px;
  box-shadow: var(--shadow-sm); border: 1px solid var(--border); margin-bottom: 16px;
  transition: background-color var(--transition), border-color var(--transition), box-shadow var(--transition), transform var(--transition);
}
.card:hover { box-shadow: var(--shadow); }
.card.card-accent { border-left: 3px solid var(--primary); border-radius: 3px var(--radius) var(--radius) 3px; }
.card.card-accent-warn { border-left: 3px solid var(--amber); border-radius: 3px var(--radius) var(--radius) 3px; }
.card.card-accent-danger { border-left: 3px solid var(--accent); border-radius: 3px var(--radius) var(--radius) 3px; }
.card-hd {
  font-size: .9rem; font-weight: 700; margin-bottom: 14px;
  display: flex; align-items: center; gap: 8px;
  color: var(--text); letter-spacing: -.01em;
}
.card-hd i { font-size: .85rem; }
.card-hd.card-hd-primary { color: var(--primary); }
.card-hd.card-hd-accent { color: var(--accent); }

/* Collapsible sections (patient detail, etc.) */
.collapsible-section { border: 1px solid var(--border); border-radius: 12px; margin-bottom: 14px; overflow: hidden; }
.collapsible-head {
  width: 100%; display: flex; align-items: center; gap: 8px; padding: 14px 16px;
  background: var(--bg-subtle); border: none; font-size: .9rem; font-weight: 600; text-align: left; cursor: pointer;
  transition: background var(--transition); border-radius: 12px 12px 0 0;
}
.collapsible-head:hover { background: var(--border); }
.collapsible-head i.fa-chevron-down { transition: transform .2s ease; }
.collapsible-section.collapsed .collapsible-head i.fa-chevron-down { transform: rotate(-90deg); }
.collapsible-body { padding: 14px; }
.collapsible-section.collapsed .collapsible-body { display: none; }
/* Parameters tab: inner section list area transparent (line separator under header is enough) */
#admin-parameters-wrap .collapsible-section .collapsible-body { background: transparent; }

/* Multi-select dropdown */
.multiselect-wrap { position: relative; }
.multiselect-trigger {
  position: relative;
  width: 100%; min-height: 38px; padding: 8px 12px; padding-right: 32px;
  background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .93rem; text-align: left; cursor: pointer; display: flex; align-items: center; flex-wrap: wrap; gap: 6px;
  transition: border var(--transition);
}
.multiselect-trigger:hover { border-color: var(--text-3); }
.multiselect-trigger:focus { border-color: var(--primary); outline: none; }
.multiselect-trigger::after {
  content: ''; position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  border: 5px solid transparent; border-top-color: var(--text-3);
}
.multiselect-wrap.open .multiselect-trigger::after { transform: translateY(-50%) rotate(180deg); }
.multiselect-chip {
  display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px;
  background: var(--primary-bg); color: var(--primary); border-radius: 999px;
  font-size: .8rem; font-weight: 500;
}
.multiselect-placeholder { color: var(--text-3); }
.multiselect-panel {
  position: absolute; left: 0; right: 0; top: 100%; margin-top: 4px; max-height: 220px; overflow-y: auto;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm);
  box-shadow: var(--shadow-md); z-index: 100; display: none; padding: 8px;
}
.multiselect-wrap.open .multiselect-panel { display: flex; flex-direction: column; }
.multiselect-search {
  flex-shrink: 0; margin-bottom: 8px; border-radius: var(--radius-sm);
}
.multiselect-options {
  flex: 1; min-height: 0; overflow-y: auto; max-height: 180px;
}
.multiselect-panel label {
  display: flex; align-items: center; gap: 8px; padding: 8px 10px; cursor: pointer;
  font-size: .88rem; border-radius: var(--radius-sm); transition: background var(--transition);
}
.multiselect-panel label:hover { background: var(--grey-bg); }
.multiselect-panel input[type="checkbox"] { width: 16px; height: 16px; flex-shrink: 0; }
.multiselect-panel .single-select-option {
  display: flex; align-items: center; padding: 8px 10px; cursor: pointer;
  font-size: .88rem; border-radius: var(--radius-sm); transition: background var(--transition);
}
.multiselect-panel .single-select-option:hover { background: var(--grey-bg); }

/* Dashboard — Risk Alerts & Recent Reports */
.risk-alert-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); flex-wrap: wrap;
}
.risk-alert-row:last-child { border-bottom: none; }
.risk-alert-row:hover { background: var(--grey-bg); }
.risk-alert-badges { display: flex; flex-direction: column; align-items: flex-start; gap: 4px; flex-shrink: 0; }
.risk-alert-info { flex: 1; min-width: 0; }
.risk-alert-meta { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.badge-your-patient,
.badge-my-patient {
  font-size: .7rem; font-weight: 600; padding: 3px 10px; border-radius: var(--radius-pill);
  background: var(--primary-bg); color: var(--primary); white-space: nowrap;
}
.required-asterisk { color: var(--accent); }
.text-muted { color: var(--text-3); font-size: .85em; }

/* Multi-step wizard (e.g. Add Patient) */
.modal-card-wizard .wizard-steps {
  display: flex; align-items: center; justify-content: center; gap: 0;
  margin-bottom: 20px; padding: 0 8px;
}
.wizard-dot {
  width: 28px; height: 28px; border-radius: 50%;
  background: var(--grey-bg); color: var(--text-3); font-size: .8rem; font-weight: 700;
  display: inline-flex; align-items: center; justify-content: center;
  transition: background var(--transition), color var(--transition);
}
.wizard-dot.active { background: var(--primary); color: #fff; }
.wizard-line {
  width: 40px; height: 2px; background: var(--border); flex-shrink: 0;
}
.wizard-pane { min-height: 120px; }
.wizard-actions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end; align-items: center; }
.recent-rpt-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); flex-wrap: wrap;
}
.recent-rpt-row:last-child { border-bottom: none; }
.recent-rpt-row:hover { background: var(--grey-bg); }
.recent-rpt-main { flex: 1; min-width: 0; }
.recent-rpt-name { font-size: .88rem; }
.recent-rpt-meta { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.recent-rpt-badge { flex-shrink: 0; }
.recent-rpt-ts { font-size: .75rem; color: var(--text-3); white-space: nowrap; }

/* ─── Stat Cards ──────────────────────────────────────────────── */
/* Stats strip — horizontal scroll, same style as quick-action cards */
.stats-strip {
  display: flex; gap: 10px; margin-bottom: 14px;
  overflow-x: auto; overflow-y: hidden; padding: 4px 0 8px;
  scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
}
.stat-card {
  flex: 0 0 auto; min-width: 140px; scroll-snap-align: start;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 14px 16px; display: flex; align-items: center; gap: 10px;
  box-shadow: var(--shadow-sm); transition: all var(--transition);
}
.stat-card.clickable { cursor: pointer; }
.stat-card.clickable:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--primary); }
.stat-card-icon {
  width: 36px; height: 36px; border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center; font-size: 1rem; flex-shrink: 0;
}
.stat-card-icon-teal { background: linear-gradient(135deg, #f0fdfa, #ccfbf1); color: #0d9488; }
.stat-card-icon-red { background: linear-gradient(135deg, #fff1f2, #fecdd3); color: #e11d48; }
.stat-card-icon-amber { background: linear-gradient(135deg, #fffbeb, #fef3c7); color: #d97706; }
.stat-card-icon-green { background: linear-gradient(135deg, #f0fdf4, #dcfce7); color: #16a34a; }
.stat-card-text { min-width: 0; }
.stat-card-label { font-size: .72rem; color: var(--text-3); font-weight: 500; }
.stat-card-value { font-size: 1.1rem; font-weight: 700; color: var(--text); line-height: 1.2; margin-top: 2px; }

/* Dashboard — My Active Patients */
.my-pt-row {
  display: flex; align-items: flex-start; gap: 12px; padding: 12px 4px;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition);
}
.my-pt-row:last-child { border-bottom: none; }
.my-pt-row:hover { background: var(--bg-subtle); border-radius: 10px; }
.my-pt-info { flex: 1; min-width: 0; }
.my-pt-name {
  font-size: 1.05rem; font-weight: 700; color: var(--text);
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
}
.my-pt-diagnosis { font-size: .82rem; color: var(--text-3); margin-top: 2px; }
.my-pt-diagnosis-line { margin-top: 2px; }
.my-pt-diagnosis-line:first-child { margin-top: 0; }
.my-pt-report {
  font-size: .82rem; color: var(--text-2); margin-top: 4px;
  display: flex; align-items: center; gap: 6px;
}
.my-pt-report i { font-size: .75rem; color: var(--primary); }

/* ─── Dashboard grid layout ──────────────────────────────────── */
.dash-grid { display: grid; grid-template-columns: 1fr 380px; gap: 20px; align-items: start; }
.dash-col-main { min-width: 0; }
.dash-ordered { display: flex; flex-direction: column; gap: 14px; }
.dash-ordered .dash-section { margin: 0; }
#dash-my-patients-wrap {
  padding: 16px; background: var(--card); border: 1px solid var(--border);
  border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);
}
.dash-high-risk-wrap {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  padding: 16px; box-shadow: var(--shadow-sm);
}
.dash-high-risk-wrap .dash-section-hd { border-radius: var(--radius); border-bottom-color: var(--border); padding-bottom: 10px; margin-bottom: 10px; }
.dash-high-risk-wrap .dash-section-hd .dash-section-title i { color: var(--accent); }
.dash-section-toggle { cursor: pointer; user-select: none; display: flex; align-items: center; gap: 8px; }
.dash-section-toggle .dash-section-title { flex: 1; }
.dash-section-chevron { font-size: .75rem; color: var(--text-3); transition: transform var(--transition); }
.dash-section-chevron.dash-section-chevron-open { transform: rotate(-180deg); }
.dash-high-risk-wrap .dash-section-body { overflow: hidden; }
.dash-col-side { display: flex; flex-direction: column; gap: 16px; min-width: 0; }

.dash-section { margin-bottom: 20px; }
.dash-section-hd {
  display: flex; align-items: center; justify-content: space-between; gap: 8px;
  margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border);
}
.dash-section-title { font-size: .95rem; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 8px; }
.dash-section-title i { color: var(--primary); font-size: .85rem; }
.dash-section-count { font-size: .75rem; color: var(--text-3); font-weight: 500; }

.dash-patient-strip {
  display: flex; gap: 12px; overflow-x: auto; overflow-y: hidden; padding: 4px 0 8px;
  scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch;
}

.dps-card {
  flex: 0 0 150px; scroll-snap-align: start;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 14px 12px; text-align: center; cursor: pointer;
  transition: all var(--transition); display: flex; flex-direction: column; align-items: center; gap: 6px;
}
.dps-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--primary); }
.dps-avatar { width: 40px; height: 40px; font-size: .8rem; }
.dps-name { font-size: .82rem; font-weight: 600; color: var(--text); line-height: 1.2; word-break: break-word; }
.dps-diag { font-size: .68rem; color: var(--text-3); line-height: 1.2; max-height: 2.4em; overflow: hidden; }
.dps-report { font-size: .68rem; color: var(--text-2); display: flex; align-items: center; gap: 4px; margin-top: auto; }
.dps-report i { font-size: .6rem; color: var(--primary); }
.dps-report.dps-report-none { color: var(--text-3); }
.dps-report.dps-report-none i { color: var(--text-3); }

/* Dashboard side cards (risk alerts, reports) */
.dash-side-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 16px; box-shadow: var(--shadow-sm);
}
.dash-side-hd {
  font-size: .85rem; font-weight: 700; display: flex; align-items: center; gap: 8px;
  margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border);
}
.dash-side-hd i { font-size: .8rem; }
.dash-side-hd-danger { color: var(--accent); }
.dash-side-hd-primary { color: var(--primary); }

/* Risk alert items */
.risk-alert-item {
  display: flex; align-items: center; gap: 10px; padding: 8px 4px;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); border-radius: var(--radius-sm);
}
.risk-alert-item:last-child { border-bottom: none; }
.risk-alert-item:hover { background: var(--bg-subtle); }
.risk-alert-avatar { width: 32px; height: 32px; font-size: .7rem; flex-shrink: 0; }
.risk-alert-body { flex: 1; min-width: 0; }
.risk-alert-name { font-size: .82rem; font-weight: 600; color: var(--text); }
.risk-alert-detail { font-size: .72rem; color: var(--text-3); margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.risk-alert-arrow { font-size: .65rem; color: var(--text-3); flex-shrink: 0; }

/* Report timeline */
.report-timeline { display: flex; flex-direction: column; gap: 0; }
.rt-item {
  display: flex; align-items: center; gap: 10px; padding: 8px 4px;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); border-radius: var(--radius-sm);
}
.rt-item:last-child { border-bottom: none; }
.rt-item:hover { background: var(--bg-subtle); }
.rt-icon {
  width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; font-size: .7rem;
}
.rt-icon-teal { background: var(--primary-bg); color: var(--primary); }
.rt-icon-red { background: var(--accent-bg); color: var(--accent); }
.rt-icon-amber { background: var(--amber-bg); color: var(--amber); }
.rt-icon-green { background: var(--green-bg); color: var(--green); }
.rt-icon-grey { background: var(--grey-bg); color: var(--grey); }
.rt-body { flex: 1; min-width: 0; }
.rt-title { font-size: .82rem; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rt-section { font-weight: 500; color: var(--text-3); font-size: .75rem; }
.rt-meta { font-size: .72rem; color: var(--text-3); margin-top: 1px; }

/* ─── Two-column layout (legacy) ─────────────────────────────── */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

/* ─── Risk badges ─────────────────────────────────────────────── */
.risk-badge {
  display: inline-block; padding: 3px 12px; border-radius: var(--radius-pill);
  font-size: .73rem; font-weight: 600; text-transform: uppercase; letter-spacing: .03em;
}
.risk-none { background: var(--grey-bg); color: var(--grey); }
.risk-low { background: var(--green-bg); color: var(--green); }
.risk-medium { background: var(--amber-bg); color: var(--amber); }
.risk-high { background: var(--accent-bg); color: var(--accent); }
.risk-adl { background: var(--primary-bg); color: var(--primary); }

/* ─── Patients card grid ─────────────────────────────────────── */
.patients-card-grid {
  display: grid;
  width: 100%;
  gap: 16px;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}
.patients-card-grid > .empty-state { grid-column: 1 / -1; }
.patient-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px 18px;
  min-width: 0;
  box-shadow: var(--shadow-sm);
  transition: border-color var(--transition), box-shadow var(--transition);
}
.patient-card:hover { border-color: var(--primary); box-shadow: var(--shadow); transform: translateY(-1px); }
.patient-card.clickable { cursor: pointer; }

.patient-card-discharged {
  background: var(--grey-bg);
  border: 1px dashed var(--border);
  border-left: 3px solid var(--text-3);
  opacity: 0.92;
  box-shadow: none;
  border-radius: 4px 16px 16px 4px;
}
.patient-card-discharged:hover {
  border-color: var(--text-3);
  box-shadow: none;
  background: var(--grey-bg);
  transform: none;
}
.patient-card-discharged .patient-card-name,
.patient-card-discharged .patient-card-diagnosis,
.patient-card-discharged .patient-card-label { color: var(--text-2); }
.patient-card-discharged .patient-card-name { font-weight: 500; }
.patient-card-discharged .patient-card-discharge-date { color: var(--text-3); }
.patient-card-discharged .discharge-days { opacity: 0.95; }
.patient-card-discharge-date .patient-card-discharged-badge {
  font-size: .65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: var(--text-3);
  background: rgba(0,0,0,.06);
  padding: 3px 8px;
  border-radius: 4px;
  margin-right: 6px;
}
.patient-card-name-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
  min-width: 0;
}
.patient-card-name-row .patient-card-name { margin-bottom: 0; flex: 1; min-width: 0; }
.patient-card-discharge-date {
  flex-shrink: 0;
  font-size: .8rem;
  color: var(--text-3);
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.patient-card-discharge-date i { font-size: .75rem; opacity: .9; }

.patient-card-name {
  font-weight: 700;
  font-size: 1.02rem;
  margin-bottom: 10px;
  word-break: break-word;
  line-height: 1.3;
  color: var(--text);
}
.patient-card-name .badge-my-patient { margin-left: 6px; }
.patient-card-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 8px;
  font-size: .85rem;
}
.patient-card-row:last-child { margin-bottom: 0; }
.patient-card-label {
  color: var(--text-3);
  flex: 0 0 80px;
  min-width: 0;
}
.patient-card-diagnosis {
  color: var(--text);
  word-break: break-word;
  flex: 1;
  min-width: 0;
}
.discharge-days {
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 6px;
  font-size: .8rem;
}
.discharge-days-overdue { background: var(--accent-bg); color: var(--accent); }
.discharge-days-urgent { background: var(--accent-bg); color: var(--accent); }
.discharge-days-warning { background: var(--amber-bg); color: var(--amber); }
.discharge-days-ok { background: var(--green-bg); color: var(--green); }
.discharge-days-none { color: var(--text-3); background: transparent; }
.discharge-status-delayed { background: var(--amber-bg); color: var(--amber); }
.discharge-status-early { background: var(--green-bg); color: var(--green); }
.discharge-status-done { color: var(--text-2); background: var(--grey-bg); }
.patient-card-row .discharge-sub { font-size: .8rem; color: var(--text-3); font-weight: 400; margin-left: 4px; }

/* Status badges */
.status-badge { display: inline-block; padding: 3px 12px; border-radius: var(--radius-pill); font-size: .73rem; font-weight: 600; }
.status-active { background: var(--green-bg); color: var(--green); }
.status-discharged { background: var(--grey-bg); color: var(--grey); }
.task-status-todo { background: var(--grey-bg); color: var(--grey); }
.task-status-in_progress { background: var(--amber-bg); color: var(--amber); }
.task-status-done { background: var(--green-bg); color: var(--green); }

/* ═══ Tasks — JIRA-style Board + List ═══════════════════════════════ */
.tasks-toolbar { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
.tasks-toolbar-left { display: flex; align-items: center; gap: 14px; flex-wrap: wrap; }
.tasks-view-toggle { display: inline-flex; background: var(--bg-subtle); border-radius: 10px; padding: 3px; gap: 0; }
.tasks-view-btn {
  margin: 0; padding: 7px 16px; border-radius: 8px; font-size: .82rem;
  border: none; background: transparent; color: var(--text-2); font-weight: 500; cursor: pointer; transition: all var(--transition);
}
.tasks-view-btn.active { background: var(--card); color: var(--primary); font-weight: 600; box-shadow: var(--shadow-sm); }

/* Board */
.tasks-board-wrap { min-height: 200px; }
.task-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; align-items: start; }
@media (max-width: 900px) { .task-board { grid-template-columns: 1fr; } }
.task-board-column {
  background: var(--bg-subtle); border-radius: var(--radius); border: 1px solid var(--border);
  display: flex; flex-direction: column; overflow: hidden; height: auto;
}
.task-board-column[data-status="todo"] { border-top: 3px solid var(--grey); }
.task-board-column[data-status="in_progress"] { border-top: 3px solid var(--amber); }
.task-board-column[data-status="done"] { border-top: 3px solid var(--green); }
.task-board-col-hd {
  display: flex; align-items: center; justify-content: space-between; gap: 8px;
  padding: 12px 16px; flex-shrink: 0; border-bottom: 1px solid var(--border);
  cursor: pointer; user-select: none;
}
.task-board-col-hd:hover { background: rgba(0,0,0,.03); }
[data-theme="dark"] .task-board-col-hd:hover { background: rgba(255,255,255,.05); }
.task-board-col-hd:focus { outline: 2px solid var(--primary); outline-offset: 2px; }
.task-board-col-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; margin-left: auto; }
.task-board-col-chevron { color: var(--text-3); font-size: .75rem; transition: transform .2s ease; flex-shrink: 0; }
.task-board-column.collapsed .task-board-col-chevron { transform: rotate(-90deg); }
.task-board-column.collapsed .task-board-cards { display: none; }
.task-board-column.collapsed .task-board-col-hd { border-bottom: none; }
.task-board-col-title { font-weight: 700; font-size: .85rem; letter-spacing: .02em; display: flex; align-items: center; gap: 8px; }
.task-board-col-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.task-board-col-dot.dot-todo { background: var(--grey); }
.task-board-col-dot.dot-in_progress { background: var(--amber); }
.task-board-col-dot.dot-done { background: var(--green); }
.task-board-col-count {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-pill);
  font-size: .72rem; font-weight: 600; color: var(--text-3); padding: 2px 9px; min-width: 20px; text-align: center;
}
.task-board-cards { padding: 12px; display: flex; flex-direction: column; gap: 10px; min-height: 72px; overflow-y: auto; }
.task-board-cards.has-cards { min-height: 0; }
.task-board-empty { padding: 24px 16px; text-align: center; color: var(--text-3); font-size: .82rem; min-height: 72px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.task-board-empty i { display: block; font-size: 1.5rem; margin-bottom: 8px; opacity: .4; }

/* Card */
.task-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm);
  padding: 12px 14px; cursor: pointer;
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--transition), border-color var(--transition), transform var(--transition);
  border-left: 3px solid var(--border);
}
/* Board view: card background by priority (red / amber / grey) */
.task-card.priority-card-high { border-left-color: var(--accent); background: var(--accent-bg); }
.task-card.priority-card-medium { border-left-color: var(--amber); background: var(--amber-bg); }
.task-card.priority-card-low { border-left-color: var(--grey); background: var(--grey-bg); }
/* Overdue/today: only change border so priority background (red/amber/grey) stays visible */
.task-card.task-due-overdue { border-left-width: 3px; border-left-color: var(--accent); }
.task-card.task-due-today { border-left-width: 3px; border-left-color: var(--amber); }
.task-card-tag.task-due-tag-overdue { color: var(--accent); font-weight: 600; }
.task-card-tag.task-due-tag-today { color: var(--amber); font-weight: 600; }
.task-card:hover { box-shadow: var(--shadow); border-color: var(--primary); border-left-color: var(--primary); transform: translateY(-2px); }
.task-card-top { display: flex; align-items: center; justify-content: space-between; gap: 6px; margin-bottom: 6px; }
.task-card-key-wrap { display: inline-flex; align-items: center; gap: 6px; flex: 1; min-width: 0; }
.task-card-key { font-size: .72rem; color: var(--text-3); font-weight: 600; font-family: 'Courier New', monospace; }
.task-card-you-badge {
  font-size: .65rem; font-weight: 700; padding: 2px 6px; border-radius: var(--radius-pill);
  background: var(--primary-bg); color: var(--primary); flex-shrink: 0;
}
.task-card-priority-icon { font-size: .72rem; }
.task-card-priority-icon.priority-high { color: var(--accent); }
.task-card-priority-icon.priority-medium { color: var(--amber); }
.task-card-priority-icon.priority-low { color: var(--green); }
.task-card-title { font-weight: 600; font-size: .88rem; color: var(--text); line-height: 1.4; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.task-card-footer { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.task-card-tag {
  display: inline-flex; align-items: center; gap: 4px;
  font-size: .72rem; color: var(--text-3); background: var(--bg-subtle); border-radius: 6px; padding: 3px 8px;
}
.task-card-tag i { font-size: .65rem; }
.task-list-row.task-due-overdue .task-list-due { color: var(--accent); font-weight: 600; }
.task-list-row.task-due-today .task-list-due { color: var(--amber); font-weight: 600; }
.task-card-avatar {
  width: 22px; height: 22px; border-radius: 50%; background: var(--primary-bg); color: var(--primary);
  font-size: .65rem; font-weight: 700; display: flex; align-items: center; justify-content: center; margin-left: auto; flex-shrink: 0;
}

/* List view: row background by status (grey to do, amber in progress, green done) */
.task-list-table .task-list-row { cursor: pointer; transition: background var(--transition); }
.task-list-table tbody tr.task-list-row-status-todo td { background: var(--grey-bg); }
.task-list-table tbody tr.task-list-row-status-in_progress td { background: var(--amber-bg); }
.task-list-table tbody tr.task-list-row-status-done td { background: var(--green-bg); }
.task-list-table .task-list-row:hover td { background: var(--primary-bg) !important; }
.task-list-key { font-weight: 600; color: var(--primary); font-size: .82rem; font-family: 'Courier New', monospace; }
.task-priority-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: var(--radius-pill); font-size: .72rem; font-weight: 600; }
.task-priority-badge.priority-high { background: var(--accent-bg); color: var(--accent); }
.task-priority-badge.priority-medium { background: var(--amber-bg); color: var(--amber); }
.task-priority-badge.priority-low { background: var(--green-bg); color: var(--green); }
.task-status-badge {
  display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: var(--radius-pill);
  font-size: .72rem; font-weight: 600; white-space: nowrap;
}
.task-status-badge.status-todo { background: var(--bg-subtle); color: var(--text-2); }
.task-status-badge.status-in_progress { background: var(--primary-bg); color: var(--primary); }
.task-status-badge.status-done { background: var(--green-bg); color: var(--green); }
.task-list-table { table-layout: fixed; min-width: 960px; width: 100%; }
.task-list-table td { white-space: nowrap; overflow: hidden; }
.task-list-table .task-list-title { text-overflow: ellipsis; }
.task-list-table .task-col-key { width: 100px; min-width: 100px; }
.task-list-table .task-col-title { width: 220px; min-width: 180px; }
.task-list-table .task-col-category { width: 110px; min-width: 100px; }
.task-list-table .task-col-status { width: 100px; min-width: 90px; }
.task-list-table .task-col-priority { width: 90px; min-width: 85px; }
.task-list-table .task-col-due { width: 95px; min-width: 90px; }
.task-list-table .task-col-assignee { width: 120px; min-width: 100px; }
.task-list-table .task-col-patient { width: 120px; min-width: 100px; }

/* ═══ Task detail page (task.html) — single card ═══════════════════════════════ */
.task-page .topbar-no-sidebar,
.task-page .topbar-detail { left: 0; }
.task-app {
  display: flex; flex-direction: column; min-height: 100vh; min-height: 100dvh; min-width: 0;
  padding-top: var(--safe-top);
}
.task-app .main-content { margin-top: 0; padding-top: 12px; }

.task-page-topbar {
  display: flex; align-items: center; gap: 12px; flex-shrink: 0;
  padding: 12px 16px; padding-left: max(16px, env(safe-area-inset-left));
  padding-right: max(16px, env(safe-area-inset-right));
  border-bottom: 1px solid var(--border); background: var(--card);
}
.task-topbar-back {
  display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;
  border: none; border-radius: var(--radius); background: transparent; color: var(--text);
  cursor: pointer; transition: background .15s;
}
.task-topbar-back:hover { background: var(--bg-subtle); color: var(--primary); }
.task-topbar-title {
  flex: 1; min-width: 0; margin: 0; font-size: 1rem; font-weight: 600; color: var(--text);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.task-topbar-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
.task-topbar-actions .btn { padding: 6px 12px; font-size: .85rem; }

/* Patient detail top bar (same layout as task) */
.patient-app { display: flex; flex-direction: column; min-height: 100vh; min-height: 100dvh; min-width: 0; padding-top: var(--safe-top); }
.patient-app .main-content { margin-top: 0; padding-top: 12px; }
.patient-page-topbar {
  display: flex; align-items: center; gap: 12px; flex-shrink: 0;
  padding: 12px 16px; padding-left: max(16px, env(safe-area-inset-left)); padding-right: max(16px, env(safe-area-inset-right));
  border-bottom: 1px solid var(--border); background: var(--card);
}
.patient-topbar-back {
  display: flex; align-items: center; justify-content: center; width: 40px; height: 40px;
  border: none; border-radius: var(--radius); background: transparent; color: var(--text); cursor: pointer; transition: background .15s;
}
.patient-topbar-back:hover { background: var(--bg-subtle); color: var(--primary); }
.patient-topbar-title {
  flex: 1; min-width: 0; margin: 0; font-size: 1rem; font-weight: 600; color: var(--text);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.patient-topbar-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
.patient-topbar-actions .btn { padding: 6px 12px; font-size: .85rem; }

/* Patient header card — left: image + name; right: admission, diagnosis list, doctors list */
.pd-header-card {
  display: flex; align-items: flex-start; flex-wrap: wrap;
  padding: 20px; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  margin-bottom: 20px; box-shadow: var(--shadow-sm);
  gap: 0;
}
.pd-header-card-left {
  flex: 0 0 50%; box-sizing: border-box;
  display: flex; flex-direction: column; align-items: flex-start; gap: 12px;
  min-width: 0; padding-right: 20px;
}
.pd-header-avatar {
  width: 72px; height: 72px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem; font-weight: 700; color: #fff;
}
.pd-header-name { font-size: 1.25rem; font-weight: 700; margin: 0; color: var(--text); word-break: break-word; }
.pd-header-card-right {
  flex: 0 0 50%; box-sizing: border-box;
  min-width: 0; padding-left: 20px;
  border-left: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 14px;
}
.pd-header-detail-row { display: flex; flex-direction: column; gap: 2px; }
.pd-header-block { display: flex; flex-direction: column; gap: 4px; }
.pd-header-label { font-size: .75rem; font-weight: 600; text-transform: uppercase; letter-spacing: .04em; color: var(--text-3); }
.pd-header-value { font-size: .9rem; color: var(--text); }
.pd-header-detail-lines { display: flex; flex-direction: column; gap: 2px; }
.pd-header-detail-line { font-size: .9rem; color: var(--text-2); line-height: 1.4; }
.pd-header-detail-muted { color: var(--text-3); }
.pd-header-card .discharge-days-overdue,
.pd-header-card .discharge-days-urgent,
.pd-header-card .discharge-days-warning,
.pd-header-card .discharge-days-ok,
.pd-header-card .discharge-days-none { padding: 2px 8px; border-radius: var(--radius); font-size: .85em; font-weight: 600; }

/* Patient detail: single card for tabs + content (Overview / Comments / History) */
.pd-main-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow-sm);
}
.pd-main-card .tab-bar { margin-bottom: 20px; }
.pd-main-card #pd-content { padding: 0; }

/* Task detail comments */
.task-detail-comments { margin-top: 20px; }
.task-detail-comments-hd { font-size: .85rem; font-weight: 700; color: var(--text); margin-bottom: 12px; }
.task-detail-comments-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 14px; }
.task-detail-comment {
  padding: 12px 14px; background: var(--bg-subtle); border-radius: var(--radius);
  border-left: 3px solid var(--primary); font-size: .88rem; line-height: 1.5;
}
.task-detail-comment-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 4px; }
.task-detail-comment-text { color: var(--text); white-space: pre-wrap; word-break: break-word; }
.task-detail-comments-empty { font-size: .88rem; color: var(--text-3); padding: 16px 0; }
.task-detail-comments-form { display: flex; gap: 8px; align-items: flex-end; }
.task-detail-comments-form .fi { flex: 1; min-width: 0; resize: none; min-height: 36px; padding: 8px 12px; }
.task-detail-comments-form .btn { flex-shrink: 0; }

/* Task edit form (no inline edits) */
.task-edit-card { }
.task-edit-hd { font-size: 1rem; font-weight: 700; color: var(--text); margin: 0 0 20px 0; }
.task-edit-form { display: flex; flex-direction: column; gap: 16px; }
.task-edit-field { display: flex; flex-direction: column; gap: 6px; }
.task-edit-label { font-size: .85rem; font-weight: 600; color: var(--text-2); }
.task-edit-form .fi { padding: 8px 12px; border-radius: var(--radius); border: 1px solid var(--border); }
.task-edit-form textarea.fi { min-height: 100px; resize: vertical; }
.task-edit-meta-row { display: flex; flex-wrap: wrap; gap: 16px; }
.task-edit-meta-row .task-edit-field { min-width: 140px; flex: 1; }
.task-edit-readonly { font-size: .88rem; color: var(--text-3); }
.task-edit-meta-label { font-weight: 600; color: var(--text-2); }
.task-edit-actions { display: flex; gap: 10px; margin-top: 8px; }

.task-detail-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  padding: 28px 32px; box-shadow: var(--shadow-sm); max-width: 720px;
}
.task-detail-key {
  font-size: .82rem; font-weight: 700; color: var(--primary); font-family: 'Courier New', monospace;
  margin-bottom: 8px;
}
.task-detail-title-wrap { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 14px; }
.task-detail-title {
  font-size: 1.35rem; font-weight: 700; margin: 0; color: var(--text); line-height: 1.35; flex: 1;
  border: 2px solid transparent; border-radius: 10px; padding: 4px 8px; margin: -4px -8px;
  transition: border-color var(--transition), background var(--transition);
}
.task-detail-title:hover { background: var(--bg-subtle); }
.task-detail-title:focus { outline: none; border-color: var(--primary); background: var(--card); box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.task-detail-title-save { display: none; align-self: center; }
.task-detail-title-wrap.editing .task-detail-title-save { display: inline-flex; }

/* Description — smaller, muted */
.task-detail-desc-block { margin-bottom: 20px; }
.task-detail-desc-view {
  font-size: .88rem; line-height: 1.6; color: var(--text-3); white-space: pre-wrap; word-break: break-word;
  min-height: 24px; padding: 6px 0;
}
.task-detail-muted { color: var(--text-3); }
.task-detail-desc-edit { display: none; }
.task-detail-desc-edit textarea {
  width: 100%; box-sizing: border-box; min-height: 100px; font-family: inherit;
  font-size: .88rem; line-height: 1.6; padding: 12px; border: 2px solid var(--primary);
  border-radius: 10px; resize: vertical; background: var(--card);
  box-shadow: 0 0 0 3px rgba(20,184,166,.12);
}
.task-detail-desc-actions { display: flex; gap: 8px; margin-top: 8px; }

/* Meta rows: row1 = Priority, Due, Patient; row2 = Assignee, Status — same height */
.task-detail-meta-row {
  display: flex; flex-wrap: wrap; gap: 16px 24px; margin-bottom: 12px; align-items: stretch;
}
.task-detail-meta-row-2 { margin-bottom: 18px; }
.task-detail-meta-item.task-detail-meta-cell {
  display: flex; flex-direction: column; gap: 4px; min-width: 0; min-height: 52px; justify-content: flex-start;
}
.task-detail-meta-label {
  font-size: .72rem; font-weight: 600; color: var(--text-3); text-transform: uppercase; letter-spacing: .04em;
}
.task-detail-meta-value {
  font-size: .88rem; color: var(--text); display: flex; align-items: center; min-height: 36px;
}
.task-detail-meta-value .fi.task-detail-meta-input { width: 100%; max-width: 180px; font-size: .85rem; padding: 6px 10px; min-height: 36px; box-sizing: border-box; }
/* Overdue / due today: subtle left border only, no heavy background — keeps same look as other fields */
.task-detail-meta-due.task-due-overdue .task-detail-meta-value {
  padding-left: 10px; margin-left: -2px; border-left: 3px solid var(--accent); border-radius: 2px;
  font-size: .85rem;
}
.task-detail-meta-due.task-due-today .task-detail-meta-value {
  padding-left: 10px; margin-left: -2px; border-left: 3px solid var(--amber); border-radius: 2px;
  font-size: .85rem;
}
.task-detail-meta-due .task-detail-meta-value,
.task-detail-meta-due .fi.task-detail-meta-input { font-size: .85rem; }
.task-detail-meta-due.task-due-overdue .fi.task-detail-meta-input,
.task-detail-meta-due.task-due-today .fi.task-detail-meta-input { font-size: .85rem; }
.task-detail-link { color: var(--primary); text-decoration: none; font-weight: 500; font-size: .88rem; }
.task-detail-link:hover { text-decoration: underline; }

.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

/* JIRA-style pill dropdowns */
.task-detail-pill-dropdown { position: relative; display: inline-block; }
.pill-trigger {
  display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border: none;
  border-radius: var(--radius); background: transparent; cursor: pointer; font: inherit;
  transition: box-shadow .15s;
}
.pill-trigger:hover { background: rgba(0,0,0,.04); }
[data-theme="dark"] .pill-trigger:hover { background: rgba(255,255,255,.06); }
.pill-trigger:focus { outline: none; box-shadow: 0 0 0 2px rgba(20,184,166,.35); }
.pill {
  display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: .7rem; font-weight: 700;
  letter-spacing: .04em; text-transform: uppercase; white-space: nowrap;
}
.pill-status-todo { background: #64748b; color: #fff; }
.pill-status-in_progress { background: var(--amber); color: #1c1917; }
.pill-status-done { background: var(--green); color: #1c1917; }
.pill-priority-high { background: var(--accent); color: #fff; }
.pill-priority-medium { background: var(--amber); color: #1c1917; }
.pill-priority-low { background: var(--green); color: #1c1917; }
.task-detail-pill-category { background: var(--bg-subtle); color: var(--text-2); }
.pill-chevron { font-size: .65rem; color: var(--text-3); }
.task-detail-pill-trigger {
  display: inline-flex; align-items: center; gap: 2px; padding: 0; border: none; border-radius: 999px;
  cursor: pointer; font: inherit; background: transparent;
}
.task-detail-pill-trigger .task-detail-pill-value { flex-shrink: 0; }
.task-detail-pill-trigger .pill-chevron { padding: 0 6px; opacity: .85; }
.task-detail-pill-trigger:hover .pill-chevron { opacity: 1; }
.pill-dropdown-panel {
  position: absolute; left: 0; top: 100%; margin-top: 4px; min-width: 180px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  box-shadow: var(--shadow-lg); z-index: 50; padding: 6px 0;
}
.pill-option {
  display: flex; align-items: center; gap: 10px; padding: 8px 14px; cursor: pointer;
  font-size: .85rem; transition: background .1s;
}
.pill-option:hover { background: var(--bg-subtle); }
.pill-option-label { flex: 1; color: var(--text); }
.pill-option-arrow { width: 16px; color: var(--text-3); text-align: center; }
.pill-option-arrow::after { content: '→'; }
.pill-option .pill { flex-shrink: 0; }

/* Created line */
.task-detail-created { font-size: .8rem; color: var(--text-3); margin-bottom: 16px; }
.task-detail-sep { border: none; border-top: 1px solid var(--border); margin: 0 0 16px 0; }
.task-detail-footer-bar { font-size: .85rem; }

/* ─── Table ───────────────────────────────────────────────────── */
.table-wrap {
  overflow-x: auto; -webkit-overflow-scrolling: touch; max-width: 100%; contain: layout;
  background: var(--card); border-radius: var(--radius); border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
table { width: 100%; border-collapse: collapse; font-size: .85rem; }
th {
  text-align: left; padding: 10px 14px; font-weight: 600; color: var(--text-3);
  border-bottom: 1px solid var(--border); font-size: .75rem;
  letter-spacing: .05em; text-transform: uppercase; word-break: normal; overflow-wrap: break-word; min-width: 3.5em;
  background: var(--bg-subtle); position: sticky; top: 0; z-index: 2;
}
th:first-child { border-radius: var(--radius) 0 0 0; }
th:last-child { border-radius: 0 var(--radius) 0 0; }
td { padding: 10px 14px; border-bottom: 1px solid var(--border); vertical-align: middle; word-break: normal; overflow-wrap: break-word; min-width: 3.5em; }
table:not(.task-list-table) tbody tr:nth-child(even) td { background: var(--bg-subtle); }
tr:hover td { background: var(--primary-bg); }
tr.clickable { cursor: pointer; }

/* ─── Patient List ────────────────────────────────────────────── */
/* Page toolbar (reusable header bar for any page) */
.page-toolbar {
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px; margin-bottom: 12px; flex-wrap: wrap;
}
.page-toolbar-left {
  display: flex; align-items: baseline; gap: 10px; min-width: 0;
}
.page-toolbar-count {
  font-size: .78rem; color: var(--text-3); font-weight: 500; white-space: nowrap;
}
.page-filters {
  display: flex; align-items: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap;
}

.patients-toolbar {
  display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;
}
.patients-toolbar .search-box { flex: 1; min-width: 0; max-width: 400px; }
.patients-toolbar .btn { flex-shrink: 0; }

.list-toolbar {
  display: flex; align-items: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap;
}
.search-box {
  flex: 1; min-width: 0; position: relative; max-width: 100%;
}
.search-box input {
  width: 100%; padding: 9px 14px 9px 38px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem; background: var(--card);
  transition: border-color var(--transition), box-shadow var(--transition);
}
.search-box input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.1); }
.search-box i {
  position: absolute; left: 13px; top: 50%; transform: translateY(-50%);
  color: var(--text-3); font-size: .82rem;
}
.filter-select {
  padding: 9px 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .85rem; background: var(--card); color: var(--text);
  transition: border-color var(--transition), box-shadow var(--transition);
  appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
}
.filter-select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.1); }

.pt-filter-btn {
  padding: 8px 16px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .85rem; font-weight: 500; color: var(--text-2); background: var(--card);
  cursor: pointer; transition: background .15s, border-color .15s, color .15s;
}
.pt-filter-btn:hover { background: var(--bg-subtle); border-color: var(--text-3); }
.pt-filter-btn.active,
.pt-filter-btn[aria-pressed="true"] {
  background: var(--primary-bg); color: var(--primary); border-color: var(--primary);
}

/* ─── Patient Detail ──────────────────────────────────────────── */
#page-patient-detail > #pd-header { width: 100%; max-width: 100%; box-sizing: border-box; }
.pd-clinical-snapshot {
  margin-top: 14px; padding: 14px 16px; background: var(--card); border: 1px solid var(--border);
  border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);
}
.pd-snapshot-title { font-size: .8rem; font-weight: 600; color: var(--text-3); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
.pd-snapshot-title i { color: var(--primary); }
.pd-snapshot-grid { display: flex; flex-wrap: wrap; gap: 12px 20px; }
.pd-snapshot-item { display: flex; align-items: center; gap: 8px; font-size: .9rem; }
.pd-snapshot-label { color: var(--text-3); font-size: .85rem; flex-shrink: 0; }
.pd-snapshot-value { color: var(--text); word-break: break-word; }
.pd-snapshot-item .risk-badge { flex-shrink: 0; }
.pd-snapshot-item .discharge-days { padding: 2px 8px; border-radius: var(--radius); font-size: .85rem; }
.patient-header {
  display: flex; flex-direction: column; gap: 14px; margin-bottom: 20px; width: 100%; max-width: 100%; box-sizing: border-box;
}
.patient-header-top {
  display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; width: 100%; max-width: 100%; box-sizing: border-box;
}
.patient-header-top .risk-badge { flex-shrink: 0; }
.patient-header-top .patient-actions { flex-shrink: 0; display: flex; gap: 8px; align-items: center; }
.patient-details-vertical {
  display: flex; flex-direction: column; gap: 6px;
}
.patient-detail-row { font-size: .9rem; display: flex; align-items: baseline; gap: 10px; flex-wrap: wrap; }
.patient-detail-label { color: var(--text-3); font-size: .85rem; flex: 0 0 180px; min-width: 0; white-space: nowrap; }
.patient-detail-value { color: var(--text); word-break: break-word; min-width: 0; }
.patient-header h2 { font-size: 1.3rem; font-weight: 700; word-break: normal; overflow-wrap: break-word; min-width: 0; }
.patient-meta { display: flex; gap: 16px; flex-wrap: wrap; color: var(--text-2); font-size: .85rem; }
.patient-meta span { display: flex; align-items: center; gap: 4px; word-break: normal; overflow-wrap: break-word; white-space: normal; }
.patient-actions { flex-shrink: 0; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

.patient-detail-bottom { margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border); }
.patient-detail-bottom-actions { display: flex; align-items: center; justify-content: center; gap: 8px; }

.tab-bar {
  display: flex; gap: 4px; margin-bottom: 22px;
  overflow-x: auto; overflow-y: hidden; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; max-width: 100%;
  align-items: stretch; min-height: 42px;
  background: var(--bg-subtle); border-radius: 12px; padding: 4px;
}
.tab-bar::-webkit-scrollbar { height: 4px; }
.tab-btn {
  flex: 0 0 auto; padding: 8px 18px; border: none; background: none; font-size: .85rem;
  font-weight: 500; color: var(--text-3); white-space: nowrap; cursor: pointer;
  border-radius: 8px; transition: all var(--transition);
}
.tab-btn:hover { color: var(--text); background: rgba(255,255,255,.5); }
.tab-btn.active { color: var(--primary); background: var(--card); font-weight: 600; box-shadow: var(--shadow-sm); }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeUp .2s ease; }

/* Trend chart (overview – reports by week) */
.trend-chart {
  display: flex; flex-direction: column; gap: 10px;
  padding: 12px 0; border-left: 3px solid var(--primary); padding-left: 14px; margin-left: 2px;
}
.trend-scale {
  display: flex; justify-content: space-between; align-items: center;
  font-size: .7rem; color: var(--text-3); margin-bottom: 4px; padding-right: 2.5em;
}
.trend-scale-max { font-variant-numeric: tabular-nums; }
.trend-row {
  display: flex; align-items: center; gap: 10px;
  min-height: 32px;
}
.trend-label {
  flex: 0 0 110px; font-size: .8rem; color: var(--text-2);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.trend-bar-wrap {
  flex: 1; min-width: 0; height: 22px; background: var(--border); border-radius: 6px; overflow: hidden;
  display: block;
}
.trend-bar {
  display: block; height: 22px; min-height: 22px; min-width: 6px;
  background: var(--primary); border-radius: 6px;
  transition: width .3s ease;
}
.trend-value {
  flex: 0 0 2.2em; font-size: .9rem; font-weight: 700; color: var(--primary);
  text-align: right;
}
.trend-empty { margin: 0; color: var(--text-3); font-size: .9rem; }

/* ─── Forms ───────────────────────────────────────────────────── */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.form-grid .fg-full { grid-column: 1 / -1; }
.fg textarea {
  width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem; resize: vertical; min-height: 80px;
  background: var(--bg); transition: border-color var(--transition), box-shadow var(--transition);
}
.fg textarea:focus { border-color: var(--primary); outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.fg select {
  width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem; background: var(--bg);
  transition: border-color var(--transition), box-shadow var(--transition);
  appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px;
}
.fg select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }

/* Rating rows (psychiatric/behavioral) */
.rating-row {
  display: flex; align-items: center; gap: 10px; padding: 8px 0;
  border-bottom: 1px solid var(--border);
}
.rating-row:last-child { border-bottom: none; }
.rating-label { flex: 1; font-size: .88rem; font-weight: 500; }
.rating-btns { display: flex; gap: 4px; }
.rating-btn {
  width: 34px; height: 34px; border-radius: 8px; border: 1.5px solid var(--border);
  background: var(--card); font-size: .82rem; font-weight: 600; cursor: pointer;
  transition: all var(--transition); color: var(--text-2);
}
.rating-btn:hover { border-color: var(--primary); }
.rating-btn.selected { background: var(--primary); color: #fff; border-color: var(--primary); }

/* ADL level select */
.adl-row {
  display: flex; align-items: center; justify-content: space-between; gap: 10px;
  padding: 8px 0; border-bottom: 1px solid var(--border);
}
.adl-row:last-child { border-bottom: none; }
.adl-label { font-size: .88rem; font-weight: 500; }
.adl-select {
  padding: 7px 12px; border: 1.5px solid var(--border); border-radius: 8px;
  font-size: .82rem; background: var(--card);
}

/* ─── Chat (WhatsApp-style: channels pinned top, input fixed bottom) ── */
.chat-layout { display: flex; gap: 16px; height: calc(100vh - var(--safe-top) - 120px); min-height: 400px; }
.chat-layout-wa { display: block; height: calc(100vh - var(--safe-top) - 100px); min-height: 360px; }
.chat-layout-wa .chat-main {
  display: flex; flex-direction: column; height: 100%;
  background: var(--card); border-radius: 16px; border: 1px solid var(--border);
  overflow: hidden; box-shadow: var(--shadow-sm);
}
.channel-list {
  width: 200px; flex-shrink: 0; background: var(--card); border-radius: 16px;
  border: 1px solid var(--border); overflow-y: auto;
}
.channel-list-pinned {
  width: 100%; flex-shrink: 0; flex-direction: row; flex-wrap: nowrap;
  overflow-x: auto; overflow-y: hidden; padding: 10px 14px; gap: 8px;
  border-bottom: 1px solid var(--border); background: var(--bg-subtle);
  -webkit-overflow-scrolling: touch;
}
.channel-list-pinned .channel-item {
  flex: 0 0 auto; padding: 8px 16px; border-radius: var(--radius-pill); border: 1px solid var(--border);
  border-bottom: none; white-space: nowrap;
}
.channel-list-pinned .channel-item.active { border-color: var(--primary); background: var(--primary-bg); }
.channel-list-pinned .channel-unread { margin-left: 6px; }
.channel-item {
  padding: 10px 14px; cursor: pointer; font-size: .88rem; border-bottom: 1px solid var(--border);
  transition: background var(--transition); display: flex; align-items: center; gap: 8px;
}
.channel-item:hover { background: var(--bg-subtle); }
.channel-item.active { background: var(--primary-bg); color: var(--primary); font-weight: 600; }
.channel-item:last-child { border-bottom: none; }
.channel-unread {
  margin-left: auto; background: var(--accent); color: #fff; font-size: .7rem; font-weight: 700;
  min-width: 18px; padding: 2px 7px; border-radius: var(--radius-pill); text-align: center;
}
.chat-main { flex: 1; display: flex; flex-direction: column; background: var(--card); border-radius: 16px; border: 1px solid var(--border); }
.chat-header { padding: 14px 18px; border-bottom: 1px solid var(--border); font-weight: 700; font-size: .95rem; flex-shrink: 0; display: flex; align-items: center; gap: 8px; }
.msg-list { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; min-height: 0; }
.chat-compose-fixed { flex-shrink: 0; border-top: 1px solid var(--border); }
.msg-wrap { display: flex; }
.msg-wrap.mine { justify-content: flex-end; }
.msg-bubble {
  max-width: 70%; padding: 10px 14px; border-radius: 16px;
  font-size: .88rem; line-height: 1.45;
}
.msg-bubble.theirs { background: var(--bg-subtle); border-bottom-left-radius: 4px; color: var(--text); }
.msg-bubble.mine { background: var(--primary); color: #fff; border-bottom-right-radius: 4px; }
.msg-bubble.urgent { background: var(--accent-bg); border: 1px solid var(--accent); color: var(--text); }
.msg-bubble.mine.urgent { background: #c53030; border-color: #a82828; color: #fff; }
.msg-meta { font-size: .7rem; margin-top: 4px; opacity: .7; }
.chat-compose {
  display: flex; align-items: center; gap: 10px; padding: 14px 18px;
  border-top: 1px solid var(--border);
}
.chat-compose input {
  flex: 1; padding: 10px 14px; border: 1.5px solid var(--border);
  border-radius: 10px; font-size: .88rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}
.chat-compose input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.urgent-toggle {
  display: flex; align-items: center; gap: 4px; padding: 7px 12px; border-radius: 10px;
  border: 1.5px solid var(--border); background: var(--card); font-size: .78rem; cursor: pointer;
  color: var(--text-3); transition: all var(--transition);
}
.urgent-toggle.active { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* WhatsApp-like chat UI — fixed viewport layer so only .wa-msg-list scrolls (fixes iOS PWA page scroll) */
#page-comms.page.active {
  position: fixed;
  top: var(--safe-top);
  left: 0;
  right: 0;
  bottom: var(--bottom-nav-h);
  width: 100%;
  height: calc(100dvh - var(--safe-top) - var(--bottom-nav-h));
  z-index: 50;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--bg);
  padding: 0;
}
/* Web view: don't hide chat behind sidebar — start content to the right of the sidebar */
@media (min-width: 769px) {
  #page-comms.page.active {
    left: var(--sidebar-w);
    width: calc(100% - var(--sidebar-w));
  }
}
/* Prevent body scroll when chat is open (iOS PWA) */
body:has(#page-comms.page.active) {
  overflow: hidden;
  overscroll-behavior: none;
  touch-action: none;
}
body:has(#page-comms.page.active) .wa-msg-list {
  touch-action: pan-y;
}
.main-content:has>(#page-comms.page.active) {
  overflow: hidden;
  padding: 0;
}
.wa-chat {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  background: var(--wa-chat-bg, #e5ddd5);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0,0,0,.08);
}
.wa-chat-header {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px 14px;
  background: var(--wa-header-bg, #075e54);
  color: #fff;
}
.wa-chat-header-title { font-size: 1.05rem; font-weight: 600; letter-spacing: .01em; }
.wa-chat-header-actions { display: flex; align-items: center; gap: 4px; }
.wa-chat-header-btn {
  width: 40px; height: 40px; border: none; background: transparent; color: rgba(255,255,255,.9);
  border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; transition: background .15s ease;
}
.wa-chat-header-btn:hover { background: rgba(255,255,255,.15); }
.wa-channels {
  flex-shrink: 0;
  display: flex;
  gap: 8px;
  padding: 10px 14px;
  background: var(--wa-header-bg, #075e54);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-top: 1px solid rgba(255,255,255,.1);
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
}
.wa-channels .channel-item {
  flex: 0 0 auto; padding: 6px 14px; border-radius: 18px; white-space: nowrap;
  font-size: .85rem; color: rgba(255,255,255,.9); cursor: pointer;
  background: rgba(255,255,255,.15); border: none;
  display: inline-flex; align-items: center; gap: 6px; transition: background .15s ease;
}
.wa-channels .channel-item:hover { background: rgba(255,255,255,.25); }
.wa-channels .channel-item.active { background: #fff; color: #075e54; font-weight: 600; }
.wa-channels .channel-unread {
  background: #25d366; color: #fff; font-size: .7rem; font-weight: 700;
  min-width: 18px; padding: 2px 6px; border-radius: 10px; text-align: center; margin-left: 4px;
}
.wa-msg-list {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  overflow-x: clip;
  padding: 12px 16px 8px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  background: var(--wa-chat-bg, #e8e4df);
  -webkit-overflow-scrolling: touch;
}
.wa-msg-list .msg-wrap { display: flex; flex-direction: column; align-items: flex-start; max-width: 85%; }
.wa-msg-list .msg-wrap.mine { align-items: flex-end; align-self: flex-end; }
.wa-msg-list .msg-sender {
  font-size: .75rem; color: var(--wa-sender-color, #0a6e5c); font-weight: 600; margin-bottom: 2px; margin-left: 12px;
}
.wa-msg-list .msg-bubble {
  padding: 8px 12px 6px; border-radius: 18px; font-size: .9rem; line-height: 1.4;
  max-width: 100%; word-wrap: break-word; position: relative;
  display: inline-flex; flex-wrap: wrap; align-items: flex-end; gap: 4px 8px;
  box-shadow: 0 1px 1px rgba(0,0,0,.08);
}
.wa-msg-list .msg-bubble.theirs {
  background: #fff; color: var(--text); border-bottom-left-radius: 4px;
}
.wa-msg-list .msg-bubble.mine {
  background: var(--wa-sent-bg, #dcf8c6); color: var(--text); border-bottom-right-radius: 4px;
}
.wa-msg-list .msg-bubble.urgent { background: #fef3c7; border: 1px solid #d97706; color: #92400e; }
.wa-msg-list .msg-bubble.mine.urgent { background: #b91c1c; border: 1px solid #991b1b; color: #fff; }
.wa-msg-list .msg-bubble.mine.urgent .msg-time { color: rgba(255,255,255,.9); }
.wa-msg-list .msg-text { flex: 1 1 100%; }
.wa-msg-list .msg-link {
  color: #0a6e5c;
  text-decoration: underline;
  word-break: break-all;
}
.wa-msg-list .msg-link:hover { color: #075e54; opacity: 0.9; }
[data-theme="dark"] .wa-msg-list .msg-link { color: #2dd4bf; }
[data-theme="dark"] .wa-msg-list .msg-link:hover { color: #5eead4; }
.wa-msg-list .msg-time { font-size: .7rem; color: var(--text-3); opacity: .85; }
.wa-msg-list .msg-urgent-icon { margin-right: 4px; font-size: .75rem; }
.wa-compose {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px 14px;
  padding-bottom: max(14px, env(safe-area-inset-bottom));
  background: var(--wa-compose-bg, #f0f2f5);
  box-shadow: 0 -2px 10px rgba(0,0,0,.06);
}
.wa-compose-input {
  flex: 1; padding: 10px 16px; border: none; border-radius: 24px; font-size: .9rem;
  background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,.08);
  transition: box-shadow .15s ease;
}
.wa-compose-input::placeholder { color: var(--text-3); }
.wa-compose-input:focus { outline: none; box-shadow: 0 1px 4px rgba(0,0,0,.12); }
.wa-urgent-btn {
  width: 40px; height: 40px; border: none; background: #fff; border-radius: 50%;
  color: var(--text-3); cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; box-shadow: 0 1px 2px rgba(0,0,0,.08); transition: color .15s ease, background .15s ease;
}
.wa-urgent-btn:hover { color: var(--accent); }
.wa-urgent-btn.active { background: var(--accent-bg); color: var(--accent); }
.wa-send-btn {
  width: 44px; height: 44px; border: none; background: var(--wa-header-bg, #075e54);
  color: #fff; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 1rem; transition: transform .1s ease, opacity .15s ease;
}
.wa-send-btn:hover { opacity: .95; transform: scale(1.05); }
.wa-msg-list .empty-state { padding: 24px; text-align: center; color: var(--text-2); }
.wa-msg-list .empty-state i { font-size: 2rem; opacity: .5; margin-bottom: 8px; display: block; }

/* Chat date separator (WhatsApp-style in-list label) */
.wa-msg-list-inner {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-height: min-content;
}
.wa-date-sep {
  align-self: center;
  margin: 8px 0 4px;
  padding: 6px 14px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--text-2);
  background: rgba(0, 0, 0, 0.08);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
}
[data-theme="dark"] .wa-date-sep {
  background: rgba(255, 255, 255, 0.12);
  color: var(--text-2);
}

/* Chat date popup (WhatsApp-style when scrolling) */
.wa-date-popup {
  position: sticky;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
  align-self: center;
  margin: 8px 0 0;
  padding: 6px 14px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--text-2);
  background: rgba(0, 0, 0, 0.08);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;
}
.wa-date-popup.visible {
  opacity: 1;
}
.wa-date-popup[hidden] {
  display: none;
}
[data-theme="dark"] .wa-date-popup {
  background: rgba(255, 255, 255, 0.15);
  color: var(--text);
}

/* ─── Family Report ───────────────────────────────────────────── */
.fr-controls { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
.fr-controls select, .fr-controls input { padding: 9px 14px; border: 1.5px solid var(--border); border-radius: 10px; font-size: .85rem; }
.lbtn {
  padding: 7px 16px; border: 1.5px solid var(--border); border-radius: var(--radius-pill);
  background: var(--card); font-size: .82rem; cursor: pointer; transition: all var(--transition);
}
.lbtn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
.fr-preview { margin-top: 16px; max-width: 100%; }
.fr-report-content { max-width: 100%; overflow-x: hidden; }
.rh { background: var(--primary); color: #fff; padding: 26px; border-radius: 16px 16px 0 0; text-align: center; overflow-wrap: break-word; }
.rh-c { font-size: .85rem; opacity: .85; margin-bottom: 4px; }
.rh-t { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; }
.rh-d, .rh-s { font-size: .82rem; opacity: .9; }
.frs { margin-bottom: 14px; }
.frs-t { font-weight: 600; margin-bottom: 4px; color: var(--primary); }
.frs-b { font-size: .88rem; color: var(--text-2); line-height: 1.5; }
.pbw { margin-bottom: 10px; }
.pbt { display: flex; justify-content: space-between; font-size: .82rem; margin-bottom: 4px; }
.pbtr { height: 8px; background: var(--grey-bg); border-radius: 4px; overflow: hidden; }
.pbf { height: 100%; background: var(--primary); border-radius: 4px; transition: width .5s ease; }
.wt { font-size: .82rem; }
.wt .chg { color: var(--green); font-weight: 600; }
.tipr { display: flex; gap: 10px; align-items: flex-start; margin-bottom: 10px; }
.tipn { width: 24px; height: 24px; border-radius: 50%; background: var(--primary); color: #fff; display: flex; align-items: center; justify-content: center; font-size: .72rem; font-weight: 700; flex-shrink: 0; }
.tipt { font-size: .85rem; color: var(--text-2); }
.fr-foot { text-align: center; font-size: .78rem; color: var(--text-3); padding: 16px 0; border-top: 1px solid var(--border); margin-top: 16px; }
.alert { padding: 14px 18px; border-radius: 12px; font-size: .85rem; margin-bottom: 14px; }
.alert-warn { background: var(--amber-bg); color: var(--amber); }
.alert-info { background: var(--primary-bg); color: var(--primary); }
.alert-danger { background: var(--accent-bg); color: var(--accent); }

/* ─── Searchable dropdown ─────────────────────────────────────── */
.searchable-select { position: relative; }
.searchable-options {
  position: absolute; left: 0; right: 0; top: 100%; z-index: 100;
  max-height: 200px; overflow-y: auto; margin: 0; padding: 4px 0;
  list-style: none; background: var(--card); border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); box-shadow: var(--shadow-md); display: none;
}
.searchable-option {
  padding: 8px 12px; font-size: .88rem; cursor: pointer;
  transition: background var(--transition);
}
.searchable-option:hover { background: var(--primary-bg); color: var(--primary); }

/* ─── Admin Panel ─────────────────────────────────────────────── */
.admin-header { margin-bottom: 20px; }
.admin-header-text .pg-title { font-size: 1.5rem; }
.admin-header-text .pg-sub { color: var(--text-3); font-size: .85rem; margin: 4px 0 0; }

.admin-nav {
  display: flex; gap: 4px; margin-bottom: 20px;
  background: var(--bg-subtle); border-radius: var(--radius); padding: 4px;
  overflow-x: auto; -webkit-overflow-scrolling: touch;
}
.admin-nav-item {
  display: flex; align-items: center; gap: 6px; padding: 8px 14px;
  border-radius: var(--radius-sm); border: none; background: transparent;
  font-size: .82rem; font-weight: 500; color: var(--text-2); cursor: pointer;
  white-space: nowrap; transition: all var(--transition-fast);
}
.admin-nav-item i { font-size: .95rem; }
.admin-nav-item span { font-size: inherit; }
.admin-nav-item:hover { background: var(--card); color: var(--text); }
.admin-nav-item.active {
  background: var(--card); color: var(--primary); font-weight: 600;
  box-shadow: var(--shadow-sm);
}
.admin-panel-body { min-height: 200px; }

/* Admin: on mobile restrict to viewport and make tables scroll vertical + horizontal (not diagonal) */
@media (max-width: 768px) {
  .main-wrap:has(#page-admin.page.active) {
    max-height: calc(100vh - var(--safe-top));
    min-height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .main-content:has(#page-admin.page.active) {
    height: calc(100vh - var(--safe-top) - var(--bottom-nav-h));
    max-height: calc(100vh - var(--safe-top) - var(--bottom-nav-h));
    margin-bottom: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;
    min-height: 0;
  }
  #page-admin.page.active {
    display: flex !important;
    flex-direction: column;
    height: 100%;
    min-height: 0;
    overflow: hidden;
  }
  #page-admin .admin-header,
  #page-admin .admin-nav { flex-shrink: 0; }
  #page-admin .admin-panel-body {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  #admin-staff-wrap,
  #admin-parameters-wrap,
  #admin-audit-wrap {
    display: flex;
    flex-direction: column;
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
  }
  #admin-staff-wrap[style*="display: none"],
  #admin-parameters-wrap[style*="display: none"],
  #admin-audit-wrap[style*="display: none"],
  #admin-staff-wrap[style*="display:none"],
  #admin-parameters-wrap[style*="display:none"],
  #admin-audit-wrap[style*="display:none"] {
    display: none !important;
  }
  /* Staff tab: table area scrolls vertically and horizontally */
  #admin-staff-wrap .admin-section-bar,
  #admin-staff-wrap .admin-staff-toolbar { flex-shrink: 0; }
  #admin-staff-wrap #staff-table {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  #admin-staff-wrap .admin-staff-list-wrap {
    flex: 1;
    min-height: 0;
    overflow-x: auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  /* Parameters tab: inner scroll wrapper (single scroll container) */
  #admin-parameters-wrap .admin-tab-scroll {
    flex: 1 1 0;
    min-height: 0;
    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  /* Audit tab: inner scroll wrapper (single scroll container) */
  #admin-audit-wrap .admin-section-bar { flex-shrink: 0; }
  #admin-audit-wrap .admin-tab-scroll {
    flex: 1 1 0;
    min-height: 0;
    overflow-x: auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

.admin-section-bar {
  display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;
  margin-bottom: 16px; flex-wrap: wrap;
}
.admin-staff-toolbar { margin-bottom: 16px; }
.admin-staff-toolbar .search-box { flex: 1; min-width: 160px; max-width: 280px; }
.admin-staff-toolbar .filter-select { min-width: 140px; width: auto; }
.admin-staff-toolbar .btn { flex-shrink: 0; }
.admin-section-title { font-size: 1.1rem; font-weight: 700; color: var(--text); margin: 0; }
.admin-section-desc { font-size: .82rem; color: var(--text-3); margin-top: 2px; }

/* Staff card grid */
.staff-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;
}
.staff-card {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 16px; transition: all var(--transition);
}
.staff-card:hover { box-shadow: var(--shadow-md); transform: translateY(-1px); }
.staff-card-inactive { opacity: .6; }
.staff-card-top { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
.staff-card-avatar {
  width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: .8rem; font-weight: 700; color: #fff;
}
.staff-card-info { flex: 1; min-width: 0; }
.staff-card-name { font-size: .9rem; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.staff-card-email { font-size: .75rem; color: var(--text-3); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.staff-card-bottom { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
.staff-card-role {
  display: inline-block; padding: 3px 10px; border-radius: var(--radius-pill);
  font-size: .72rem; font-weight: 600; text-transform: capitalize;
}
.staff-card-actions { display: flex; gap: 6px; }
.staff-card-actions .btn { flex: 1; font-size: .78rem; }

/* Admin staff list view */
.admin-staff-list-wrap {
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  overflow-x: auto; overflow-y: auto; max-height: 70vh; box-shadow: var(--shadow-sm);
  -webkit-overflow-scrolling: touch;
}
.admin-staff-list {
  width: 100%; min-width: 440px; border-collapse: collapse; font-size: .88rem;
  table-layout: fixed;
}
.admin-staff-list .col-email { width: 220px; min-width: 220px; }
.admin-staff-list .col-role { width: 160px; min-width: 160px; }
.admin-staff-list .col-actions { width: 56px; min-width: 56px; }
.admin-staff-list th {
  text-align: left; padding: 12px 14px; font-weight: 600; color: var(--text-3);
  background: var(--bg-subtle); border-bottom: 1px solid var(--border);
  font-size: .75rem; text-transform: uppercase; letter-spacing: .04em;
}
.admin-staff-list th:last-child { text-align: right; }
.admin-staff-list td { padding: 12px 14px; border-bottom: 1px solid var(--border); vertical-align: middle; }
.admin-staff-list td:last-child { text-align: right; }
.admin-staff-list tbody tr:hover { background: var(--primary-bg); }
.admin-staff-list tbody tr:last-child td { border-bottom: none; }
.staff-row-inactive { opacity: .65; }
.staff-list-email { color: var(--text-2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.staff-list-role-badge {
  display: inline-block; padding: 3px 10px; border-radius: var(--radius-pill);
  font-size: .72rem; font-weight: 600; text-transform: capitalize;
}
.staff-list-actions-cell { text-align: right; }
.staff-actions-wrap { position: relative; display: inline-block; }
.staff-actions-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 32px; height: 32px; padding: 0; font-size: 1rem;
  color: var(--text-2); border: none; background: none; border-radius: var(--radius-sm);
}
.staff-actions-btn:hover { color: var(--text); }
.staff-actions-dropdown {
  position: absolute; right: 0; top: 100%; margin-top: 4px; z-index: 50;
  min-width: 140px; background: var(--card); border: 1px solid var(--border);
  border-radius: var(--radius); box-shadow: var(--shadow-lg); padding: 4px 0;
}
.staff-actions-dropdown[hidden] { display: none !important; }
.staff-actions-option {
  display: flex; align-items: center; gap: 8px; width: 100%;
  padding: 8px 14px; border: none; background: none;
  font-size: .85rem; color: var(--text); cursor: pointer; text-align: left;
  transition: background .1s;
}
.staff-actions-option:hover { background: var(--bg-subtle); }
.staff-actions-option i { width: 16px; color: var(--text-3); }
.staff-actions-deactivate { color: var(--accent); }
.staff-actions-deactivate:hover { background: var(--accent-bg); }

.staff-table td { vertical-align: middle; }
.role-badge {
  display: inline-block; padding: 2px 10px; border-radius: 12px;
  font-size: .75rem; font-weight: 600; text-transform: capitalize;
  background: var(--primary-bg); color: var(--primary);
}

/* ─── Settings ────────────────────────────────────────────────── */
.set-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.set-title { font-weight: 700; font-size: .95rem; }
.set-badge {
  background: var(--primary-bg); color: var(--primary); font-size: .75rem;
  font-weight: 700; padding: 2px 8px; border-radius: 10px;
}
.set-desc { font-size: .82rem; color: var(--text-3); margin-bottom: 12px; }
.role-check-group { display: flex; flex-wrap: wrap; gap: 10px 16px; }
.role-check { display: inline-flex; align-items: center; gap: 6px; font-size: .88rem; cursor: pointer; }
.role-check input { margin: 0; }
.diagnosis-history-list { list-style: none; padding: 0; margin: 0; }
.diagnosis-history-list li { padding: 8px 0; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 2px; }
.diagnosis-history-list li:last-child { border-bottom: none; }
.diagnosis-history-text { font-weight: 500; }
.diagnosis-history-meta { font-size: .8rem; color: var(--text-3); }

.diagnosis-consult-list { display: flex; flex-direction: column; gap: 14px; }
.diagnosis-consult-card {
  padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm);
  background: var(--card); display: flex; flex-direction: column; gap: 8px;
}
.diagnosis-consult-head {
  display: flex; flex-wrap: wrap; align-items: center; gap: 12px; font-size: .85rem; color: var(--text-2);
}
.diagnosis-consult-date { display: inline-flex; align-items: center; gap: 6px; }
.diagnosis-consult-by { color: var(--text-3); }
.diagnosis-consult-diagnosis { font-size: .9rem; }
.diagnosis-consult-notes {
  font-size: .88rem; color: var(--text-2); line-height: 1.5;
  padding: 10px 12px; background: var(--grey-bg); border-radius: var(--radius-sm); margin-top: 4px;
}

.status-consult-item { margin-bottom: 12px; }
.status-consult-item:last-child { margin-bottom: 0; }
.status-consult-note { font-size: .82rem; color: var(--text-2); margin: 6px 0 0 0; padding-left: 0; line-height: 1.45; }

/* Consultation notes — chat-like structure */
.consult-latest-diagnosis { font-size: .9rem; color: var(--text); margin-bottom: 16px; padding: 10px 12px; background: var(--grey-bg); border-radius: var(--radius-sm); line-height: 1.45; }
.consult-diagnosis-list { list-style: disc; margin: 0; padding-left: 20px; }
.consult-diagnosis-list li { margin-bottom: 4px; }
.consult-diagnosis-list li:last-child { margin-bottom: 0; }
.consult-no-diagnosis { color: var(--text-3); }
.consult-notes-hd { margin-top: 4px; }
.consult-chat { display: flex; flex-direction: column; gap: 12px; }
.consult-chat-msg { padding: 10px 14px; background: var(--grey-bg); border-radius: 12px; border: 1px solid var(--border); max-width: 100%; }
.consult-chat-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 6px; font-weight: 500; }
.consult-chat-body { font-size: .88rem; color: var(--text-2); line-height: 1.5; white-space: pre-wrap; word-break: break-word; }
.consult-no-note { font-style: italic; color: var(--text-3); }

/* Patient Notes (Comments) tab — chat-like, full window height */
.patient-notes-wrap {
  display: flex; flex-direction: column;
  min-height: calc(100vh - var(--safe-top) - 180px);
}
.patient-notes-hd {
  font-size: .85rem; font-weight: 700; color: var(--text); margin-bottom: 12px;
}
.patient-notes-list { flex: 1; overflow-y: auto; padding: 12px 0; display: flex; flex-direction: column; gap: 10px; min-height: 0; }
.patient-notes-empty { padding: 24px 16px !important; flex: 1; display: flex; align-items: center; justify-content: center; }
.patient-notes-compose { display: flex; gap: 10px; align-items: flex-end; padding: 12px 0; border-bottom: 1px solid var(--border); flex-shrink: 0; }
.patient-notes-textarea { flex: 1; min-height: 56px; resize: vertical; max-height: 120px; }
.patient-note-msg { padding: 12px 16px; background: var(--bg-subtle); border-radius: 14px; border: 1px solid var(--border); max-width: 95%; }
.patient-note-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 4px; font-weight: 500; }
.patient-note-text { font-size: .88rem; color: var(--text-2); line-height: 1.5; white-space: pre-wrap; word-break: break-word; }

.modal-card-wide { width: 520px; max-width: calc(100vw - 40px); min-width: 0; }
.pd-add-report-section-wrap { display: flex; align-items: center; gap: 10px; }
.pd-add-report-section-icon { color: var(--text-2); font-size: 1rem; }
.pd-add-report-section-wrap .fi { flex: 1; min-width: 0; }
.pd-add-report-section-pill-wrap { position: relative; display: inline-block; }
.pd-add-report-section-trigger { background: var(--bg-subtle); border: 1px solid var(--border); border-radius: var(--radius-pill); padding: 6px 12px; color: var(--text); }
.pd-add-report-section-trigger .pill { background: transparent; color: inherit; font-size: .8rem; text-transform: none; letter-spacing: 0; }
[data-theme="dark"] .pd-add-report-section-trigger { color: var(--text); }
[data-theme="dark"] .pd-add-report-section-trigger .pill { color: var(--text); }
.pd-add-report-section-panel.pill-dropdown-panel { min-width: 200px; }
.modal-sub { font-size: .88rem; color: var(--text-3); margin-bottom: 16px; }

.list-item {
  display: flex; align-items: center; gap: 6px; padding: 6px 0;
  border-bottom: 1px solid var(--border);
}
.list-item:last-child { border-bottom: none; }
.li-txt {
  flex: 1; border: 1px solid transparent; background: none; padding: 4px 8px;
  border-radius: 6px; font-size: .85rem;
}
.li-txt:focus { border-color: var(--primary); background: var(--card); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.li-up, .li-dn, .li-del {
  width: 28px; height: 28px; border: none; background: var(--bg-subtle);
  border-radius: 6px; cursor: pointer; font-size: .82rem; transition: background var(--transition);
}
.li-up:hover, .li-dn:hover { background: var(--primary-bg); color: var(--primary); }
.li-del:hover { background: var(--accent-bg); color: var(--accent); }
.add-row { display: flex; gap: 8px; margin-top: 10px; }
.add-inp {
  flex: 1; padding: 9px 12px; border: 1.5px solid var(--border);
  border-radius: 10px; font-size: .85rem;
  transition: border-color var(--transition), box-shadow var(--transition);
}
.add-inp:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(20,184,166,.12); }
.settings-actions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 16px; }

/* ─── Modal ───────────────────────────────────────────────────── */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,.4);
  backdrop-filter: blur(6px);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  padding-left: max(20px, env(safe-area-inset-left, 0px));
  padding-right: max(20px, env(safe-area-inset-right, 0px));
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
  overscroll-behavior: contain;
}
.modal-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

#modal-container {
  width: 100%;
  max-width: 520px;
  min-width: 0;
  flex-shrink: 0;
}
#modal-container:has(.modal-card-task) {
  max-width: 600px;
}

.modal-card {
  background: var(--card); border-radius: var(--radius-lg); padding: 28px;
  width: 100%;
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
  max-height: 90vh; overflow-y: auto;
  overflow-x: hidden;
  overflow-wrap: break-word;
  word-break: break-word;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  animation: modalSlideUp .2s cubic-bezier(.4,0,.2,1);
}
@keyframes modalSlideUp {
  from { opacity: 0; transform: translateY(10px) scale(.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.modal-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 14px; letter-spacing: -.01em; }
.modal-body { font-size: .88rem; color: var(--text-2); line-height: 1.55; margin-bottom: 22px; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

/* Prevent form content from affecting modal width */
#pd-add-report-form-wrap,
#pd-add-report-form-wrap .ct-card,
.modal-card .form-grid,
.modal-card .rating-row,
.modal-card .adl-row { min-width: 0; overflow-x: hidden; }

/* Constrain inputs in modals so date/inputs don't overflow on mobile; reduce vertical gap between fields */
.modal-card .fg { min-width: 0; margin-bottom: 8px; }
.modal-card .fg:last-child { margin-bottom: 0; }
.modal-card .fg .fi,
.modal-card .fg input,
.modal-card .fg select,
.modal-card .fg textarea { max-width: 100%; min-width: 0; box-sizing: border-box; }
.modal-card input[type="date"] { min-width: 0; max-width: 100%; }

/* Modal on mobile: same approach, margin from overlay padding */
@media (max-width: 768px) {
  .modal-overlay {
    padding: 16px;
    padding-left: max(16px, env(safe-area-inset-left, 0px));
    padding-right: max(16px, env(safe-area-inset-right, 0px));
  }
  .modal-card {
    padding: 22px;
    max-height: 85vh;
    border-radius: 18px;
  }
}

@media (max-width: 480px) {
  .modal-overlay {
    padding: 12px;
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
  }
  .modal-card { padding: 18px; border-radius: 16px; }
}

/* ─── Toast ───────────────────────────────────────────────────── */
#toast {
  position: fixed; bottom: calc(24px + var(--bottom-nav-h)); right: 24px; background: var(--text);
  color: #fff; padding: 10px 22px; border-radius: var(--radius-sm); font-size: .85rem;
  font-weight: 500; z-index: 300; opacity: 0; transform: translateY(10px);
  pointer-events: none; transition: all .25s ease;
  box-shadow: var(--shadow-lg);
}
#toast[data-show="true"] { opacity: 1; transform: translateY(0); pointer-events: auto; }

/* ─── PWA Install banner ───────────────────────────────────────── */
.pwa-install-banner {
  position: fixed; bottom: calc(24px + var(--safe-bottom)); left: 50%; transform: translateX(-50%);
  z-index: 290; width: calc(100% - 32px); max-width: 420px;
  box-shadow: var(--shadow-md); border-radius: 18px;
  background: var(--card); border: 1px solid var(--border);
  padding: 18px; animation: slideUpBanner .3s ease;
}
.pwa-install-banner[hidden] { display: none !important; }
@keyframes slideUpBanner { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
.pwa-install-inner { position: relative; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.pwa-install-icon {
  width: 44px; height: 44px; border-radius: 12px; flex-shrink: 0;
  background: var(--primary-bg); color: var(--primary);
  display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
}
.pwa-install-text { flex: 1; min-width: 0; }
.pwa-install-text strong { display: block; font-size: .95rem; margin-bottom: 2px; }
.pwa-install-text span { font-size: .8rem; color: var(--text-3); }
.pwa-install-actions { display: flex; gap: 8px; align-items: center; }
.pwa-install-close {
  position: absolute; top: -8px; right: -8px;
  width: 28px; height: 28px; border: none; border-radius: 50%;
  background: var(--grey-bg); color: var(--text-2); font-size: .8rem;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: background var(--transition);
}
.pwa-install-close:hover { background: var(--accent-bg); color: var(--accent); }
@media (max-width: 480px) {
  .pwa-install-banner { bottom: calc(16px + var(--safe-bottom)); width: calc(100% - 24px); padding: 12px; }
  .pwa-install-actions { width: 100%; justify-content: flex-end; }
}

/* ─── Report History ──────────────────────────────────────────── */
.hist-total { font-size: .85rem; font-weight: 600; color: var(--text-2); }
.hist-date-group { margin-bottom: 20px; }
.hist-date-group:last-child { margin-bottom: 0; }
.hist-date-header {
  font-size: .8rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: .04em;
  margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid var(--border);
}
.report-timeline { position: relative; }
.report-entry {
  padding: 16px 18px; border-left: 3px solid var(--primary-bg); margin-left: 8px;
  margin-bottom: 14px; background: var(--card); border-radius: 0 12px 12px 0;
  box-shadow: var(--shadow-sm);
  word-break: normal; overflow-wrap: break-word;
}
.report-entry-hd {
  display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;
}
.report-entry-hd strong { font-size: .88rem; }
.report-entry-time { font-size: .78rem; color: var(--text-3); }
.report-entry-body { font-size: .85rem; color: var(--text-2); line-height: 1.4; word-break: normal; overflow-wrap: break-word; }
.report-entry.clickable { cursor: pointer; }
.report-entry.clickable:hover { background: var(--grey-bg); }

.report-detail-modal .report-detail-meta { margin-bottom: 16px; font-size: .9rem; color: var(--text-2); }
.report-detail-modal .report-detail-meta p { margin: 4px 0; }
.report-detail-modal .report-detail-body { max-height: 60vh; overflow-y: auto; }
.report-detail-table { width: 100%; border-collapse: collapse; font-size: .88rem; margin-top: 8px; }
.report-detail-table td { padding: 6px 10px; border-bottom: 1px solid var(--border); vertical-align: top; }
.report-detail-table td:first-child { color: var(--text-2); width: 40%; }

.latest-summary-list { max-height: 55vh; overflow-y: auto; }
.latest-summary-item {
  padding: 12px 0; border-bottom: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 6px;
}
.latest-summary-item:last-child { border-bottom: none; }
.latest-summary-hd {
  display: flex; align-items: center; flex-wrap: wrap; gap: 8px;
}
.latest-summary-body { font-size: .88rem; color: var(--text-2); margin: 0; line-height: 1.45; }
.status-section-item .status-section-detail { margin-top: 6px; }
.status-section-item .report-detail-table { margin-top: 4px; }
.status-section-collapsible .status-section-head {
  width: 100%; display: flex; align-items: center; flex-wrap: wrap; gap: 8px; text-align: left;
  padding: 10px 12px; border: none; border-radius: var(--radius); background: var(--bg-subtle);
  cursor: pointer; font: inherit; color: inherit;
}
.status-section-collapsible .status-section-head:hover { background: var(--card); }
.status-section-collapsible .status-section-meta { font-size: .8rem; color: var(--text-3); flex: 1; min-width: 0; }
.status-section-collapsible .status-section-chevron { font-size: .7rem; color: var(--text-3); transition: transform var(--transition); flex-shrink: 0; }
.status-section-collapsible:not(.collapsed) .status-section-chevron { transform: rotate(-180deg); }
.status-section-collapsible.collapsed .status-section-detail { display: none; }
.status-section-collapsible .status-section-detail { padding: 4px 0 0 0; margin-top: 2px; margin-left: 12px; }
.status-detail-list {
  display: flex; flex-direction: column; gap: 0;
  font-size: .82rem;
  border-left: 1px solid var(--border);
  border-right: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  border-radius: 0 0 var(--radius) var(--radius);
  overflow: hidden;
}
.status-detail-row {
  display: flex; align-items: baseline; justify-content: space-between; gap: 12px;
  padding: 6px 12px;
  min-height: 32px; box-sizing: border-box;
}
.status-detail-row.average-row {
  border-top: 1px solid var(--border);
  font-weight: 600;
}
.status-detail-label { font-weight: 500; color: var(--text-2); flex: 1; min-width: 0; margin-right: 12px; }
.status-detail-value { color: var(--text); font-weight: 600; flex-shrink: 0; text-align: right; }
.status-inline {
  display: flex; flex-wrap: wrap; gap: 8px 16px; align-items: baseline;
  font-size: .88rem; color: var(--text-2); line-height: 1.5;
}
.status-kv {
  display: inline-flex; align-items: baseline; gap: 4px;
  padding: 4px 10px; border-radius: var(--radius-sm);
  background: var(--grey-bg); color: var(--text);
}
.status-kv .status-meta { font-size: .78rem; color: var(--text-3); font-weight: normal; }
.status-empty { margin: 0; padding: 6px 0; font-size: .85rem; color: var(--text-3); }
.status-diagnosis-block { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.status-sub-hd { font-size: .85rem; font-weight: 600; color: var(--text-2); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }

.load-more-btn {
  display: block; margin: 12px auto; padding: 8px 24px;
}

/* ─── Empty state ─────────────────────────────────────────────── */
.empty-state {
  text-align: center; padding: 48px 24px; color: var(--text-3);
}
.empty-state i { font-size: 2.5rem; margin-bottom: 14px; display: block; opacity: .6; }
.empty-state p { font-size: .9rem; }

/* Reports page — horizontal patient cards */
.reports-patient-cards-wrap { width: 100%; overflow: hidden; }
.reports-patient-cards {
  display: flex; gap: 12px; overflow-x: auto; padding: 8px 0;
  -webkit-overflow-scrolling: touch; scroll-snap-type: x proximity;
}
.reports-patient-card {
  flex: 0 0 auto; width: 200px; min-height: 100px; padding: 16px;
  background: var(--card); border: 1px solid var(--border); border-radius: 14px;
  box-shadow: var(--shadow-sm); scroll-snap-align: start; cursor: pointer;
  transition: box-shadow var(--transition), transform var(--transition);
}
.reports-patient-card:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
.reports-patient-card .card-name { font-weight: 700; font-size: .95rem; margin-bottom: 4px; }
.reports-patient-card .card-meta { font-size: .8rem; color: var(--text-3); margin-bottom: 6px; }
.reports-patient-card .card-summary { font-size: .78rem; color: var(--text-2); }
.reports-patient-card .badge-my-patient { margin-left: 6px; }

/* ─── Welcome banner ─────────────────────────────────────────── */
.welcome-banner {
  background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #14b8a6 100%);
  border-radius: var(--radius-lg); padding: 24px 28px; margin-bottom: 14px;
  color: #fff; position: relative; overflow: hidden;
}
.welcome-banner::after {
  content: ''; position: absolute; top: -40%; right: -10%; width: 220px; height: 220px;
  background: rgba(255,255,255,.06); border-radius: 50%;
}
.welcome-banner h2 { font-size: 1.35rem; font-weight: 700; margin-bottom: 4px; letter-spacing: -.02em; }
.welcome-banner p { font-size: .85rem; opacity: .8; }
.welcome-banner-date { font-size: .75rem; opacity: .6; margin-top: 4px; }

/* ─── Quick Action Cards ────────────────────────────────────────── */
.quick-actions-row { display: flex; gap: 10px; margin-bottom: 14px; flex-wrap: wrap; }
.quick-action-card {
  flex: 1; min-width: 140px; padding: 14px 16px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
  display: flex; align-items: center; gap: 10px; cursor: pointer;
  transition: all var(--transition);
  box-shadow: var(--shadow-sm);
}
.quick-action-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--primary); }
.quick-action-card i { font-size: 1rem; width: 36px; height: 36px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.quick-action-card .qa-label { font-size: .82rem; font-weight: 600; color: var(--text); }
.quick-action-card .qa-sub { font-size: .72rem; color: var(--text-3); margin-top: 1px; }
.qa-icon-report { background: linear-gradient(135deg, #f0fdfa, #ccfbf1); color: #0d9488; }
.qa-icon-patient { background: linear-gradient(135deg, #ede9fe, #ddd6fe); color: #7c3aed; }
.qa-icon-task { background: linear-gradient(135deg, #fff7ed, #fed7aa); color: #ea580c; }

/* ─── Patient avatar (initials) ──────────────────────────────── */
.patient-avatar {
  width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: .8rem; font-weight: 700; color: #fff; position: relative;
}
.patient-avatar.risk-none-bg { background: linear-gradient(135deg, #94a3b8, #64748b); }
.patient-avatar.risk-low-bg { background: linear-gradient(135deg, #22c55e, #16a34a); }
.patient-avatar.risk-medium-bg { background: linear-gradient(135deg, #f59e0b, #d97706); }
.patient-avatar.risk-high-bg { background: linear-gradient(135deg, #f43f5e, #e11d48); }
.patient-avatar-dot {
  position: absolute; bottom: 0; right: 0; width: 10px; height: 10px;
  border-radius: 50%; border: 2px solid var(--card);
}
.patient-avatar-dot.dot-active { background: #22c55e; }
.patient-avatar-dot.dot-discharged { background: #94a3b8; }

/* Patient card quick actions overlay */
.patient-card { position: relative; }
.patient-card-quick {
  display: none; position: absolute; top: 10px; right: 10px;
  gap: 4px;
}
.patient-card:hover .patient-card-quick { display: flex; }
.patient-card-quick button {
  width: 30px; height: 30px; border-radius: var(--radius-sm);
  background: var(--card); border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: .75rem; color: var(--text-2); cursor: pointer;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow-sm);
}
.patient-card-quick button:hover { background: var(--primary-bg); color: var(--primary); border-color: var(--primary); }

/* ─── Patient detail rich header ─────────────────────────────── */
.pd-rich-header {
  display: flex; align-items: center; gap: 16px; padding: 20px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  margin-bottom: 20px; box-shadow: var(--shadow-sm);
}
.pd-rich-avatar {
  width: 56px; height: 56px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; font-weight: 700; color: #fff;
}
.pd-rich-info { flex: 1; min-width: 0; }
.pd-rich-info h2 { font-size: 1.25rem; font-weight: 700; margin-bottom: 2px; }
.pd-rich-info .pd-rich-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: .82rem; color: var(--text-2); }
.pd-rich-info .pd-rich-meta span { display: flex; align-items: center; gap: 4px; }
.pd-rich-actions { display: flex; gap: 8px; flex-shrink: 0; }

/* Mobile FAB */
.mobile-fab {
  display: none; position: fixed; bottom: calc(24px + var(--bottom-nav-h)); right: 20px;
  width: 52px; height: 52px; border-radius: 50%;
  background: var(--primary-grad); color: #fff; border: none;
  font-size: 1.2rem; z-index: 80; cursor: pointer;
  box-shadow: 0 4px 16px rgba(20,184,166,.3);
  transition: all var(--transition);
}
.mobile-fab:hover { transform: scale(1.05); box-shadow: 0 6px 24px rgba(20,184,166,.4); }

/* ─── Bottom Navigation (mobile) ─────────────────────────────── */
/* Hide when app is not shown (loading or login) */
#app-shell[hidden] ~ .bottom-nav { display: none !important; }
.bottom-nav {
  display: none; position: fixed; bottom: 0; left: 0; right: 0;
  height: calc(56px + var(--safe-bottom)); padding-bottom: var(--safe-bottom);
  -webkit-backdrop-filter: blur(16px) saturate(150%);
  backdrop-filter: blur(16px) saturate(150%);
  background: color-mix(in srgb, var(--bg) 78%, transparent);
  border-top: 1px solid var(--border);
  z-index: 90;
}
.bottom-nav-inner {
  display: flex; align-items: center; justify-content: space-around;
  height: 56px; max-width: 500px; margin: 0 auto;
}
.bottom-nav-item {
  display: flex; flex-direction: column; align-items: center; gap: 2px;
  padding: 6px 12px; background: none; border: none; cursor: pointer;
  color: var(--text-3); font-size: .65rem; font-weight: 500;
  transition: color var(--transition-fast);
  min-width: 48px;
}
.bottom-nav-item i { font-size: 1.15rem; }
.bottom-nav-item.active { color: var(--primary); }
.bottom-nav-item:hover { color: var(--primary); }

/* ─── Skeleton loading ────────────────────────────────────────── */
.skeleton {
  background: linear-gradient(90deg, var(--bg-subtle) 25%, var(--border) 50%, var(--bg-subtle) 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s ease infinite;
  border-radius: var(--radius-sm);
}
@keyframes shimmer { from { background-position: 200% 0; } to { background-position: -200% 0; } }
.skeleton-card { height: 120px; border-radius: var(--radius); margin-bottom: 12px; }
.skeleton-stat { height: 72px; border-radius: var(--radius); }
.skeleton-line { height: 12px; margin-bottom: 8px; }
.skeleton-line.w-75 { width: 75%; }
.skeleton-line.w-50 { width: 50%; }
.skeleton-line.w-25 { width: 25%; }

/* ─── Button loading spinner ─────────────────────────────────── */
.btn.btn-loading { pointer-events: none; opacity: .7; position: relative; }
.btn.btn-loading::after {
  content: ''; width: 14px; height: 14px;
  border: 2px solid rgba(255,255,255,.3); border-top-color: #fff;
  border-radius: 50%; animation: spin .6s linear infinite;
  margin-left: 6px;
}

/* ─── Activity feed ──────────────────────────────────────────── */
.activity-feed { display: flex; flex-direction: column; gap: 0; }
.activity-item {
  display: flex; align-items: flex-start; gap: 12px; padding: 10px 0;
  border-bottom: 1px solid var(--border); font-size: .85rem;
}
.activity-item:last-child { border-bottom: none; }
.activity-icon {
  width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center; font-size: .75rem;
}
.activity-icon.type-report { background: var(--primary-bg); color: var(--primary); }
.activity-icon.type-risk { background: var(--accent-bg); color: var(--accent); }
.activity-icon.type-task { background: var(--amber-bg); color: var(--amber); }
.activity-content { flex: 1; min-width: 0; }
.activity-text { color: var(--text); line-height: 1.4; }
.activity-time { font-size: .75rem; color: var(--text-3); margin-top: 2px; }

/* ─── Responsive ──────────────────────────────────────────────── */
@media (max-width: 1100px) {
  .dash-grid { grid-template-columns: 1fr; }
  .dash-col-side { flex-direction: row; }
  .dash-col-side > * { flex: 1; min-width: 0; }
}
@media (max-width: 900px) {
  .dash-col-side { flex-direction: column; }
  .two-col { grid-template-columns: 1fr; }
  .form-grid { grid-template-columns: 1fr; }
  .staff-grid { grid-template-columns: 1fr 1fr; }
  .chat-layout { flex-direction: column; height: auto; }
  .channel-list { width: 100%; display: flex; overflow-x: auto; }
  .channel-item { white-space: nowrap; border-bottom: none; border-right: 1px solid var(--border); }
}

@media (max-width: 768px) {
  :root { --bottom-nav-h: calc(56px + env(safe-area-inset-bottom, 0px)); }
  .sb-overlay.visible { display: block; }
  .main-wrap { margin-left: 0; }
  /* Hide main app topbar on mobile; navigation is via bottom bar */
  #app-shell .topbar { display: none; }
  #app-shell { padding-top: var(--safe-top); }
  #app-shell .main-content { margin-top: 0; }
  /* Chat page: same full-screen layout on mobile; no fixed height so flex fills space */
  #app-shell .wa-chat { flex: 1; min-height: 0; }

  .task-app,
  .patient-app { padding-top: var(--safe-top); }
  .task-page .main-content,
  .patient-page .main-content { margin-top: 0; }

  .topbar {
    left: 0;
    height: calc(var(--topbar-h) + var(--safe-top));
    min-height: calc(var(--topbar-h) + var(--safe-top));
    padding-top: max(10px, var(--safe-top));
    padding-bottom: 0;
    padding-left: max(16px, calc(12px + var(--safe-left)));
    padding-right: max(16px, calc(12px + var(--safe-right)));
    gap: 10px;
    align-items: center;
  }
  .menu-btn { display: flex; align-items: center; justify-content: center; min-width: 44px; min-height: 44px; }
  .tb-title { font-size: 1.05rem; }
  .tb-breadcrumb { display: none; }
  .tb-right .notif-btn { width: 40px; height: 40px; font-size: 1.1rem; }
  .topbar-back { padding: 0 12px 0 8px; }
  .topbar-back-label { display: inline; white-space: nowrap; }
  .topbar-detail .tb-breadcrumb { display: none; }
  .topbar-detail .topbar-back-label { display: inline; }

  /* Sidebar becomes a bottom sheet on mobile — translucent blur */
  .sidebar {
    width: 100%; height: auto; max-height: 70vh;
    top: auto; bottom: 0; left: 0; right: 0;
    transform: translateY(100%);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    padding-bottom: var(--safe-bottom);
    box-shadow: 0 -8px 32px rgba(15,23,42,.25);
    overflow-y: auto;
    background: color-mix(in srgb, #1e1b4b 82%, transparent);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
    backdrop-filter: blur(16px) saturate(140%);
  }
  [data-theme="dark"] .sidebar {
    background: color-mix(in srgb, #0c0a1f 85%, transparent);
  }
  .sidebar.open { transform: translateY(0); }
  /* On mobile, hide sidebar items that are already in the bottom nav */
  .sidebar .nav-link-in-bottom-nav { display: none; }
  .sidebar .sb-nav .nav-section-label:first-of-type { display: none; }
  .sb-brand { padding: 20px 16px 12px; min-height: auto; height: auto; position: relative; }
  .sb-brand::before {
    content: ''; display: block; width: 36px; height: 4px;
    border-radius: 2px; background: rgba(255,255,255,.25);
    position: absolute; top: 8px; left: 50%; transform: translateX(-50%);
  }
  .sidebar .nav-link { font-size: .95rem; padding: 14px 16px; color: rgba(255,255,255,.8); }
  .sidebar .nav-link i { font-size: 1.05rem; width: 24px; }
  .sb-brand-text { font-size: 1rem; }
  .sb-brand .sb-name { font-size: .82rem; }
  .logout-btn { font-size: .95rem; padding: 14px 16px; }
  .nav-section-label { padding: 12px 16px 4px; }
  .main-content { padding: 16px; margin-bottom: var(--bottom-nav-h); }
  /* Keep welcome banner visible below status/notification bar */
  #page-dashboard .welcome-banner { margin-top: 8px; }
  .bottom-nav { display: block; }
  .stats-strip { gap: 8px; margin-bottom: 14px; }
  .stats-strip .stat-card { min-width: 120px; padding: 12px 14px; }
  .stats-strip .stat-card-icon { width: 32px; height: 32px; font-size: .9rem; }
  .stats-strip .stat-card-value { font-size: 1rem; }
  .patient-actions { margin-left: 0; width: 100%; flex-wrap: wrap; }
  /* Patient detail: keep badge + all buttons on one scrollable line */
  .patient-header-top { flex-direction: row; flex-wrap: nowrap; align-items: center; gap: 8px; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; min-width: 0; }
  .patient-header-top .risk-badge { flex-shrink: 0; }
  .patient-header-top .patient-actions { flex-wrap: nowrap; flex-shrink: 0; width: auto; gap: 6px; }
  .patient-header-top .patient-actions .btn { flex-shrink: 0; white-space: nowrap; padding: 6px 10px; font-size: .8rem; }
  .tab-btn { padding: 8px 12px; font-size: .8rem; }
  .card { padding: 14px; word-break: normal; overflow-wrap: break-word; }
  .fr-controls { flex-direction: column; align-items: stretch; }
  .fr-preview, .fr-report-content { max-width: 100%; overflow-x: hidden; }
  .list-toolbar .filter-select { min-width: 0; }
  /* Keep table cells readable: min-width so text doesn’t collapse to one letter per line */
  th, td { min-width: 4.5em; }
  td:first-child { min-width: 6em; }
  .mobile-fab { display: flex; align-items: center; justify-content: center; }
  .welcome-banner { padding: 18px 20px; }
  .welcome-banner h2 { font-size: 1.15rem; }
  .quick-actions-row { gap: 8px; }
  .quick-action-card { min-width: 120px; padding: 12px; }
  .pd-rich-header { flex-direction: column; text-align: center; padding: 16px; }
  .pd-rich-actions { width: 100%; justify-content: center; }
  .pd-header-card { padding: 16px; flex-wrap: nowrap; min-width: 0; }
  .pd-header-card-left { padding-right: 12px; }
  .pd-header-card-right { padding-left: 12px; }
  .staff-grid { grid-template-columns: 1fr; }
  .admin-nav { gap: 4px; padding: 4px; }
  .admin-nav-item { padding: 8px 12px; font-size: .82rem; }
  .admin-section-bar { flex-direction: column; }
  .page-toolbar { gap: 8px; }
  .page-toolbar .pg-title { font-size: 1.15rem; }
  .page-filters { gap: 8px; }
  .page-filters .search-box { max-width: 100% !important; flex: 1 1 100% !important; }
  .page-filters .filter-select { flex: 1; min-width: 0; }
}

/* PWA standalone: optional blur strip only when device reports a top safe area */
@media (max-width: 768px) and (display-mode: standalone) {
  #app-shell { position: relative; }
  #app-shell::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--safe-top);
    z-index: 100;
    pointer-events: none;
    -webkit-backdrop-filter: blur(12px) saturate(150%);
    backdrop-filter: blur(12px) saturate(150%);
    background: color-mix(in srgb, var(--bg) 72%, transparent);
  }
  [data-theme="dark"] #app-shell::before {
    background: color-mix(in srgb, var(--bg) 80%, transparent);
  }
}

@media (max-width: 480px) {
  .stats-strip .stat-card { min-width: 100px; padding: 10px 12px; }
  .stats-strip .stat-card-icon { width: 28px; height: 28px; font-size: .85rem; }
  .stats-strip .stat-card-value { font-size: .95rem; }
  .login-screen { padding-left: 16px; padding-right: 16px; }
  .login-card { padding: 24px 16px; border-radius: var(--radius-lg); max-width: none; }
  .main-content { padding: 12px; }
  .topbar { padding-top: max(10px, var(--safe-top)); padding-bottom: 0; padding-left: max(16px, calc(10px + var(--safe-left))); padding-right: max(16px, calc(10px + var(--safe-right))); }
  .menu-btn { display: flex; min-width: 44px; min-height: 44px; }
  .tb-title { font-size: 1rem; }
  .tb-right .notif-btn { width: 40px; height: 40px; font-size: 1.15rem; }
  .sidebar .nav-link { font-size: .95rem; padding: 13px 16px; }
  .sidebar .nav-link i { font-size: 1.05rem; }
  .pg-title { font-size: 1.3rem; }
  .patient-header h2 { font-size: 1.1rem; }
  .quick-action-card { flex: 0 0 auto; min-width: 100px; }
  .quick-actions-row { overflow-x: auto; flex-wrap: nowrap; }
}

/* ─── Print ───────────────────────────────────────────────────── */
@media print {
  .sidebar, .topbar, .sb-overlay, .chat-compose, .wa-compose, .modal-overlay, #toast,
  .btn, .list-toolbar, .tab-bar, .patient-actions, .bottom-nav, .mobile-fab { display: none !important; }
  .main-wrap { margin-left: 0; padding-top: 0; }
  .main-content { margin-top: 0; padding: 0; max-width: none; }
  .card { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
}
