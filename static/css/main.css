/* ═══════════════════════════════════════════════════════════════
   NeuroRehab CareTrack — Main Stylesheet
   Fixed topbar + scrollable inner frame · Sidebar header = topbar height
   Navy sidebar · Teal primary · Clean cards · Responsive
   ═══════════════════════════════════════════════════════════════ */

/* ─── CSS Variables ───────────────────────────────────────────── */
:root {
  --sidebar-w: 250px;
  --topbar-h: 72px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --navy: #1e2a3b;
  --navy-light: #263549;
  --primary: #0d9488;
  --primary-hover: #0b7e73;
  --primary-bg: #ecfdf5;
  --accent: #ef4444;
  --accent-bg: #fef2f2;
  --amber: #d97706;
  --amber-bg: #fffbeb;
  --green: #16a34a;
  --green-bg: #f0fdf4;
  --grey: #6b7280;
  --grey-bg: #f3f4f6;
  --bg: #f0f9f9;
  --bg-subtle: #e8f4f3;
  --card: #ffffff;
  --text: #1e293b;
  --text-2: #475569;
  --text-3: #94a3b8;
  --border: #e2e8f0;
  --shadow: 0 1px 3px rgba(0,0,0,.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,.1);
  --card-accent-border: rgba(13,148,136,.25);
  --radius: 10px;
  --radius-sm: 6px;
  --font: 'Inter', system-ui, -apple-system, sans-serif;
  --transition: .2s ease;
}

/* ─── Dark theme ────────────────────────────────────────────────── */
[data-theme="dark"] {
  --navy: #1a2332;
  --navy-light: #243447;
  --primary: #14b8a6;
  --primary-hover: #2dd4bf;
  --primary-bg: #0d3d38;
  --accent: #f87171;
  --accent-bg: #4a1c1c;
  --amber: #f59e0b;
  --amber-bg: #422006;
  --green: #22c55e;
  --green-bg: #14532d;
  --grey: #94a3b8;
  --grey-bg: #2a3546;
  --bg: #151c26;
  --bg-subtle: #1a2332;
  --card: #1e2a3a;
  --text: #e2e8f0;
  --text-2: #b8c5d6;
  --text-3: #7c8fa5;
  --border: #2d3a4d;
  --shadow: 0 2px 8px rgba(0,0,0,.4);
  --shadow-md: 0 4px 16px rgba(0,0,0,.5);
  --card-accent-border: rgba(20,184,166,.35);
}
[data-theme="dark"] .fi:focus,
[data-theme="dark"] .fg textarea:focus,
[data-theme="dark"] .search-box input:focus { background: #151c26; }
[data-theme="dark"] .login-header h1 { color: #e2e8f0; }
[data-theme="dark"] .login-icon { background: rgba(255,255,255,.95); }
[data-theme="dark"] .sidebar { background: #1a2332; }
[data-theme="dark"] .sb-brand { border-bottom-color: rgba(255,255,255,.1); }
[data-theme="dark"] .sb-foot { border-top-color: rgba(255,255,255,.1); }
[data-theme="dark"] .nav-link.active { background: rgba(20,184,166,.25); color: #2dd4bf; }
[data-theme="dark"] .logout-btn:hover { background: rgba(248,113,113,.2); color: #fca5a5; }
[data-theme="dark"] .fi,
[data-theme="dark"] .fg textarea,
[data-theme="dark"] .fg select,
[data-theme="dark"] .search-box input,
[data-theme="dark"] .filter-select,
[data-theme="dark"] .add-inp,
[data-theme="dark"] .li-txt,
[data-theme="dark"] .adl-select,
[data-theme="dark"] .rating-btn,
[data-theme="dark"] .chat-compose input,
[data-theme="dark"] .urgent-toggle { background: #1e2a3a; border-color: #2d3a4d; color: #e2e8f0; }
[data-theme="dark"] .btn-ghost:hover { background: #2a3546; }
[data-theme="dark"] .btn-outline { border-color: #3d4f66; color: #b8c5d6; }
[data-theme="dark"] .btn-outline:hover { border-color: #14b8a6; color: #2dd4bf; background: rgba(20,184,166,.2); }
[data-theme="dark"] #toast { background: #1e2a3a; border: 1px solid #2d3a4d; }
[data-theme="dark"] .pwa-install-banner { background: #1e2a3a; border-color: #2d3a4d; }
[data-theme="dark"] .modal-card { background: #1e2a3a; border-color: #2d3a4d; }
[data-theme="dark"] .modal-body { color: #b8c5d6; }
[data-theme="dark"] .login-card { background: #1e2a3a; }
[data-theme="dark"] .stat-value,
[data-theme="dark"] .card-hd { color: #e2e8f0; }
[data-theme="dark"] tr:hover td { background: #243447; }
[data-theme="dark"] .channel-item.active { background: rgba(20,184,166,.25); color: #2dd4bf; }
[data-theme="dark"] .msg-bubble.theirs { background: #2a3546; color: #e2e8f0; }
[data-theme="dark"] .msg-bubble.mine { background: #0d9488; color: #fff; }
[data-theme="dark"] .msg-bubble.urgent { background: #4a1c1c; color: #fecaca; }
[data-theme="dark"] .msg-bubble.mine.urgent { background: #b91c1c; border-color: #991b1b; color: #fff; }

/* ─── Reset ───────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html {
  font-size: 15px; -webkit-text-size-adjust: 100%;
  overflow-x: clip; max-width: 100vw; width: 100%;
  touch-action: manipulation; /* reduce double-tap zoom */
}
body {
  font-family: var(--font); color: var(--text); background: var(--bg); line-height: 1.55;
  overflow-x: clip; max-width: 100vw; width: 100%;
  position: relative;
  transition: background-color .25s ease, color .2s ease;
}
body.modal-open { overflow: hidden; }
a { color: var(--primary); text-decoration: none; }
button { cursor: pointer; font-family: inherit; }
input, select, textarea { font-family: inherit; font-size: .93rem; }
img { max-width: 100%; }
:focus-visible { outline: 2px solid var(--primary); outline-offset: 2px; }
.hidden { display: none !important; }

/* Hide scrollbars site-wide (content still scrollable) */
* { scrollbar-width: none; -ms-overflow-style: none; }
*::-webkit-scrollbar { display: none; }

/* ─── Loading screen (until auth resolved) ─────────────────────── */
.loading-screen {
  position: fixed; inset: 0; z-index: 9998;
  background: linear-gradient(135deg, var(--navy) 0%, #1a3a4a 50%, var(--primary) 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px;
  color: #fff;
}
.loading-screen.hidden { display: none !important; }
.loading-spinner {
  width: 48px; height: 48px; border: 4px solid rgba(255,255,255,.3);
  border-top-color: #fff; border-radius: 50%; animation: spin .8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-screen p { font-size: 1rem; font-weight: 500; }

/* ─── Login Screen ────────────────────────────────────────────── */
.login-screen {
  min-height: 100vh; display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, var(--navy) 0%, #1a3a4a 50%, var(--primary) 100%);
  padding: 20px;
}
.login-card {
  background: var(--card); border-radius: 16px; padding: 40px 36px;
  width: 100%; max-width: 400px; box-shadow: 0 20px 60px rgba(0,0,0,.3);
}
.login-header { text-align: center; margin-bottom: 28px; }
.login-icon {
  width: 64px; height: 64px; border-radius: 16px;
  background: #fff;
  display: inline-flex; align-items: center; justify-content: center;
  margin-bottom: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,.08);
}
.login-icon img { width: 100%; height: 100%; object-fit: contain; }
.login-header h1 { font-size: 1.4rem; font-weight: 700; color: var(--navy); }
.login-header p { color: var(--text-3); font-size: .88rem; margin-top: 4px; }
.fg { margin-bottom: 16px; }
.fg label { display: block; font-size: .82rem; font-weight: 600; color: var(--text-2); margin-bottom: 5px; }
.fi {
  width: 100%; padding: 10px 12px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .93rem; transition: border var(--transition);
  background: var(--bg);
}
.fi:focus { border-color: var(--primary); outline: none; background: #fff; }
.error-msg { color: var(--accent); font-size: .82rem; margin-bottom: 10px; }
.login-hint { text-align: center; color: var(--text-3); font-size: .78rem; margin-top: 14px; }

/* ─── Buttons ─────────────────────────────────────────────────── */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 6px;
  padding: 9px 18px; border: none; border-radius: var(--radius-sm);
  font-size: .88rem; font-weight: 600; transition: all var(--transition);
  background: var(--primary); color: #fff;
}
.btn:hover { background: var(--primary-hover); transform: translateY(-1px); }
.btn:active { transform: translateY(0); }
.btn:disabled { opacity: .5; pointer-events: none; }
.btn-block { width: 100%; padding: 12px; font-size: .95rem; }
.btn-sm { padding: 6px 12px; font-size: .8rem; }
.btn-ghost { background: transparent; color: var(--text-2); }
.btn-ghost:hover { background: var(--grey-bg); }
.btn-danger { background: var(--accent); }
.btn-danger:hover { background: #dc2626; }
.btn-outline {
  background: transparent; border: 1.5px solid var(--border); color: var(--text-2);
}
.btn-outline:hover { border-color: var(--primary); color: var(--primary); background: var(--primary-bg); }
.btn-icon {
  width: 36px; height: 36px; padding: 0; border-radius: 8px;
  background: transparent; color: var(--text-2); border: none; font-size: 1rem;
}
.btn-icon:hover { background: var(--grey-bg); }

/* ─── App Shell Layout ────────────────────────────────────────── */
.app { display: flex; min-height: 100vh; min-width: 0; max-width: 100%; overflow-x: clip; }
#app-shell[hidden] { display: none !important; }

/* Sidebar — brand row matches topbar height for visual alignment */
.sidebar {
  width: var(--sidebar-w); background: var(--navy); color: #cbd5e1;
  display: flex; flex-direction: column; position: fixed; top: 0; bottom: 0; left: 0;
  z-index: 100; transition: transform .25s ease;
  padding-top: var(--safe-top);
  padding-left: max(12px, env(safe-area-inset-left, 0px));
  padding-right: max(12px, env(safe-area-inset-right, 0px));
  box-sizing: border-box;
}
.sb-brand {
  display: flex; align-items: center; gap: 10px;
  height: var(--topbar-h); min-height: var(--topbar-h); padding: 12px 16px 14px 0; box-sizing: border-box;
  font-size: 1rem; font-weight: 700; color: #fff;
  border-bottom: 1px solid rgba(255,255,255,.08);
  flex-shrink: 0; overflow: hidden;
}
.sb-brand-logo { height: 28px; width: auto; max-width: 32px; object-fit: contain; flex-shrink: 0; }
.sb-brand-inner { display: flex; flex-direction: column; gap: 2px; min-width: 0; overflow: hidden; }
.sb-brand-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3; font-size: 1rem; font-weight: 700; }
.sb-brand .sb-name { font-size: .8rem; font-weight: 500; color: #94a3b8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sb-brand i { color: var(--primary); font-size: 1.2rem; }
.sb-nav { flex: 1; padding: 12px 0 12px 0; overflow-y: auto; }
.nav-link {
  display: flex; align-items: center; gap: 10px; padding: 10px 14px;
  border-radius: 8px; color: #94a3b8; font-size: .88rem; font-weight: 500;
  transition: all var(--transition); position: relative;
}
.nav-link:hover { background: var(--navy-light); color: #e2e8f0; }
.nav-link.active { background: rgba(13,148,136,.15); color: var(--primary); font-weight: 600; }
.nav-link i { width: 20px; text-align: center; font-size: .92rem; }
.nav-badge {
  position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
  background: var(--accent); color: #fff; font-size: .68rem; font-weight: 700;
  padding: 2px 6px; border-radius: 10px; display: none;
}
.nav-badge.visible { display: block; }
.sb-foot { padding: 12px 0; border-top: 1px solid rgba(255,255,255,.08); display: flex; flex-direction: column; gap: 4px; }
.sb-foot .nav-link { width: 100%; text-decoration: none; }
.logout-btn {
  width: 100%; text-align: left; text-decoration: none;
  background: none; border: none; cursor: pointer; font-family: inherit;
}
.logout-btn:hover { background: rgba(239,68,68,.12); color: var(--accent); }

/* Mobile sidebar overlay */
.sb-overlay {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,.4);
  z-index: 99; opacity: 0; transition: opacity .25s;
}
.sb-overlay.visible { display: block; opacity: 1; }

/* Main area: fixed topbar + scrollable inner frame only */
.main-wrap {
  flex: 1; margin-left: var(--sidebar-w); display: flex; flex-direction: column;
  min-height: 100vh; min-width: 0; overflow-x: clip;
}

/* Topbar — fixed at top of main area; extends into safe area so content doesn't show under transparent status bar */
.topbar {
  position: fixed; top: 0; left: var(--sidebar-w); right: 0;
  min-height: calc(var(--topbar-h) + var(--safe-top)); padding-top: var(--safe-top); box-sizing: border-box;
  z-index: 50;
  background: var(--card); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: flex-start;
  padding-left: max(24px, calc(16px + var(--safe-left))); padding-right: max(24px, calc(16px + var(--safe-right))); padding-bottom: 0; gap: 12px;
  box-shadow: var(--shadow);
}
.topbar::before { content: ''; position: absolute; inset: 0; background: var(--card); z-index: -1; pointer-events: none; }
.menu-btn { display: none; background: none; border: none; font-size: 1.2rem; color: var(--text-2); padding: 8px; }
.tb-title { font-size: 1.05rem; font-weight: 700; letter-spacing: -0.02em; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text); }
.tb-right { display: flex; align-items: center; gap: 8px; }
.notif-btn {
  position: relative; width: 36px; height: 36px; border-radius: 8px;
  background: none; border: none; color: var(--text-2); font-size: 1.05rem;
  display: flex; align-items: center; justify-content: center;
  transition: background var(--transition);
}
.notif-btn:hover { background: var(--grey-bg); }
#notif-badge {
  position: absolute; top: 4px; right: 4px;
  background: var(--accent); color: #fff; font-size: .6rem; font-weight: 700;
  min-width: 16px; height: 16px; border-radius: 8px;
  display: none; align-items: center; justify-content: center; padding: 0 4px;
}
#notif-badge.visible { display: flex; }
.shift-badge {
  padding: 4px 12px; border-radius: 20px; font-size: .78rem; font-weight: 600;
  background: var(--primary-bg); color: var(--primary);
}

/* Notification panel — below fixed topbar */
.notif-panel {
  position: absolute; top: 100%; right: 16px; margin-top: 4px;
  width: 320px; max-width: calc(100vw - 32px); max-height: 400px; overflow-y: auto;
  background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow-md);
  border: 1px solid var(--border); display: none; z-index: 60;
}
.notif-panel.visible { display: block; }
.notif-item {
  display: flex; align-items: flex-start; gap: 10px; padding: 12px 16px;
  border-bottom: 1px solid var(--border); cursor: pointer; transition: background var(--transition);
}
.notif-item:hover { background: var(--grey-bg); }
.notif-item:last-child { border-bottom: none; }
.notif-item i { margin-top: 2px; font-size: .9rem; }
.notif-risk i { color: var(--accent); }
.notif-urgent i { color: var(--amber); }
.notif-title { font-size: .85rem; font-weight: 600; }
.notif-sub { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.notif-empty { padding: 24px; text-align: center; color: var(--text-3); font-size: .85rem; }

/* ─── Main content (scrollable inner frame only) ────────────────── */
.main-content {
  margin-top: calc(var(--safe-top) + var(--topbar-h));
  flex: 1; min-height: 0; overflow-y: auto; overflow-x: clip;
  padding: 24px; width: 100%; min-width: 0;
  background: linear-gradient(180deg, var(--bg) 0%, var(--bg-subtle) 100%);
}
.main-content::before { display: none; }
.main-content { word-break: normal; overflow-wrap: break-word; }

/* Pages */
.page { display: none; width: 100%; max-width: 100%; overflow-x: clip; min-width: 0; box-sizing: border-box; }
.page.active { display: block; animation: fadeUp .25s ease; }
/* Dashboard: constrain width so cards don't stretch on wide screens */
#page-dashboard { max-width: 1200px; margin-left: auto; margin-right: auto; }
@keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* Page title */
.pg-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 4px; color: var(--text); }
.pg-sub { color: var(--text-3); font-size: .88rem; margin-bottom: 20px; }

/* ─── Cards ───────────────────────────────────────────────────── */
.card {
  background: var(--card); border-radius: var(--radius); padding: 20px;
  box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 16px;
  transition: background-color .2s ease, border-color .2s ease, box-shadow .2s ease;
}
.card.card-accent { border-left: 4px solid var(--primary); }
.card.card-accent-warn { border-left: 4px solid var(--amber); }
.card.card-accent-danger { border-left: 4px solid var(--accent); }
.card-hd {
  font-size: .95rem; font-weight: 700; margin-bottom: 14px;
  display: flex; align-items: center; gap: 8px;
  color: var(--text);
}
.card-hd i { font-size: .9rem; }
.card-hd.card-hd-primary { color: var(--primary); }
.card-hd.card-hd-accent { color: var(--accent); }

/* Collapsible sections (patient detail, etc.) */
.collapsible-section { border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 12px; overflow: hidden; }
.collapsible-head {
  width: 100%; display: flex; align-items: center; gap: 8px; padding: 12px 14px;
  background: var(--grey-bg); border: none; font-size: .9rem; font-weight: 600; text-align: left; cursor: pointer;
  transition: background var(--transition);
}
.collapsible-head:hover { background: var(--border); }
.collapsible-head i.fa-chevron-down { transition: transform .2s ease; }
.collapsible-section.collapsed .collapsible-head i.fa-chevron-down { transform: rotate(-90deg); }
.collapsible-body { padding: 14px; }
.collapsible-section.collapsed .collapsible-body { display: none; }

/* Multi-select dropdown */
.multiselect-wrap { position: relative; }
.multiselect-trigger {
  position: relative;
  width: 100%; min-height: 38px; padding: 8px 12px; padding-right: 32px;
  background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .93rem; text-align: left; cursor: pointer; display: flex; align-items: center; flex-wrap: wrap; gap: 6px;
  transition: border var(--transition);
}
.multiselect-trigger:hover { border-color: var(--text-3); }
.multiselect-trigger:focus { border-color: var(--primary); outline: none; }
.multiselect-trigger::after {
  content: ''; position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
  border: 5px solid transparent; border-top-color: var(--text-3);
}
.multiselect-wrap.open .multiselect-trigger::after { transform: translateY(-50%) rotate(180deg); }
.multiselect-chip {
  display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px;
  background: var(--primary-bg); color: var(--primary); border-radius: 999px;
  font-size: .8rem; font-weight: 500;
}
.multiselect-placeholder { color: var(--text-3); }
.multiselect-panel {
  position: absolute; left: 0; right: 0; top: 100%; margin-top: 4px; max-height: 220px; overflow-y: auto;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm);
  box-shadow: var(--shadow-md); z-index: 100; display: none; padding: 8px;
}
.multiselect-wrap.open .multiselect-panel { display: flex; flex-direction: column; }
.multiselect-search {
  flex-shrink: 0; margin-bottom: 8px; border-radius: var(--radius-sm);
}
.multiselect-options {
  flex: 1; min-height: 0; overflow-y: auto; max-height: 180px;
}
.multiselect-panel label {
  display: flex; align-items: center; gap: 8px; padding: 8px 10px; cursor: pointer;
  font-size: .88rem; border-radius: var(--radius-sm); transition: background var(--transition);
}
.multiselect-panel label:hover { background: var(--grey-bg); }
.multiselect-panel input[type="checkbox"] { width: 16px; height: 16px; flex-shrink: 0; }

/* Dashboard — Risk Alerts & Recent Reports */
.risk-alert-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); flex-wrap: wrap;
}
.risk-alert-row:last-child { border-bottom: none; }
.risk-alert-row:hover { background: var(--grey-bg); }
.risk-alert-badges { display: flex; flex-direction: column; align-items: flex-start; gap: 4px; flex-shrink: 0; }
.risk-alert-info { flex: 1; min-width: 0; }
.risk-alert-meta { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.badge-your-patient,
.badge-my-patient {
  font-size: .7rem; font-weight: 600; padding: 2px 8px; border-radius: 10px;
  background: var(--primary-bg); color: var(--primary); white-space: nowrap;
}
.required-asterisk { color: var(--accent); }
.text-muted { color: var(--text-3); font-size: .85em; }

/* Multi-step wizard (e.g. Add Patient) */
.modal-card-wizard .wizard-steps {
  display: flex; align-items: center; justify-content: center; gap: 0;
  margin-bottom: 20px; padding: 0 8px;
}
.wizard-dot {
  width: 28px; height: 28px; border-radius: 50%;
  background: var(--grey-bg); color: var(--text-3); font-size: .8rem; font-weight: 700;
  display: inline-flex; align-items: center; justify-content: center;
  transition: background var(--transition), color var(--transition);
}
.wizard-dot.active { background: var(--primary); color: #fff; }
.wizard-line {
  width: 40px; height: 2px; background: var(--border); flex-shrink: 0;
}
.wizard-pane { min-height: 120px; }
.wizard-actions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-end; align-items: center; }
.recent-rpt-row {
  display: flex; align-items: center; gap: 10px; padding: 10px 0;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition); flex-wrap: wrap;
}
.recent-rpt-row:last-child { border-bottom: none; }
.recent-rpt-row:hover { background: var(--grey-bg); }
.recent-rpt-main { flex: 1; min-width: 0; }
.recent-rpt-name { font-size: .88rem; }
.recent-rpt-meta { font-size: .78rem; color: var(--text-3); margin-top: 2px; }
.recent-rpt-badge { flex-shrink: 0; }
.recent-rpt-ts { font-size: .75rem; color: var(--text-3); white-space: nowrap; }

/* ─── Stat Cards ──────────────────────────────────────────────── */
.stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
.stat-card {
  background: var(--card); border-radius: var(--radius); padding: 12px 16px;
  box-shadow: var(--shadow); border: 1px solid var(--border);
  display: flex; align-items: center; gap: 12px;
  transition: background-color .2s ease, border-color .2s ease;
}
.stat-card.clickable { cursor: pointer; }
.stat-card.clickable:hover { background: var(--grey-bg); }
.stat-card.stat-card-teal { border-top: 3px solid var(--primary); }
.stat-card.stat-card-red { border-top: 3px solid var(--accent); }
.stat-card.stat-card-amber { border-top: 3px solid var(--amber); }
.stat-card.stat-card-green { border-top: 3px solid var(--green); }
.stat-icon {
  width: 36px; height: 36px; border-radius: 10px;
  display: flex; align-items: center; justify-content: center; font-size: 1rem; flex-shrink: 0;
}
.stat-icon.teal { background: var(--primary-bg); color: var(--primary); }
.stat-icon.red { background: var(--accent-bg); color: var(--accent); }
.stat-icon.amber { background: var(--amber-bg); color: var(--amber); }
.stat-icon.green { background: var(--green-bg); color: var(--green); }
.stat-label { font-size: .78rem; color: var(--text-3); font-weight: 500; }
.stat-value { font-size: 1.15rem; font-weight: 700; line-height: 1.3; color: var(--text); }

/* Dashboard — My Active Patients */
.my-pt-row {
  display: flex; align-items: flex-start; gap: 12px; padding: 12px 4px;
  border-bottom: 1px solid var(--border); cursor: pointer;
  transition: background var(--transition);
}
.my-pt-row:last-child { border-bottom: none; }
.my-pt-row:hover { background: var(--grey-bg); border-radius: var(--radius-sm); }
.my-pt-info { flex: 1; min-width: 0; }
.my-pt-name {
  font-size: 1.05rem; font-weight: 700; color: var(--text);
  display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
}
.my-pt-diagnosis { font-size: .82rem; color: var(--text-3); margin-top: 2px; }
.my-pt-diagnosis-line { margin-top: 2px; }
.my-pt-diagnosis-line:first-child { margin-top: 0; }
.my-pt-report {
  font-size: .82rem; color: var(--text-2); margin-top: 4px;
  display: flex; align-items: center; gap: 6px;
}
.my-pt-report i { font-size: .75rem; color: var(--primary); }

/* ─── Two-column layout ──────────────────────────────────────── */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

/* ─── Risk badges ─────────────────────────────────────────────── */
.risk-badge {
  display: inline-block; padding: 2px 10px; border-radius: 12px;
  font-size: .75rem; font-weight: 600; text-transform: uppercase; letter-spacing: .03em;
}
.risk-none { background: var(--grey-bg); color: var(--grey); }
.risk-low { background: var(--green-bg); color: var(--green); }
.risk-medium { background: var(--amber-bg); color: var(--amber); }
.risk-high { background: var(--accent-bg); color: var(--accent); }

/* ─── Patients card grid ─────────────────────────────────────── */
.patients-card-grid {
  display: grid;
  width: 100%;
  gap: 16px;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}
.patients-card-grid > .empty-state { grid-column: 1 / -1; }
.patient-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px 16px;
  min-width: 0;
  transition: border-color var(--transition), box-shadow var(--transition);
}
.patient-card:hover { border-color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,.08); }
.patient-card.clickable { cursor: pointer; }

.patient-card-discharged {
  background: var(--grey-bg);
  border: 1px dashed var(--border);
  border-left: 3px solid var(--text-3);
  opacity: 0.95;
  box-shadow: none;
}
.patient-card-discharged:hover {
  border-color: var(--text-3);
  box-shadow: none;
  background: var(--grey-bg);
}
.patient-card-discharged .patient-card-name,
.patient-card-discharged .patient-card-diagnosis,
.patient-card-discharged .patient-card-label { color: var(--text-2); }
.patient-card-discharged .patient-card-name { font-weight: 500; }
.patient-card-discharged .patient-card-discharge-date { color: var(--text-3); }
.patient-card-discharged .discharge-days { opacity: 0.95; }
.patient-card-discharge-date .patient-card-discharged-badge {
  font-size: .65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .05em;
  color: var(--text-3);
  background: rgba(0,0,0,.06);
  padding: 3px 8px;
  border-radius: 4px;
  margin-right: 6px;
}
.patient-card-name-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
  margin-bottom: 10px;
  min-width: 0;
}
.patient-card-name-row .patient-card-name { margin-bottom: 0; flex: 1; min-width: 0; }
.patient-card-discharge-date {
  flex-shrink: 0;
  font-size: .8rem;
  color: var(--text-3);
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.patient-card-discharge-date i { font-size: .75rem; opacity: .9; }

.patient-card-name {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 10px;
  word-break: break-word;
  line-height: 1.3;
}
.patient-card-name .badge-my-patient { margin-left: 6px; }
.patient-card-row {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 8px;
  font-size: .85rem;
}
.patient-card-row:last-child { margin-bottom: 0; }
.patient-card-label {
  color: var(--text-3);
  flex: 0 0 80px;
  min-width: 0;
}
.patient-card-diagnosis {
  color: var(--text);
  word-break: break-word;
  flex: 1;
  min-width: 0;
}
.discharge-days {
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 6px;
  font-size: .8rem;
}
.discharge-days-overdue { background: var(--accent-bg); color: var(--accent); }
.discharge-days-urgent { background: var(--accent-bg); color: var(--accent); }
.discharge-days-warning { background: var(--amber-bg); color: var(--amber); }
.discharge-days-ok { background: var(--green-bg); color: var(--green); }
.discharge-days-none { color: var(--text-3); background: transparent; }
.discharge-status-delayed { background: var(--amber-bg); color: var(--amber); }
.discharge-status-early { background: var(--green-bg); color: var(--green); }
.discharge-status-done { color: var(--text-2); background: var(--grey-bg); }
.patient-card-row .discharge-sub { font-size: .8rem; color: var(--text-3); font-weight: 400; margin-left: 4px; }

/* Status badges */
.status-badge { display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: .75rem; font-weight: 600; }
.status-active { background: var(--green-bg); color: var(--green); }
.status-discharged { background: var(--grey-bg); color: var(--grey); }
.task-status-todo { background: var(--grey-bg); color: var(--grey); }
.task-status-in_progress { background: var(--amber-bg); color: var(--amber); }
.task-status-done { background: var(--green-bg); color: var(--green); }

/* ─── Table ───────────────────────────────────────────────────── */
.table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; max-width: 100%; contain: layout; }
table { width: 100%; border-collapse: collapse; font-size: .88rem; }
th { text-align: left; padding: 10px 12px; font-weight: 600; color: var(--text-2); border-bottom: 2px solid var(--border); font-size: .8rem; text-transform: uppercase; letter-spacing: .04em; word-break: normal; overflow-wrap: break-word; min-width: 3.5em; }
td { padding: 10px 12px; border-bottom: 1px solid var(--border); vertical-align: middle; word-break: normal; overflow-wrap: break-word; min-width: 3.5em; }
tr:hover td { background: var(--grey-bg); }
tr.clickable { cursor: pointer; }

/* ─── Patient List ────────────────────────────────────────────── */
.patients-toolbar {
  display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;
}
.patients-toolbar .search-box { flex: 1; min-width: 0; max-width: 400px; }
.patients-toolbar .btn { flex-shrink: 0; }

.list-toolbar {
  display: flex; align-items: center; gap: 10px; margin-bottom: 16px; flex-wrap: wrap;
}
.search-box {
  flex: 1; min-width: 0; position: relative; max-width: 100%;
}
.search-box input {
  width: 100%; padding: 9px 12px 9px 36px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .88rem; background: var(--card);
  transition: border var(--transition);
}
.search-box input:focus { border-color: var(--primary); outline: none; }
.search-box i {
  position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
  color: var(--text-3); font-size: .85rem;
}
.filter-select {
  padding: 9px 12px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .85rem; background: var(--card); color: var(--text);
}

/* ─── Patient Detail ──────────────────────────────────────────── */
#page-patient-detail > #pd-header { width: 100%; max-width: 100%; box-sizing: border-box; }
.patient-header {
  display: flex; flex-direction: column; gap: 14px; margin-bottom: 20px; width: 100%; max-width: 100%; box-sizing: border-box;
}
.patient-header-top {
  display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; width: 100%; max-width: 100%; box-sizing: border-box;
}
.patient-header-top .risk-badge { flex-shrink: 0; }
.patient-header-top .patient-actions { flex-shrink: 0; display: flex; gap: 8px; align-items: center; }
.patient-details-vertical {
  display: flex; flex-direction: column; gap: 6px;
}
.patient-detail-row { font-size: .9rem; display: flex; align-items: baseline; gap: 10px; flex-wrap: wrap; }
.patient-detail-label { color: var(--text-3); font-size: .85rem; flex: 0 0 180px; min-width: 0; white-space: nowrap; }
.patient-detail-value { color: var(--text); word-break: break-word; min-width: 0; }
.patient-header h2 { font-size: 1.3rem; font-weight: 700; word-break: normal; overflow-wrap: break-word; min-width: 0; }
.patient-meta { display: flex; gap: 16px; flex-wrap: wrap; color: var(--text-2); font-size: .85rem; }
.patient-meta span { display: flex; align-items: center; gap: 4px; word-break: normal; overflow-wrap: break-word; white-space: normal; }
.patient-actions { flex-shrink: 0; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

.patient-detail-bottom { margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border); }
.patient-detail-bottom-actions { display: flex; align-items: center; justify-content: center; gap: 8px; }

.tab-bar {
  display: flex; gap: 2px; border-bottom: 2px solid var(--border); margin-bottom: 20px;
  overflow-x: auto; overflow-y: hidden; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; max-width: 100%;
  align-items: stretch; min-height: 42px;
}
.tab-bar::-webkit-scrollbar { height: 4px; }
.tab-btn {
  flex: 0 0 auto; padding: 10px 16px; border: none; background: none; font-size: .85rem;
  font-weight: 500; color: var(--text-3); white-space: nowrap; cursor: pointer;
  border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all var(--transition);
}
.tab-btn:hover { color: var(--text); }
.tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeUp .2s ease; }

/* Trend chart (overview – reports by week) */
.trend-chart {
  display: flex; flex-direction: column; gap: 10px;
  padding: 12px 0; border-left: 3px solid var(--primary); padding-left: 14px; margin-left: 2px;
}
.trend-scale {
  display: flex; justify-content: space-between; align-items: center;
  font-size: .7rem; color: var(--text-3); margin-bottom: 4px; padding-right: 2.5em;
}
.trend-scale-max { font-variant-numeric: tabular-nums; }
.trend-row {
  display: flex; align-items: center; gap: 10px;
  min-height: 32px;
}
.trend-label {
  flex: 0 0 110px; font-size: .8rem; color: var(--text-2);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.trend-bar-wrap {
  flex: 1; min-width: 0; height: 22px; background: var(--border); border-radius: 6px; overflow: hidden;
  display: block;
}
.trend-bar {
  display: block; height: 22px; min-height: 22px; min-width: 6px;
  background: var(--primary); border-radius: 6px;
  transition: width .3s ease;
}
.trend-value {
  flex: 0 0 2.2em; font-size: .9rem; font-weight: 700; color: var(--primary);
  text-align: right;
}
.trend-empty { margin: 0; color: var(--text-3); font-size: .9rem; }

/* ─── Forms ───────────────────────────────────────────────────── */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.form-grid .fg-full { grid-column: 1 / -1; }
.fg textarea {
  width: 100%; padding: 10px 12px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .88rem; resize: vertical; min-height: 80px;
  background: var(--bg); transition: border var(--transition);
}
.fg textarea:focus { border-color: var(--primary); outline: none; background: #fff; }
.fg select {
  width: 100%; padding: 10px 12px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .88rem; background: var(--bg);
}

/* Rating rows (psychiatric/behavioral) */
.rating-row {
  display: flex; align-items: center; gap: 10px; padding: 8px 0;
  border-bottom: 1px solid var(--border);
}
.rating-row:last-child { border-bottom: none; }
.rating-label { flex: 1; font-size: .88rem; font-weight: 500; }
.rating-btns { display: flex; gap: 4px; }
.rating-btn {
  width: 32px; height: 32px; border-radius: 6px; border: 1.5px solid var(--border);
  background: var(--card); font-size: .82rem; font-weight: 600; cursor: pointer;
  transition: all var(--transition); color: var(--text-2);
}
.rating-btn:hover { border-color: var(--primary); }
.rating-btn.selected { background: var(--primary); color: #fff; border-color: var(--primary); }

/* ADL level select */
.adl-row {
  display: flex; align-items: center; justify-content: space-between; gap: 10px;
  padding: 8px 0; border-bottom: 1px solid var(--border);
}
.adl-row:last-child { border-bottom: none; }
.adl-label { font-size: .88rem; font-weight: 500; }
.adl-select {
  padding: 6px 10px; border: 1.5px solid var(--border); border-radius: var(--radius-sm);
  font-size: .82rem; background: var(--card);
}

/* ─── Chat (WhatsApp-style: channels pinned top, input fixed bottom) ── */
.chat-layout { display: flex; gap: 16px; height: calc(100vh - var(--safe-top) - var(--topbar-h) - 120px); min-height: 400px; }
.chat-layout-wa { display: block; height: calc(100vh - var(--safe-top) - var(--topbar-h) - 100px); min-height: 360px; }
.chat-layout-wa .chat-main {
  display: flex; flex-direction: column; height: 100%;
  background: var(--card); border-radius: var(--radius); border: 1px solid var(--border);
  overflow: hidden;
}
.channel-list {
  width: 200px; flex-shrink: 0; background: var(--card); border-radius: var(--radius);
  border: 1px solid var(--border); overflow-y: auto;
}
.channel-list-pinned {
  width: 100%; flex-shrink: 0; flex-direction: row; flex-wrap: nowrap;
  overflow-x: auto; overflow-y: hidden; padding: 10px 12px; gap: 8px;
  border-bottom: 1px solid var(--border); background: var(--grey-bg);
  -webkit-overflow-scrolling: touch;
}
.channel-list-pinned .channel-item {
  flex: 0 0 auto; padding: 8px 14px; border-radius: 20px; border: 1px solid var(--border);
  border-bottom: none; white-space: nowrap;
}
.channel-list-pinned .channel-item.active { border-color: var(--primary); }
.channel-list-pinned .channel-unread { margin-left: 6px; }
.channel-item {
  padding: 10px 14px; cursor: pointer; font-size: .88rem; border-bottom: 1px solid var(--border);
  transition: background var(--transition); display: flex; align-items: center; gap: 8px;
}
.channel-item:hover { background: var(--grey-bg); }
.channel-item.active { background: var(--primary-bg); color: var(--primary); font-weight: 600; }
.channel-item:last-child { border-bottom: none; }
.channel-unread {
  margin-left: auto; background: var(--accent); color: #fff; font-size: .7rem; font-weight: 700;
  min-width: 18px; padding: 2px 6px; border-radius: 9px; text-align: center;
}
.chat-main { flex: 1; display: flex; flex-direction: column; background: var(--card); border-radius: var(--radius); border: 1px solid var(--border); }
.chat-header { padding: 12px 16px; border-bottom: 1px solid var(--border); font-weight: 700; font-size: .95rem; flex-shrink: 0; }
.msg-list { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; min-height: 0; }
.chat-compose-fixed { flex-shrink: 0; border-top: 1px solid var(--border); }
.msg-wrap { display: flex; }
.msg-wrap.mine { justify-content: flex-end; }
.msg-bubble {
  max-width: 70%; padding: 10px 14px; border-radius: 12px;
  font-size: .88rem; line-height: 1.45;
}
.msg-bubble.theirs { background: var(--grey-bg); border-bottom-left-radius: 4px; color: var(--text); }
.msg-bubble.mine { background: var(--primary); color: #fff; border-bottom-right-radius: 4px; }
.msg-bubble.urgent { background: var(--accent-bg); border: 1px solid var(--accent); color: var(--text); }
.msg-bubble.mine.urgent { background: #b91c1c; border-color: #991b1b; color: #fff; }
.msg-meta { font-size: .7rem; margin-top: 4px; opacity: .7; }
.chat-compose {
  display: flex; align-items: center; gap: 8px; padding: 12px 16px;
  border-top: 1px solid var(--border);
}
.chat-compose input {
  flex: 1; padding: 9px 12px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .88rem;
}
.chat-compose input:focus { border-color: var(--primary); outline: none; }
.urgent-toggle {
  display: flex; align-items: center; gap: 4px; padding: 6px 10px; border-radius: var(--radius-sm);
  border: 1.5px solid var(--border); background: var(--card); font-size: .78rem; cursor: pointer;
  color: var(--text-3); transition: all var(--transition);
}
.urgent-toggle.active { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ─── Family Report ───────────────────────────────────────────── */
.fr-controls { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
.fr-controls select, .fr-controls input { padding: 8px 12px; border: 1.5px solid var(--border); border-radius: var(--radius-sm); font-size: .85rem; }
.lbtn {
  padding: 6px 14px; border: 1.5px solid var(--border); border-radius: 20px;
  background: var(--card); font-size: .82rem; cursor: pointer; transition: all var(--transition);
}
.lbtn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
.fr-preview { margin-top: 16px; max-width: 100%; }
.fr-report-content { max-width: 100%; overflow-x: hidden; }
.rh { background: var(--primary); color: #fff; padding: 24px; border-radius: var(--radius) var(--radius) 0 0; text-align: center; overflow-wrap: break-word; }
.rh-c { font-size: .85rem; opacity: .85; margin-bottom: 4px; }
.rh-t { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; }
.rh-d, .rh-s { font-size: .82rem; opacity: .9; }
.frs { margin-bottom: 14px; }
.frs-t { font-weight: 600; margin-bottom: 4px; color: var(--primary); }
.frs-b { font-size: .88rem; color: var(--text-2); line-height: 1.5; }
.pbw { margin-bottom: 10px; }
.pbt { display: flex; justify-content: space-between; font-size: .82rem; margin-bottom: 4px; }
.pbtr { height: 8px; background: var(--grey-bg); border-radius: 4px; overflow: hidden; }
.pbf { height: 100%; background: var(--primary); border-radius: 4px; transition: width .5s ease; }
.wt { font-size: .82rem; }
.wt .chg { color: var(--green); font-weight: 600; }
.tipr { display: flex; gap: 10px; align-items: flex-start; margin-bottom: 10px; }
.tipn { width: 24px; height: 24px; border-radius: 50%; background: var(--primary); color: #fff; display: flex; align-items: center; justify-content: center; font-size: .72rem; font-weight: 700; flex-shrink: 0; }
.tipt { font-size: .85rem; color: var(--text-2); }
.fr-foot { text-align: center; font-size: .78rem; color: var(--text-3); padding: 16px 0; border-top: 1px solid var(--border); margin-top: 16px; }
.alert { padding: 12px 16px; border-radius: var(--radius-sm); font-size: .85rem; margin-bottom: 12px; }
.alert-warn { background: var(--amber-bg); color: var(--amber); }
.alert-info { background: var(--primary-bg); color: var(--primary); }
.alert-danger { background: var(--accent-bg); color: var(--accent); }

/* ─── Searchable dropdown ─────────────────────────────────────── */
.searchable-select { position: relative; }
.searchable-options {
  position: absolute; left: 0; right: 0; top: 100%; z-index: 100;
  max-height: 200px; overflow-y: auto; margin: 0; padding: 4px 0;
  list-style: none; background: var(--card); border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); box-shadow: var(--shadow-md); display: none;
}
.searchable-option {
  padding: 8px 12px; font-size: .88rem; cursor: pointer;
  transition: background var(--transition);
}
.searchable-option:hover { background: var(--primary-bg); color: var(--primary); }

/* ─── Admin Panel ─────────────────────────────────────────────── */
.staff-table td { vertical-align: middle; }
.role-badge {
  display: inline-block; padding: 2px 10px; border-radius: 12px;
  font-size: .75rem; font-weight: 600; text-transform: capitalize;
  background: var(--primary-bg); color: var(--primary);
}

/* ─── Settings ────────────────────────────────────────────────── */
.set-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.set-title { font-weight: 700; font-size: .95rem; }
.set-badge {
  background: var(--primary-bg); color: var(--primary); font-size: .75rem;
  font-weight: 700; padding: 2px 8px; border-radius: 10px;
}
.set-desc { font-size: .82rem; color: var(--text-3); margin-bottom: 12px; }
.role-check-group { display: flex; flex-wrap: wrap; gap: 10px 16px; }
.role-check { display: inline-flex; align-items: center; gap: 6px; font-size: .88rem; cursor: pointer; }
.role-check input { margin: 0; }
.diagnosis-history-list { list-style: none; padding: 0; margin: 0; }
.diagnosis-history-list li { padding: 8px 0; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; gap: 2px; }
.diagnosis-history-list li:last-child { border-bottom: none; }
.diagnosis-history-text { font-weight: 500; }
.diagnosis-history-meta { font-size: .8rem; color: var(--text-3); }

.diagnosis-consult-list { display: flex; flex-direction: column; gap: 14px; }
.diagnosis-consult-card {
  padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm);
  background: var(--card); display: flex; flex-direction: column; gap: 8px;
}
.diagnosis-consult-head {
  display: flex; flex-wrap: wrap; align-items: center; gap: 12px; font-size: .85rem; color: var(--text-2);
}
.diagnosis-consult-date { display: inline-flex; align-items: center; gap: 6px; }
.diagnosis-consult-by { color: var(--text-3); }
.diagnosis-consult-diagnosis { font-size: .9rem; }
.diagnosis-consult-notes {
  font-size: .88rem; color: var(--text-2); line-height: 1.5;
  padding: 10px 12px; background: var(--grey-bg); border-radius: var(--radius-sm); margin-top: 4px;
}

.status-consult-item { margin-bottom: 12px; }
.status-consult-item:last-child { margin-bottom: 0; }
.status-consult-note { font-size: .82rem; color: var(--text-2); margin: 6px 0 0 0; padding-left: 0; line-height: 1.45; }

/* Consultation notes — chat-like structure */
.consult-latest-diagnosis { font-size: .9rem; color: var(--text); margin-bottom: 16px; padding: 10px 12px; background: var(--grey-bg); border-radius: var(--radius-sm); line-height: 1.45; }
.consult-diagnosis-list { list-style: disc; margin: 0; padding-left: 20px; }
.consult-diagnosis-list li { margin-bottom: 4px; }
.consult-diagnosis-list li:last-child { margin-bottom: 0; }
.consult-no-diagnosis { color: var(--text-3); }
.consult-notes-hd { margin-top: 4px; }
.consult-chat { display: flex; flex-direction: column; gap: 12px; }
.consult-chat-msg { padding: 10px 14px; background: var(--grey-bg); border-radius: 12px; border: 1px solid var(--border); max-width: 100%; }
.consult-chat-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 6px; font-weight: 500; }
.consult-chat-body { font-size: .88rem; color: var(--text-2); line-height: 1.5; white-space: pre-wrap; word-break: break-word; }
.consult-no-note { font-style: italic; color: var(--text-3); }

/* Patient Notes (Comments) tab — chat-like */
.patient-notes-wrap { display: flex; flex-direction: column; height: 100%; min-height: 320px; max-height: 70vh; }
.patient-notes-list { flex: 1; overflow-y: auto; padding: 12px 0; display: flex; flex-direction: column; gap: 10px; min-height: 0; }
.patient-notes-empty { padding: 24px 16px !important; }
.patient-notes-compose { display: flex; gap: 10px; align-items: flex-end; padding: 12px 0; border-top: 1px solid var(--border); flex-shrink: 0; }
.patient-notes-textarea { flex: 1; min-height: 56px; resize: vertical; max-height: 120px; }
.patient-note-msg { padding: 10px 14px; background: var(--grey-bg); border-radius: 12px; border: 1px solid var(--border); max-width: 95%; }
.patient-note-meta { font-size: .78rem; color: var(--text-3); margin-bottom: 4px; font-weight: 500; }
.patient-note-text { font-size: .88rem; color: var(--text-2); line-height: 1.5; white-space: pre-wrap; word-break: break-word; }

.modal-card-wide { width: 520px; max-width: calc(100vw - 40px); min-width: 0; }
.pd-add-report-section-wrap { display: flex; align-items: center; gap: 10px; }
.pd-add-report-section-icon { color: var(--text-2); font-size: 1rem; }
.pd-add-report-section-wrap .fi { flex: 1; min-width: 0; }
.modal-sub { font-size: .88rem; color: var(--text-3); margin-bottom: 16px; }

.list-item {
  display: flex; align-items: center; gap: 6px; padding: 6px 0;
  border-bottom: 1px solid var(--border);
}
.list-item:last-child { border-bottom: none; }
.li-txt {
  flex: 1; border: 1px solid transparent; background: none; padding: 4px 8px;
  border-radius: 4px; font-size: .85rem;
}
.li-txt:focus { border-color: var(--primary); background: var(--card); outline: none; }
.li-up, .li-dn, .li-del {
  width: 28px; height: 28px; border: none; background: var(--grey-bg);
  border-radius: 4px; cursor: pointer; font-size: .82rem; transition: background var(--transition);
}
.li-up:hover, .li-dn:hover { background: var(--primary-bg); color: var(--primary); }
.li-del:hover { background: var(--accent-bg); color: var(--accent); }
.add-row { display: flex; gap: 8px; margin-top: 10px; }
.add-inp {
  flex: 1; padding: 8px 10px; border: 1.5px solid var(--border);
  border-radius: var(--radius-sm); font-size: .85rem;
}
.settings-actions { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 16px; }

/* ─── Modal ───────────────────────────────────────────────────── */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  padding-left: max(20px, env(safe-area-inset-left, 0px));
  padding-right: max(20px, env(safe-area-inset-right, 0px));
  opacity: 0;
  pointer-events: none;
  transition: opacity .2s ease;
}
.modal-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

/* Container has fixed max width + margin; card fills it so width never changes with content */
#modal-container {
  width: 100%;
  max-width: 520px;
  min-width: 0;
  flex-shrink: 0;
}
#modal-container:has(.modal-card-task) {
  max-width: 600px;
}

.modal-card {
  background: var(--card); border-radius: 14px; padding: 28px;
  width: 100%;
  max-width: 100%;
  min-width: 0;
  box-sizing: border-box;
  box-shadow: var(--shadow-md);
  max-height: 90vh; overflow-y: auto;
  overflow-x: hidden;
  overflow-wrap: break-word;
  word-break: break-word;
}

.modal-title { font-size: 1.15rem; font-weight: 700; margin-bottom: 12px; }
.modal-body { font-size: .9rem; color: var(--text-2); line-height: 1.55; margin-bottom: 20px; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

/* Prevent form content from affecting modal width */
#pd-add-report-form-wrap,
#pd-add-report-form-wrap .ct-card,
.modal-card .form-grid,
.modal-card .rating-row,
.modal-card .adl-row { min-width: 0; overflow-x: hidden; }

/* Modal on mobile: same approach, margin from overlay padding */
@media (max-width: 768px) {
  .modal-overlay {
    padding: 16px;
    padding-left: max(16px, env(safe-area-inset-left, 0px));
    padding-right: max(16px, env(safe-area-inset-right, 0px));
  }
  .modal-card {
    padding: 20px;
    max-height: 85vh;
  }
}

@media (max-width: 480px) {
  .modal-overlay {
    padding: 12px;
    padding-left: max(12px, env(safe-area-inset-left, 0px));
    padding-right: max(12px, env(safe-area-inset-right, 0px));
  }
  .modal-card { padding: 16px; }
}

/* ─── Toast ───────────────────────────────────────────────────── */
#toast {
  position: fixed; bottom: 24px; right: 24px; background: var(--navy);
  color: #fff; padding: 10px 20px; border-radius: 8px; font-size: .88rem;
  font-weight: 500; z-index: 300; opacity: 0; transform: translateY(10px);
  pointer-events: none; transition: all .25s ease;
}
#toast[data-show="true"] { opacity: 1; transform: translateY(0); pointer-events: auto; }

/* ─── PWA Install banner ───────────────────────────────────────── */
.pwa-install-banner {
  position: fixed; bottom: calc(24px + var(--safe-bottom)); left: 50%; transform: translateX(-50%);
  z-index: 290; width: calc(100% - 32px); max-width: 420px;
  box-shadow: var(--shadow-md); border-radius: var(--radius);
  background: var(--card); border: 1px solid var(--border);
  padding: 16px; animation: slideUpBanner .3s ease;
}
.pwa-install-banner[hidden] { display: none !important; }
@keyframes slideUpBanner { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
.pwa-install-inner { position: relative; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.pwa-install-icon {
  width: 44px; height: 44px; border-radius: 12px; flex-shrink: 0;
  background: var(--primary-bg); color: var(--primary);
  display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
}
.pwa-install-text { flex: 1; min-width: 0; }
.pwa-install-text strong { display: block; font-size: .95rem; margin-bottom: 2px; }
.pwa-install-text span { font-size: .8rem; color: var(--text-3); }
.pwa-install-actions { display: flex; gap: 8px; align-items: center; }
.pwa-install-close {
  position: absolute; top: -8px; right: -8px;
  width: 28px; height: 28px; border: none; border-radius: 50%;
  background: var(--grey-bg); color: var(--text-2); font-size: .8rem;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  transition: background var(--transition);
}
.pwa-install-close:hover { background: var(--accent-bg); color: var(--accent); }
@media (max-width: 480px) {
  .pwa-install-banner { bottom: calc(16px + var(--safe-bottom)); width: calc(100% - 24px); padding: 12px; }
  .pwa-install-actions { width: 100%; justify-content: flex-end; }
}

/* ─── Report History ──────────────────────────────────────────── */
.hist-total { font-size: .85rem; font-weight: 600; color: var(--text-2); }
.hist-date-group { margin-bottom: 20px; }
.hist-date-group:last-child { margin-bottom: 0; }
.hist-date-header {
  font-size: .8rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: .04em;
  margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid var(--border);
}
.report-timeline { position: relative; }
.report-entry {
  padding: 14px 16px; border-left: 3px solid var(--border); margin-left: 8px;
  margin-bottom: 12px; background: var(--card); border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  box-shadow: var(--shadow);
  word-break: normal; overflow-wrap: break-word;
}
.report-entry-hd {
  display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap;
}
.report-entry-hd strong { font-size: .88rem; }
.report-entry-time { font-size: .78rem; color: var(--text-3); }
.report-entry-body { font-size: .85rem; color: var(--text-2); line-height: 1.4; word-break: normal; overflow-wrap: break-word; }
.report-entry.clickable { cursor: pointer; }
.report-entry.clickable:hover { background: var(--grey-bg); }

.report-detail-modal .report-detail-meta { margin-bottom: 16px; font-size: .9rem; color: var(--text-2); }
.report-detail-modal .report-detail-meta p { margin: 4px 0; }
.report-detail-modal .report-detail-body { max-height: 60vh; overflow-y: auto; }
.report-detail-table { width: 100%; border-collapse: collapse; font-size: .88rem; margin-top: 8px; }
.report-detail-table td { padding: 6px 10px; border-bottom: 1px solid var(--border); vertical-align: top; }
.report-detail-table td:first-child { color: var(--text-2); width: 40%; }

.latest-summary-list { max-height: 55vh; overflow-y: auto; }
.latest-summary-item {
  padding: 12px 0; border-bottom: 1px solid var(--border);
  display: flex; flex-direction: column; gap: 6px;
}
.latest-summary-item:last-child { border-bottom: none; }
.latest-summary-hd {
  display: flex; align-items: center; flex-wrap: wrap; gap: 8px;
}
.latest-summary-body { font-size: .88rem; color: var(--text-2); margin: 0; line-height: 1.45; }
.status-section-item .status-section-detail { margin-top: 6px; }
.status-section-item .report-detail-table { margin-top: 4px; }
.status-inline {
  display: flex; flex-wrap: wrap; gap: 8px 16px; align-items: baseline;
  font-size: .88rem; color: var(--text-2); line-height: 1.5;
}
.status-kv {
  display: inline-flex; align-items: baseline; gap: 4px;
  padding: 4px 10px; border-radius: var(--radius-sm);
  background: var(--grey-bg); color: var(--text);
}
.status-kv .status-meta { font-size: .78rem; color: var(--text-3); font-weight: normal; }
.status-empty { margin: 0; padding: 6px 0; font-size: .85rem; color: var(--text-3); }
.status-diagnosis-block { margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.status-sub-hd { font-size: .85rem; font-weight: 600; color: var(--text-2); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }

.load-more-btn {
  display: block; margin: 12px auto; padding: 8px 24px;
}

/* ─── Empty state ─────────────────────────────────────────────── */
.empty-state {
  text-align: center; padding: 40px 20px; color: var(--text-3);
}
.empty-state i { font-size: 2.5rem; margin-bottom: 12px; display: block; }
.empty-state p { font-size: .9rem; }

/* Reports page — horizontal patient cards */
.reports-patient-cards-wrap { width: 100%; overflow: hidden; }
.reports-patient-cards {
  display: flex; gap: 12px; overflow-x: auto; padding: 8px 0;
  -webkit-overflow-scrolling: touch; scroll-snap-type: x proximity;
}
.reports-patient-card {
  flex: 0 0 auto; width: 200px; min-height: 100px; padding: 14px;
  background: var(--card); border: 1px solid var(--border); border-radius: var(--radius-sm);
  box-shadow: var(--shadow); scroll-snap-align: start; cursor: pointer;
  transition: box-shadow var(--transition), transform var(--transition);
}
.reports-patient-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
.reports-patient-card .card-name { font-weight: 700; font-size: .95rem; margin-bottom: 4px; }
.reports-patient-card .card-meta { font-size: .8rem; color: var(--text-3); margin-bottom: 6px; }
.reports-patient-card .card-summary { font-size: .78rem; color: var(--text-2); }
.reports-patient-card .badge-my-patient { margin-left: 6px; }

/* ─── Responsive ──────────────────────────────────────────────── */
@media (max-width: 900px) {
  .two-col { grid-template-columns: 1fr; }
  .form-grid { grid-template-columns: 1fr; }
  .chat-layout { flex-direction: column; height: auto; }
  .channel-list { width: 100%; display: flex; overflow-x: auto; }
  .channel-item { white-space: nowrap; border-bottom: none; border-right: 1px solid var(--border); }
}

@media (max-width: 768px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .sb-overlay.visible { display: block; }
  .main-wrap { margin-left: 0; }
  .topbar {
    left: 0;
    height: calc(var(--topbar-h) + var(--safe-top));
    min-height: calc(var(--topbar-h) + var(--safe-top));
    padding-top: max(10px, var(--safe-top));
    padding-bottom: 0;
    padding-left: max(16px, calc(12px + var(--safe-left)));
    padding-right: max(16px, calc(12px + var(--safe-right)));
    gap: 10px;
    align-items: center;
  }
  .menu-btn { display: flex; align-items: center; justify-content: center; font-size: 1.35rem; padding: 12px; min-width: 44px; min-height: 44px; }
  .tb-title { font-size: 1.15rem; }
  .tb-right .notif-btn { width: 44px; height: 44px; font-size: 1.2rem; }
  .sidebar .nav-link { font-size: 1rem; padding: 12px 16px; }
  .sidebar .nav-link i { font-size: 1.05rem; width: 24px; }
  .sb-brand-text { font-size: 1.05rem; }
  .sb-brand .sb-name { font-size: .88rem; }
  .logout-btn { font-size: 1rem; padding: 12px 16px; }
  .main-content { padding: 16px; }
  .stats-row { grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .stats-row .stat-card { padding: 10px 12px; min-width: 0; }
  .stats-row .stat-label { font-size: .72rem; }
  .stats-row .stat-value { font-size: 1rem; }
  .stats-row .stat-icon { width: 32px; height: 32px; font-size: .9rem; }
  .patient-actions { margin-left: 0; width: 100%; flex-wrap: wrap; }
  /* Patient detail: keep badge + all buttons on one scrollable line */
  .patient-header-top { flex-direction: row; flex-wrap: nowrap; align-items: center; gap: 8px; overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; min-width: 0; }
  .patient-header-top .risk-badge { flex-shrink: 0; }
  .patient-header-top .patient-actions { flex-wrap: nowrap; flex-shrink: 0; width: auto; gap: 6px; }
  .patient-header-top .patient-actions .btn { flex-shrink: 0; white-space: nowrap; padding: 6px 10px; font-size: .8rem; }
  .patient-header-top .patient-actions .btn i { margin-right: 4px; }
  .tab-btn { padding: 8px 12px; font-size: .8rem; }
  .card { padding: 14px; word-break: normal; overflow-wrap: break-word; }
  .fr-controls { flex-direction: column; align-items: stretch; }
  .fr-preview, .fr-report-content { max-width: 100%; overflow-x: hidden; }
  .list-toolbar .filter-select { min-width: 0; }
  /* Keep table cells readable: min-width so text doesn’t collapse to one letter per line */
  th, td { min-width: 4.5em; }
  td:first-child { min-width: 6em; }
}

@media (max-width: 480px) {
  .stats-row { grid-template-columns: repeat(3, 1fr); gap: 8px; }
  .stats-row .stat-card { padding: 8px 10px; }
  .stats-row .stat-label { font-size: .68rem; }
  .stats-row .stat-value { font-size: .95rem; }
  .stats-row .stat-icon { width: 28px; height: 28px; font-size: .85rem; }
  .login-card { padding: 28px 22px; }
  .main-content { padding: 12px; }
  .topbar { padding-top: max(10px, var(--safe-top)); padding-bottom: 0; padding-left: max(16px, calc(10px + var(--safe-left))); padding-right: max(16px, calc(10px + var(--safe-right))); }
  .menu-btn { min-width: 48px; min-height: 48px; font-size: 1.4rem; }
  .tb-title { font-size: 1.2rem; }
  .tb-right .notif-btn { width: 48px; height: 48px; font-size: 1.25rem; }
  .sidebar .nav-link { font-size: 1.02rem; padding: 14px 18px; }
  .sidebar .nav-link i { font-size: 1.1rem; }
  .notif-panel { right: calc(8px + var(--safe-right)); left: calc(8px + var(--safe-left)); width: auto; max-width: none; }
  .pg-title { font-size: 1.25rem; }
  .patient-header h2 { font-size: 1.1rem; }
}

/* ─── Print ───────────────────────────────────────────────────── */
@media print {
  .sidebar, .topbar, .sb-overlay, .chat-compose, .modal-overlay, #toast,
  .btn, .list-toolbar, .tab-bar, .patient-actions { display: none !important; }
  .main-wrap { margin-left: 0; padding-top: 0; }
  .main-content { margin-top: 0; padding: 0; max-width: none; }
  .card { box-shadow: none; border: 1px solid #ddd; break-inside: avoid; }
}
