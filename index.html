<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>NeuroRehab CareTrack</title>
  <meta name="theme-color" content="#0d9488">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CareTrack">
  <meta name="description" content="Clinical Neuro-Psychiatric Rehabilitation Reporting System">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
  <link rel="apple-touch-icon" href="icons/icon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="css/main.css">
</head>
<body>

<!-- ═══════ LOGIN ═══════ -->
<div id="login-screen" class="login-screen">
  <div class="login-card">
    <div class="login-header">
      <div class="login-icon"><i class="fas fa-brain"></i></div>
      <h1>NeuroRehab CareTrack</h1>
      <p>Clinical Rehabilitation Reporting</p>
    </div>
    <form id="login-form" autocomplete="on">
      <div class="fg"><label for="l-email">Email</label><input id="l-email" type="email" class="fi" placeholder="you@centre.org" required autocomplete="email"></div>
      <div class="fg"><label for="l-password">Password</label><input id="l-password" type="password" class="fi" placeholder="Min. 6 characters" required autocomplete="current-password" minlength="6"></div>
      <p id="login-error" class="error-msg" style="display:none"></p>
      <button type="submit" id="login-btn" class="btn btn-block">Sign in</button>
      <p class="login-hint">New user? Just sign in — your account is created automatically.</p>
    </form>
  </div>
</div>

<!-- ═══════ APP ═══════ -->
<div id="app-shell" class="app" hidden>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-brand"><i class="fas fa-brain"></i><span>CareTrack</span></div>
    <div class="sb-user">
      <div class="sb-avatar" id="sb-avatar">S</div>
      <div><div class="sb-name" id="sb-name">Staff</div><div class="sb-role" id="sb-role">—</div></div>
    </div>
    <nav class="sb-nav">
      <a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>
      <a href="#" class="nav-link" data-page="patients"><i class="fas fa-hospital-user"></i><span>Patients</span></a>
      <a href="#" class="nav-link" data-page="comms"><i class="fas fa-comments"></i><span>Team Chat</span></a>
      <a href="#" class="nav-link" data-page="freport"><i class="fas fa-file-medical"></i><span>Family Reports</span></a>
      <a href="#" class="nav-link" data-page="settings"><i class="fas fa-gear"></i><span>Settings</span></a>
    </nav>
    <div class="sb-foot"><button id="logout-btn" class="logout-btn"><i class="fas fa-right-from-bracket"></i><span>Sign out</span></button></div>
  </aside>
  <div class="sb-overlay" id="sb-overlay"></div>

  <!-- Main -->
  <div class="main-wrap">
    <header class="topbar">
      <button type="button" id="menu-btn" class="menu-btn"><i class="fas fa-bars"></i></button>
      <h2 class="tb-title" id="tb-title">Dashboard</h2>
      <span class="shift-badge" id="shift-badge">Morning</span>
    </header>

    <main class="main-content">

      <!-- ── Dashboard ── -->
      <section class="page active" id="page-dashboard">
        <h1 class="pg-title" id="d-greet">Dashboard</h1>
        <p class="pg-sub" id="d-date-display"></p>
        <div class="stats-row" id="dashboard-stats"></div>
        <div class="two-col">
          <div class="card"><div class="card-hd"><i class="fas fa-triangle-exclamation c-warn"></i> Risk Alerts</div><div id="risk-alerts"></div></div>
          <div class="card"><div class="card-hd"><i class="fas fa-clock-rotate-left c-muted"></i> Recent Reports</div><div id="recent-rpts"></div></div>
        </div>
        <div class="card card-muted"><div class="card-hd"><i class="fas fa-circle-info c-primary"></i> Quick Guide</div><div id="quick-guide" class="quick-guide"></div></div>
      </section>

      <!-- ── Patients ── -->
      <section class="page" id="page-patients">
        <div class="pg-head-row"><h1 class="pg-title">Patients</h1><button type="button" class="btn" id="btn-add-client"><i class="fas fa-plus"></i> Add Patient</button></div>
        <div class="search-bar"><i class="fas fa-search"></i><input type="text" id="patient-search" placeholder="Search patients by name or diagnosis…"></div>
        <div class="client-grid" id="client-grid"></div>
      </section>

      <!-- ── Patient Detail ── -->
      <section class="page" id="page-patient-detail">
        <button type="button" class="back-link" id="pd-back"><i class="fas fa-arrow-left"></i> All Patients</button>
        <div class="ph" id="pd-header">
          <div class="ph-left"><h1 id="pd-name">—</h1><p class="ph-meta" id="pd-meta"></p></div>
          <span class="risk-pill" id="pd-risk-badge">Low</span>
        </div>
        <div class="ptabs" id="patient-tabs">
          <button class="ptab active" data-tab="overview">Overview</button>
          <button class="ptab" data-tab="daily">Shift Report</button>
          <button class="ptab" data-tab="psychiatric">Psychiatric</button>
          <button class="ptab" data-tab="medication">Medication</button>
          <button class="ptab" data-tab="behavioral">Behavioral</button>
          <button class="ptab" data-tab="adl">ADL</button>
          <button class="ptab" data-tab="therapeutic">Therapeutic</button>
          <button class="ptab" data-tab="family">Family</button>
          <button class="ptab" data-tab="risk">Risk</button>
          <button class="ptab" data-tab="mdt">MDT</button>
        </div>
        <div class="tab-panels">
          <!-- Overview -->
          <div class="tp active" id="tab-overview"><div id="pd-overview"></div></div>

          <!-- Shift Report -->
          <div class="tp" id="tab-daily">
            <div class="card">
              <div class="card-hd">Shift Report</div>
              <div class="row2">
                <div class="fg"><label>Date</label><input type="date" id="d-date" class="fi"></div>
                <div class="fg"><label>Shift</label><select id="d-shift" class="fi"><option value="morning">Morning</option><option value="evening">Evening</option></select></div>
              </div>
              <div class="row3">
                <div class="fg"><label>Condition</label><select id="q-cond" class="fi"><option>Stable</option><option>Improved</option><option>Deteriorating</option><option>Critical</option></select></div>
                <div class="fg"><label>Mood</label><select id="q-mood" class="fi"><option>Euthymic</option><option>Elevated</option><option>Depressed</option><option>Irritable</option><option>Anxious</option></select></div>
                <div class="fg"><label>Sleep</label><select id="q-sleep" class="fi"><option>Good (6–8h)</option><option>Partial (4–6h)</option><option>Poor (&lt;4h)</option><option>Not reported</option></select></div>
              </div>
              <div class="fg"><label>Shift Observations</label><textarea id="q-notes" class="fi" rows="3" placeholder="Brief summary…"></textarea></div>
              <div class="form-act"><button type="button" class="btn" id="save-daily"><i class="fas fa-check"></i> Save Shift Report</button></div>
            </div>
          </div>

          <!-- Psychiatric -->
          <div class="tp" id="tab-psychiatric">
            <div class="card">
              <div class="card-hd">Mental State Examination</div>
              <p class="hint">Rate 1 (severely impaired) to 5 (normal)</p>
              <div id="psy-rows"></div>
              <div class="fg"><label>Overall Risk</label><div class="rpills" id="psy-risk"></div></div>
              <div class="fg"><label>Narrative Notes</label><textarea id="psy-notes" class="fi" rows="3" placeholder="Clinical observations…"></textarea></div>
              <div class="form-act"><button type="button" class="btn" id="save-psychiatric"><i class="fas fa-check"></i> Save</button><button type="button" class="btn btn-ghost" id="clear-psy">Clear</button></div>
            </div>
          </div>

          <!-- Medication -->
          <div class="tp" id="tab-medication">
            <div class="card">
              <div class="card-hd">Medication & Compliance</div>
              <div class="row2">
                <div class="fg"><label>Compliance</label><select id="med-compliance" class="fi"><option>Full compliance</option><option>Partial compliance</option><option>Refused</option></select></div>
                <div class="fg"><label>Non-compliance Reason</label><input id="med-reason" class="fi" placeholder="If partial/refused…"></div>
              </div>
              <div class="fg"><label>Side Effects</label><div class="cb-group" id="med-sideeffects"></div></div>
              <div class="row2">
                <div class="fg"><label>PRN Given?</label><select id="med-prn" class="fi"><option>No</option><option>Yes</option></select></div>
                <div class="fg"><label>PRN Reason & Response</label><input id="med-prn-desc" class="fi" placeholder="If yes…"></div>
              </div>
              <div class="card-hd" style="margin-top:12px">Vital Signs</div>
              <div class="row4">
                <div class="fg"><label>BP</label><input id="med-bp" class="fi" placeholder="120/80"></div>
                <div class="fg"><label>Pulse</label><input id="med-pulse" class="fi" type="number" placeholder="72"></div>
                <div class="fg"><label>Weight (kg)</label><input id="med-weight" class="fi" type="number" placeholder="65"></div>
                <div class="fg"><label>Temp (°F)</label><input id="med-temp" class="fi" type="number" placeholder="98.6"></div>
              </div>
              <div class="fg"><label>Notes</label><textarea id="med-notes" class="fi" rows="2" placeholder="Lab, observations…"></textarea></div>
              <div class="form-act"><button type="button" class="btn" id="save-medication"><i class="fas fa-check"></i> Save</button></div>
            </div>
          </div>

          <!-- Behavioral -->
          <div class="tp" id="tab-behavioral">
            <div class="card">
              <div class="card-hd">Behavioral Observations</div>
              <p class="hint">1–5 scale</p>
              <div id="beh-rows"></div>
              <div class="fg"><label>Critical Incident?</label><select id="beh-inc" class="fi"><option value="no">None</option><option value="yes">Yes — document below</option></select></div>
              <div id="beh-inc-f" class="fg" hidden><label>Incident Details</label><textarea id="beh-inc-desc" class="fi" rows="3" placeholder="Triggers, response, outcome…"></textarea></div>
              <div class="form-act"><button type="button" class="btn" id="save-behavioral"><i class="fas fa-check"></i> Save</button><button type="button" class="btn btn-ghost" id="clear-beh">Clear</button></div>
            </div>
          </div>

          <!-- ADL -->
          <div class="tp" id="tab-adl">
            <div class="card">
              <div class="card-hd">Activities of Daily Living</div>
              <div class="table-wrap"><table class="adl-t"><thead><tr><th>Domain</th><th>Independent (4)</th><th>Prompting (3)</th><th>Assistance (2)</th><th>Dependent (1)</th><th>Score</th></tr></thead><tbody id="adl-body"></tbody></table></div>
              <div class="adl-foot"><span>Total: <strong id="adl-tot">0</strong>/40</span><div class="fg" style="margin:0"><label>Trend</label><select id="adl-trend" class="fi" style="width:140px"><option>Improving</option><option>Stable</option><option>Declining</option></select></div></div>
              <div class="fg"><label>Notes</label><textarea id="adl-notes" class="fi" rows="2" placeholder="Observations…"></textarea></div>
              <div class="form-act"><button type="button" class="btn" id="save-adl"><i class="fas fa-check"></i> Save</button></div>
            </div>
          </div>

          <!-- Therapeutic -->
          <div class="tp" id="tab-therapeutic">
            <div class="card">
              <div class="card-hd">Therapeutic Activities</div>
              <p class="hint">Attendance & engagement (1–5)</p>
              <div id="ther-rows"></div>
              <div class="form-act"><button type="button" class="btn" id="save-therapeutic"><i class="fas fa-check"></i> Save</button></div>
            </div>
          </div>

          <!-- Family -->
          <div class="tp" id="tab-family">
            <div class="card">
              <div class="card-hd">Family Involvement</div>
              <div class="row2" id="family-fields"></div>
              <div class="fg"><label>Notes / Financial Concerns</label><textarea id="fam-notes" class="fi" rows="3" placeholder="…"></textarea></div>
              <div class="form-act"><button type="button" class="btn" id="save-family"><i class="fas fa-check"></i> Save</button></div>
            </div>
          </div>

          <!-- Risk -->
          <div class="tp" id="tab-risk">
            <div class="card">
              <div class="card-hd">Risk Monitoring & Safety</div>
              <div id="risk-rows"></div>
              <div class="fg"><label>Restraint / Seclusion Used?</label><select id="risk-rest" class="fi"><option value="no">No</option><option value="yes">Yes — document below</option></select></div>
              <div id="risk-rest-f" class="fg" hidden><label>Type, Duration, Justification</label><textarea id="risk-rest-desc" class="fi" rows="3" placeholder="…"></textarea></div>
              <div class="fg"><label>Notes / Interventions</label><textarea id="risk-notes" class="fi" rows="2" placeholder="…"></textarea></div>
              <div class="form-act"><button type="button" class="btn btn-red" id="save-risk"><i class="fas fa-check"></i> Save Risk Report</button></div>
            </div>
          </div>

          <!-- MDT -->
          <div class="tp" id="tab-mdt">
            <div class="card">
              <div class="card-hd">MDT Review</div>
              <div class="fg"><label>Team Members Present</label><div class="cb-group" id="mdt-members"></div></div>
              <div class="fg"><label>Summary of Progress</label><textarea id="mdt-progress" class="fi" rows="2" placeholder="…"></textarea></div>
              <div class="fg"><label>Areas of Concern</label><textarea id="mdt-concerns" class="fi" rows="2" placeholder="…"></textarea></div>
              <div class="fg"><label>Changes to Treatment Plan</label><textarea id="mdt-changes" class="fi" rows="2" placeholder="…"></textarea></div>
              <div class="fg"><label>Revised Goals</label><textarea id="mdt-goals" class="fi" rows="2" placeholder="…"></textarea></div>
              <div class="fg"><label>Discharge Readiness</label><select id="mdt-discharge" class="fi"><option>Not ready</option><option>Approaching readiness</option><option>Ready with support</option><option>Ready for discharge</option></select></div>
              <div class="form-act"><button type="button" class="btn" id="save-mdt"><i class="fas fa-check"></i> Save MDT Review</button></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ── Team Chat ── -->
      <section class="page" id="page-comms">
        <h1 class="pg-title">Team Chat</h1>
        <div class="chan-tabs" id="chan-tabs"></div>
        <div class="card chat-card">
          <div class="chat-hd" id="chan-title">General Ward</div>
          <div id="msg-list" class="msg-list"></div>
          <div class="chat-input"><input type="text" id="msg-in" class="fi" placeholder="Type a message… (Enter to send)"><button type="button" class="btn" id="send-msg"><i class="fas fa-paper-plane"></i></button></div>
        </div>
      </section>

      <!-- ── Family Reports ── -->
      <section class="page" id="page-freport">
        <h1 class="pg-title" id="fr-title">Family Progress Reports</h1>
        <p class="pg-sub" id="fr-sub">Monthly — supportive language only</p>
        <div class="card">
          <div class="row3">
            <div class="fg"><label id="fr-lbl-c">Client</label><select id="fr-cl" class="fi"></select></div>
            <div class="fg"><label id="fr-lbl-m">Report Month</label><input type="month" id="fr-mon" class="fi"></div>
            <div class="fg"><label id="fr-lbl-l">Language</label><div class="lang-tog"><button type="button" class="lbtn active" data-lang="en">English</button><button type="button" class="lbtn" data-lang="mr">मराठी</button></div></div>
          </div>
          <p class="alert alert-info" id="fr-info"></p>
          <p class="alert alert-warn" id="fr-noc">Select a client to preview.</p>
        </div>
        <div id="fr-prev" class="fr-preview" hidden></div>
      </section>

      <!-- ── Settings ── -->
      <section class="page" id="page-settings">
        <h1 class="pg-title">Settings</h1>
        <p class="pg-sub">Customise clinical parameter lists. Export/import to sync across devices.</p>
        <div class="card">
          <div class="form-act" style="margin-top:0">
            <button type="button" class="btn" id="export-config"><i class="fas fa-download"></i> Export</button>
            <button type="button" class="btn btn-ghost" id="import-config-btn"><i class="fas fa-upload"></i> Import</button>
            <input type="file" id="cfg-file" accept=".json" hidden>
            <button type="button" class="btn btn-ghost btn-red-text" id="reset-config"><i class="fas fa-rotate-left"></i> Reset Defaults</button>
          </div>
        </div>
        <div id="settings-lists"></div>
      </section>

    </main>
  </div>
</div>

<!-- ═══════ MODAL ═══════ -->
<div id="modal-client" class="modal-overlay" aria-hidden="true">
  <div class="modal">
    <div class="modal-hd"><h2>Register New Patient</h2><button type="button" id="modal-client-close" class="modal-x"><i class="fas fa-xmark"></i></button></div>
    <div class="modal-body">
      <div class="row2">
        <div class="fg"><label>Full Name *</label><input id="nc-name" class="fi" placeholder="Patient full name"></div>
        <div class="fg"><label>Date of Birth</label><input id="nc-dob" class="fi" type="date"></div>
      </div>
      <div class="row2">
        <div class="fg"><label>Gender</label><select id="nc-gender" class="fi"><option>Male</option><option>Female</option><option>Other</option></select></div>
        <div class="fg"><label>Admission Date</label><input id="nc-adm" class="fi" type="date"></div>
      </div>
      <div class="row2">
        <div class="fg"><label>Legal Status</label><select id="nc-legal" class="fi"><option>Voluntary</option><option>Involuntary</option><option>Court-mandated</option></select></div>
        <div class="fg"><label>Referred By</label><select id="nc-ref" class="fi"><option>Self</option><option>Family</option><option>Hospital</option><option>Court</option><option>Other</option></select></div>
      </div>
      <div class="row2">
        <div class="fg"><label>Assigned Therapist</label><input id="nc-therapist" class="fi" placeholder="Name"></div>
        <div class="fg"><label>Treating Psychiatrist</label><input id="nc-psych" class="fi" placeholder="Name"></div>
      </div>
      <div class="row2">
        <div class="fg"><label>Emergency Contact</label><input id="nc-emergency" class="fi" placeholder="Name & phone"></div>
        <div class="fg"><label>Payment Mode</label><select id="nc-pay" class="fi"><option>Insurance</option><option>Self-pay</option><option>Government scheme</option><option>NGO-sponsored</option></select></div>
      </div>
      <div class="fg"><label>Primary Diagnosis (ICD-11)</label><input id="nc-dx" class="fi" placeholder="e.g. 6A20 Schizophrenia"></div>
      <div class="form-act"><button type="button" class="btn" id="submit-client">Register Patient</button><button type="button" class="btn btn-ghost" id="cancel-client">Cancel</button></div>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="js/firebase-config.js"></script>
<script src="js/db.js"></script>
<script src="js/app.js"></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function () {
    navigator.serviceWorker.register('./sw.js').catch(function () {});
  });
}
</script>
</body>
</html>
